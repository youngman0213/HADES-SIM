<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•˜ë°ìŠ¤ í‚¤ìš°ê¸° v23.9 (Ticker Update)</title>
    <style>
        :root { --bg: #f5f7fa; --card: #ffffff; --point: #ff4d94; --text: #333; --border: #e1e4e8; --success: #40c057; --vocal: #ff4d94; --dance: #ae3ec9; --visual: #4dadff; --variety: #fab005; --charm: #f06595; --money: #2b8a3e; --danger: #fa5252; --sns: #405de6; --yt: #ff0000; --yz: #000000; --subak: #0ca678; --musicside: #1c7ed6; --tube: #f03e3e; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; margin: 0; padding: 0; line-height: 1.5; overflow-x: hidden; }
        
        /* ì‹œì‘ & ë„¤ë¹„ */
        #start-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a1a 0%, #333 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; color: white; text-align: center; }
        .start-logo { font-size: 3rem; font-weight: 900; color: var(--point); margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,77,148,0.5); }
        .start-btn { padding: 18px 60px; background: var(--point); color: white; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 10px 20px rgba(255,77,148,0.3); transition: 0.3s; }
        .start-btn:hover { transform: scale(1.05); }
        .nav-bar { display: none; background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; padding: 15px 5px; border: none; background: transparent; color: #666; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.2s; white-space: nowrap; }
        .nav-btn.active { color: var(--point); border-bottom: 3px solid var(--point); background: #fffafc; }
        
        /* ë ˆì´ì•„ì›ƒ */
        .container { display: none; max-width: 900px; margin: 0 auto; padding: 15px 15px 100px 15px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); position: relative; }
        
        /* ìƒíƒœì°½ ì„¸ë¡œê¸¸ì´ 30% ì¶•ì†Œ ì ìš© */
        .status-card { padding: 12px 20px; }
        .status-card h2 { margin-bottom: 8px; }

        .date-display { position: relative; text-align: right; margin-bottom: 10px; }
        @media (min-width: 600px) { .date-display { position: absolute; top: 15px; right: 25px; } }
        .day-count { font-weight: bold; color: var(--point); font-size: 18px; display: block; }
        .real-date { font-size: 12px; color: #888; }
        h2 { color: #222; font-size: 1.1rem; margin-top: 0; border-left: 4px solid var(--point); padding-left: 10px; margin-bottom: 15px; }
        .money-text { color: var(--money); font-weight: bold; }
        
        /* ë‰´ìŠ¤ í‹°ì»¤ */
        .ticker-container { background: #212529; color: white; padding: 12px 0; overflow: hidden; white-space: nowrap; position: relative; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .ticker-wrapper { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 20px; font-size: 13px; }
        .ticker-site { font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 4px; margin-right: 5px; vertical-align: middle; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        .site-ebem { background: #e7f5ff; color: #1971c2; }
        .site-cafe { background: #fff0f6; color: #d6336c; }
        .site-sns { background: #f0f1ff; color: var(--sns); }
        .site-yt { background: #ffe3e3; color: var(--yt); }
        .site-yz { background: #495057; color: #fff; }
        .site-news { background: #fa5252; color: #fff; }
        .site-music { background: #e6fcf5; color: #0ca678; }

        /* ìŠ¤íƒ¯ ê·¸ë¦¬ë“œ ê°„ê²© ì¶•ì†Œ */
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; }
        .stat-item { background: #f8f9fa; padding: 6px 10px; border-radius: 10px; }
        .stat-item small { color: #777; font-size: 11px; }
        .stat-item strong { font-size: 14px; display: block; margin-top: 1px; }

        /* ì°¨íŠ¸ */
        .chart-tabs { display: flex; border: 1px solid var(--border); border-radius: 8px 8px 0 0; overflow: hidden; }
        .chart-tab-btn { flex: 1; border: none; background: #f8f9fa; padding: 12px; cursor: pointer; font-size: 14px; font-weight: bold; color: #888; transition: 0.2s; }
        .chart-tab-btn.active { background: white; color: #333; }
        .chart-tab-btn.subak.active { color: var(--subak); border-bottom: 3px solid var(--subak); }
        .chart-tab-btn.musicside.active { color: var(--musicside); border-bottom: 3px solid var(--musicside); }
        .chart-tab-btn.tube.active { color: var(--tube); border-bottom: 3px solid var(--tube); }

        .sub-chart-tabs { display: flex; background: #fff; border-bottom: 1px solid var(--border); margin-bottom: 10px; padding: 5px; gap: 5px; }
        .sub-tab-btn { flex: 1; border: 1px solid transparent; background: transparent; padding: 6px; cursor: pointer; font-size: 11px; color: #666; border-radius: 20px; transition: 0.2s; }
        .sub-tab-btn:hover { background: #f1f3f5; }
        .sub-tab-btn.active { background: #333; color: white; font-weight: bold; }
        
        .chart-list { min-height: 350px; }
        .chart-row { display: flex; align-items: center; padding: 10px 5px; border-bottom: 1px solid #f1f3f5; font-size: 13px; }
        .chart-row:nth-child(1) .rank { color: #ffd43b; text-shadow: 1px 1px 0 #e67700; font-size: 16px; }
        .chart-row:nth-child(2) .rank { color: #adb5bd; font-size: 15px; }
        .chart-row:nth-child(3) .rank { color: #e599f7; font-size: 15px; }
        
        /* í•˜ë°ìŠ¤ ì°¨íŠ¸ ê°•ì¡° ìˆ˜ì • */
        .chart-row.my-song { background: #fff0f6; border: 2px solid #ff4d94; border-radius: 10px; margin: 2px 0; position: relative; z-index: 1; box-shadow: 0 2px 8px rgba(255,77,148,0.2); }
        .chart-row.my-song .rank { color: #ff4d94 !important; font-size: 18px; }
        .chart-row.my-song .song-title { color: #d6336c; }
        
        .rank { width: 30px; font-weight: 900; text-align: center; margin-right: 10px; color: #495057; }
        .rank-change { width: 30px; font-size: 10px; text-align: center; margin-right: 5px; color: #888; }
        .rank-up { color: var(--danger); }
        .rank-down { color: #1c7ed6; }
        .song-info { flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .song-title { font-weight: bold; display: block; }
        .artist-name { font-size: 11px; color: #888; }
        .chart-score { font-size: 10px; color: #868e96; text-align: right; width: 60px; font-variant-numeric: tabular-nums; }

        /* ë©¤ë²„ */
        .member-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 650px) { .member-grid { grid-template-columns: repeat(2, 1fr); } }
        .member-card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; transition: 0.3s; }
        .profile-container { display: flex; align-items: center; margin-bottom: 15px; }
        .profile-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); margin-right: 12px; background: #eee; }
        .profile-info { flex: 1; }
        .stat-row { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; }
        .stat-label { width: 40px; color: #777; font-size: 11px; }
        .stat-bar-bg { flex: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin: 0 8px; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: 0.5s; }
        .bonus-stat { color: var(--success); font-weight: bold; font-size: 10px; margin-left: 4px; }
        .equip-btn { position: absolute; top: 15px; right: 15px; padding: 5px 10px; background: #333; color: white; font-size: 11px; border-radius: 5px; border:none; cursor: pointer; }
        .equipped-items { margin-top: 10px; font-size: 11px; color: #666; background: #f8f9fa; padding: 8px; border-radius: 6px; min-height: 20px;}

        /* ì»¨í…ì¸  ë±ƒì§€ */
        .content-card { border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 12px; background: #fff; transition:0.2s; position: relative; }
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .content-badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .badge-short { background: #e3fafc; color: #0c8599; }
        .badge-mid { background: #f3f0ff; color: #6741d9; }
        .badge-long { background: #fff0f6; color: #c2255c; }
        .badge-item { background: #f3f0ff; color: #5c7cfa; }
        .badge-special { background: #fff5f5; color: #ff0000; border: 1px solid #ffc9c9; }
        .content-info { font-size: 12px; color: #555; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        .content-btn { width: 100%; padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-available { background: var(--point); box-shadow: 0 4px 6px rgba(255, 77, 148, 0.2); }
        .btn-available:hover { filter: brightness(0.9); }
        .btn-cooldown { background: #adb5bd; cursor: not-allowed; }
        
        /* ë²„íŠ¼ & ëª¨ë‹¬ */
        .next-day-bar { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 12px; border-top: 1px solid var(--border); text-align: center; z-index: 100; box-sizing: border-box; }
        .primary-btn { width: 100%; padding: 14px; background: var(--point); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; transition:0.2s; }
        .choice-btn { width: 100%; padding: 14px; background: #f1f3f5; color: #333; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; margin-bottom: 8px; text-align: left; font-size: 14px; display: flex; justify-content: space-between; align-items: center; transition:0.2s; }
        .upgrade-btn { padding: 4px 8px; font-size: 11px; background: #7950f2; color:white; border:none; border-radius:4px; cursor:pointer; margin-left:5px; font-weight:bold; }
        .modal-overlay { display: none; position: fixed; z-index: 9000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter: blur(3px); }
        .modal-content { background:white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding:25px; width: 85%; max-width:400px; border-radius:20px; text-align:center; box-sizing: border-box; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .save-load-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .save-btn { background: #495057; color: white; padding: 10px; border-radius: 8px; border: none; font-size: 12px; cursor: pointer; }
        
        .tier-badge { font-size: 16px; font-weight: 900; margin: 10px 0; display: inline-block; padding: 8px 20px; border-radius: 50px; color:white; }
        .tier-rookie { background: #ced4da; color: #495057; }
        .tier-rising { background: #74c0fc; }
        .tier-domestic { background: #40c057; }
        .tier-asia { background: #fab005; }
        .tier-na { background: #e64980; }
        .tier-world { background: linear-gradient(45deg, #a5d8ff, #7950f2, #ff8787); box-shadow: 0 0 15px rgba(121, 80, 242, 0.5); position: relative; overflow: hidden; }
        .enhance-text { color: #7950f2; font-weight: 900; }
    </style>
</head>
<body>

<div id="start-page">
    <div class="start-logo">HADES</div>
    <div class="start-sub">Virtual Idol Management v23.9</div>
    <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
</div>

<div class="nav-bar" id="main-nav">
    <button class="nav-btn active" onclick="openPage('home', this)">ğŸ“Š í™ˆ</button>
    <button class="nav-btn" onclick="openPage('members', this)">ğŸ‘¥ ë©¤ë²„</button>
    <button class="nav-btn" onclick="openPage('contents', this)">ğŸ¬ ì»¨í…ì¸ </button>
    <button class="nav-btn" onclick="openPage('store', this)">ğŸ›ï¸ ìƒì </button>
    <button class="nav-btn" onclick="openPage('manual', this)">ğŸ“… ì§€ì‹œ</button>
</div>

<div class="container" id="main-container">
    <div id="home" class="page active">
        
        <div class="ticker-container">
            <div class="ticker-wrapper" id="reaction-ticker">
                <div class="ticker-item">ë¡œë“œ ì¤‘...</div>
            </div>
        </div>

        <div class="card status-card">
            <div class="date-display">
                <span class="day-count">ìš´ì˜ <span id="current-day">1</span>ì¼ì°¨</span>
                <span class="real-date" id="current-date">2025-09-05</span>
            </div>
            <h2>ìƒíƒœ</h2>
            <div class="stat-grid">
                <div class="stat-item"><small>ë³´ìœ  ìì‚°</small><strong id="p-finance" class="money-text">200,000,000ì›</strong></div>
                <div class="stat-item"><small>íŒ¬ì¹´í˜ íšŒì›</small><strong id="p-fandom">110,000ëª…</strong></div>
                <div class="stat-item"><small>ë„ˆíŠœë¸Œ êµ¬ë…</small><strong id="p-youtube">20,000ëª…</strong></div>
                <div class="stat-item"><small>SNS íŒ”ë¡œì›Œ</small><strong id="p-sns">1,000ëª…</strong></div>
                <div class="stat-item"><small>í˜„ì¬ ì¸ì§€ë„</small><strong id="p-tier" style="color:#7950f2;">ë£¨í‚¤</strong></div>
                <div class="stat-item"><small>ëˆ„ì  ë§¤ì¶œ</small><strong id="p-sales">0ì›</strong></div>
            </div>
        </div>

        <div class="card" id="chart-section" style="display:none;">
            <h2>ğŸ† ì‹¤ì‹œê°„ í†µí•© ì°¨íŠ¸</h2>
            <div class="chart-tabs">
                <button class="chart-tab-btn subak active" onclick="switchChartPlatform('subak')">ğŸˆ ìˆ˜ë°•</button>
                <button class="chart-tab-btn musicside" onclick="switchChartPlatform('musicside')">ğŸ’¿ ë®¤ì§ì‚¬ì´ë“œ</button>
                <button class="chart-tab-btn tube" onclick="switchChartPlatform('tube')">ğŸ“º ë„ˆíŠœë¸Œ</button>
            </div>
            <div class="sub-chart-tabs">
                <button class="sub-tab-btn active" onclick="switchChartPeriod('daily')">ğŸ“… ì¼ê°„</button>
                <button class="sub-tab-btn" onclick="switchChartPeriod('monthly')">ğŸŒ” ì›”ê°„</button>
                <button class="sub-tab-btn" onclick="switchChartPeriod('yearly')">ğŸ‘‘ ì—°ê°„</button>
            </div>
            <div id="chart-list-container" class="chart-list"></div>
            <div style="font-size:11px; text-align:center; color:#adb5bd; margin-top:10px;">* ë§¤ì¼ 00ì‹œ ìˆœìœ„ ì—…ë°ì´íŠ¸ (1~10ìœ„ í‘œì‹œ)</div>
        </div>

        <div class="card" id="profit-report" style="display:none; background: #f2fcf0; border-color: #40c057;">
            <h2>ğŸˆ ì¼ì¼ ë¦¬í¬íŠ¸</h2>
            <div id="profit-content" style="font-size: 14px;"></div>
        </div>
        
        <div class="save-load-btns">
            <button class="save-btn" onclick="saveGame()">ğŸ’¾ ë°ì´í„° ì €ì¥</button>
            <button class="save-btn" style="background:#212529;" onclick="loadGame()">ğŸ“‚ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
    </div>

    <div id="members" class="page">
        <div class="member-grid" id="member-grid-container"></div>
    </div>

    <div id="contents" class="page">
        <div class="card">
            <h2>ğŸ”¥ ìŠ¤í˜ì…œ í”„ë¡œì íŠ¸ (í•œì •)</h2>
            <div id="special-content-list"></div>
        </div>
        <div class="card">
            <h2>ğŸ¬ ì»¨í…ì¸  ì œì‘</h2>
            <div id="content-list"></div>
        </div>
    </div>

    <div id="store" class="page">
        <div class="card">
            <h2>ğŸ›ï¸ ë°©ì†¡ ì¥ë¹„ ìƒì </h2>
            <div id="shop-list"></div>
        </div>
    </div>

    <div id="manual" class="page">
        <div class="card">
            <h2>ìˆ˜ë™ ì§€ì‹œ</h2>
            <select id="sel-member" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;"></select>
            <select id="sel-stat" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
                <option value="vocal">ğŸ¤ ë³´ì»¬ ì§‘ì¤‘ í›ˆë ¨</option>
                <option value="dance">ğŸ’ƒ ì•ˆë¬´ ì—°ìŠµ</option>
                <option value="visual">âœ¨ ë¹„ì£¼ì–¼ ì¼€ì–´</option>
                <option value="variety">ğŸ—£ï¸ ì˜ˆëŠ¥ ìŠ¤í”¼ì¹˜</option>
                <option value="charm">ğŸ€ ë§¤ë ¥ ê°•í™”</option>
                <option value="stream">ğŸ“¡ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</option>
                <option value="rest">ğŸ’¤ ê¿€ê°™ì€ íœ´ì‹</option>
            </select>
            <button class="primary-btn" onclick="manualTrainAction()">ì§€ì‹œ ì™„ë£Œ</button>
        </div>
    </div>
</div>

<div class="next-day-bar" id="main-footer">
    <button class="primary-btn" style="background: #40c057;" onclick="nextDay()">ğŸŒ™ ë‹¤ìŒë‚ ë¡œ (Space)</button>
</div>

<div id="eventModal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modal-title"></h2>
        <div id="modal-body" style="margin: 15px 0; font-size: 14px;"></div>
        <div id="modal-choices"></div>
    </div>
</div>

<script>
    // === ë°ì´í„° ===
    const rivalArtists = ["ì‹œí€€ì„œ", "ë””ì§€ë…¸ë¯¹", "ê¸€ë¦¬ì¹˜ë¬¸", "ë‰´ëŸ´ì›¨ì´ë¸Œ", "ë¹„íŠ¸ì…¸", "ì½”ì–´ë§í¬", "ì‚¬ì´ë²„ë¦¬í”„", "í”½ì…€í—¤ì´ì¦ˆ", "ì‹±í¬ë¹„ì „", "ë²¡í„°ë³´ì´ì¦ˆ", "ì•Œê³ ë¦¬ë“¬", "í”Œë¡œíŒ…ì¹©", "ì–¸ë¦¬ì–¼ì†Œìš¸", "ì„œë¸Œë ˆì´ì–´", "ë©”íƒ€ëª¨í”„", "í•˜ì´í¼ë£¨í”„", "ì‹ ìŠ¤í”Œë¡œìš°", "ëˆ„í´ë¦¬ì–´ìŠ¤", "KRYX", "LYNQ", "V-ZIT", "X-IEL", "JOYN", "N-ZIA", "RYZE-O", "QUV", "W-AVE", "SYLK", "F-REEL", "G-LOWD", "VEXEN", "TYRO", "Z-EEN", "M-NEX", "O-RIT", "P-LEY", "B-ZON", "X-WAY", "H-YDE", "L-UVN", "S-YDE", "A-XIS", "N-TICK"];
    const kpopSongTitles = ["Black Out", "Glitch Mode", "Venomous Love", "Wildfire", "No Gravity", "Double Dare", "Phantom Pain", "Crimson Sky", "Thunderbolt", "Overload", "Shatter", "Iron Heart", "Vortex", "Unstoppable", "Midnight Chase", "Blue Lemonade", "Summer Breeze", "Sparkling", "Neon Dream", "Surf's Up", "Candy Cloud", "Electric Youth", "Paper Plane", "Star Gazing", "Wink", "Soda Pop", "Sun-Kissed", "Bubble Gum", "Kickboard", "Rainbow Bridge", "ë‹¬ì˜ ë’·ë©´", "ìƒˆë²½ ì„¸ ì‹œ", "ë¹„ë°€ì˜ ì •ì›", "Last Letter", "ì”ìƒ", "Mist", "ê¸°ì–µ ì¡°ê°", "Falling Star", "Urban Night", "ì ë“¤ì§€ ì•ŠëŠ” ë„ì‹œ", "Deep Blue", "ìš°ì£¼ ìœ ì˜", "Timeline", "Whisper", "Stardust", "Bad Attitude", "Level Up", "Money Talk", "Swagger", "On the Top", "Zero to One", "Game Changer", "Flashlight", "New Rules", "Vibe Check", "Backstage", "No Filter", "Hustle", "Iconic", "Last Shot", "High Tension", "Silver Lining", "Deja Vu", "Under the Radar", "Maverick", "Gravity Pull", "Velvet Rope", "Heartbeat Sensor", "After Party", "Neon Sign", "Blindfold", "Catalyst", "Golden Hour", "Wild Side", "Midnight Sun", "Prism", "Love Dive", "Satellite", "Break the Wall", "Egoist", "Blue Hour", "Cherry Bomb", "Dive In", "Focus On", "Get Loud", "Horizon", "In the Dark", "Just Go", "Keep It Real", "Lucid Dream", "Make a Wish", "Night Owl", "Off the Record", "Purple Night", "Quiet Riot", "Road Trip", "Stay Up", "Take a Chance", "Up and Down", "Vivid", "Way Home", "X-Ray", "Young and Free", "ZigZag"];

    function getRandomSong() { return kpopSongTitles[Math.floor(Math.random() * kpopSongTitles.length)]; }

    // === ê²Œì„ ë¡œì§ ===
    function startGame() {
        document.getElementById('start-page').style.display = 'none';
        document.getElementById('main-nav').style.display = 'flex';
        document.getElementById('main-container').style.display = 'block';
        document.getElementById('main-footer').style.display = 'block';
        initRivalCharts(); 
        updateDisplay();
    }

    function createMember(name, birth, imgId, stats, customUrl = null) {
        return { 
            name, birth, image: customUrl || `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`, 
            vocal: stats.vocal, dance: stats.dance, visual: stats.visual, variety: stats.variety, charm: stats.charm, 
            fatigue: 0, mental: 80, manualAct: null, equipment: [] 
        };
    }

    let gameState = {
        day: 1, startDate: new Date('2025-09-05'), finance: 200000000, fandom: 110000, youtube: 20000, sns: 1000,
        accumulatedSales: 0, currentTier: "ë£¨í‚¤",
        activeCharts: [], rivalCharts: [],
        monthlySnapshots: { subak: [], musicside: [], tube: [] },
        yearlySnapshots: { subak: [], musicside: [], tube: [] },
        flags: { albumPaid: false, concertBought: false, concertDone: false },
        currentChartPlatform: 'subak',
        currentChartPeriod: 'daily',
        members: [
            createMember('í‚¤ë§ˆ', '04-22', 1, {vocal:8, dance:3, visual:3, variety:3, charm:3}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/29/513/80329513_20260120180131_org.jpg/melon/quality/80/optimize'), 
            createMember('ëµê·¤', '12-24', 2, {vocal:7, dance:3, visual:3, variety:4, charm:3}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/813/80326813_20251224160243_org.jpg/melon/quality/80/optimize'), 
            createMember('ì±ˆë‚˜', '02-26', 3, {vocal:2, dance:5, visual:9, variety:2, charm:2}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/812/80326812_20251224160127_org.jpg/melon/quality/80/optimize'),
            createMember('ì†œì£¼ë¨¹', '11-11', 4, {vocal:2, dance:2, visual:3, variety:9, charm:4}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/815/80326815_20251224160500_org.jpg/melon/quality/80/optimize'), 
            createMember('ì—°ì´ˆë¡', '03-26', 5, {vocal:7, dance:2, visual:5, variety:2, charm:4}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/814/80326814_20251224160415_org.jpg/melon/quality/80/optimize'),
        ],
        community: [], popupQueue: [], weeklyStats: [], lastContents: { short: -999, mid: -999, long: -999 }, inventory: []
    };

    function initRivalCharts() {
        if (gameState.rivalCharts.length > 0) return;
        for(let i=0; i<60; i++) {
            const artist = rivalArtists[Math.floor(Math.random() * rivalArtists.length)];
            const title = getRandomSong();
            const baseScore = Math.floor(Math.random() * 4000) + 1000;
            const createScoreObj = (base) => ({ daily: base, monthly: base * 15, yearly: base * 100 });
            gameState.rivalCharts.push({
                artist: artist, title: title,
                scores: { subak: createScoreObj(baseScore), musicside: createScoreObj(baseScore), tube: createScoreObj(baseScore) },
                prevRanks: { subak: 0, musicside: 0, tube: 0 } 
            });
        }
        updateChartRanks(true);
    }

    // ìƒì  ì•„ì´í…œ ìˆ˜ì • (ì¡°ëª… ì œê±°, í•œê¸€ í‘œê¸°)
    const shopItems = [
        { id: 'mic_1', name: 'USB ë§ˆì´í¬', price: 300000, stat: 'vocal', statKr: 'ë³´ì»¬', val: 1, desc: 'ê°€ì„±ë¹„ ë§ˆì´í¬ (ë³´ì»¬+1)' },
        { id: 'cam_1', name: 'FHD ì›¹ìº ', price: 500000, stat: 'visual', statKr: 'ë¹„ì£¼ì–¼', val: 1, desc: 'ê¸°ë³¸ ìº  (ë¹„ì£¼ì–¼+1)' },
        { id: 'mic_2', name: 'ì½˜ë´ì„œ ë§ˆì´í¬', price: 2000000, stat: 'vocal', statKr: 'ë³´ì»¬', val: 1, desc: 'ê¹”ë”í•œ ìŒì§ˆ (ë³´ì»¬+1)' },
        { id: 'cpu_1', name: 'ë°©ì†¡ ì†¡ì¶œì»´', price: 2500000, stat: 'variety', statKr: 'ì˜ˆëŠ¥', val: 1, desc: 'ë ‰ ì—†ëŠ” ë°©ì†¡ (ì˜ˆëŠ¥+1)' },
        { id: 'tracker_1', name: 'ë³´ê¸‰í˜• íŠ¸ë˜ì»¤', price: 3000000, stat: 'dance', statKr: 'ëŒ„ìŠ¤', val: 1, desc: 'ê¸°ë³¸ì ì¸ ì›€ì§ì„ (ëŒ„ìŠ¤+1)' }
    ];

    // ì»¨í…ì¸  ëª…ì¹­ ìˆ˜ì •
    const contentTypes = {
        short: { id: 'short', name: 'ì»¤ë²„ê³¡ / ìˆì¸  ì±Œë¦°ì§€', type: 'ì¼ì£¼ì¼', badge: 'badge-short', cooldown: 7, cost: 2000000, risk: 10, rewardMin: 1500, rewardMax: 3000 },
        mid: { id: 'mid', name: 'í•©ë™ ëª¨ì…˜ìº¡ì³ ê¸°íš', type: '90ì¼', badge: 'badge-mid', cooldown: 90, cost: 15000000, risk: 20, rewardMin: 8000, rewardMax: 15000 },
        long: { id: 'long', name: 'ì‹±ê¸€ ë°œë§¤ / ë‹¨ë… ì½˜ì„œíŠ¸', type: '180ì¼', badge: 'badge-long', cooldown: 180, cost: 50000000, risk: 30, rewardMin: 40000, rewardMax: 80000 }
    };

    const tierOrder = ["UNRANKED", "ë£¨í‚¤", "ë¼ì´ì§•ìŠ¤íƒ€", "êµ­ë‚´ì—ì„œ ì•Œë ¤ì§", "ì•„ì‹œì•„ì—ì„œ ì•Œë ¤ì§", "ë¶ë¯¸ì—ì„œ ì•Œë ¤ì§", "ì „ì„¸ê³„ì—ì„œ ì•Œë ¤ì§"];
    const upgradeConfig = { 0: { chance: 0.8, costMult: 0.3 }, 1: { chance: 0.5, costMult: 0.6 }, 2: { chance: 0.3, costMult: 1.0 } };

    function saveGame() { localStorage.setItem('hades_save_v24', JSON.stringify(gameState)); alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); }
    function loadGame() { 
        const saved = localStorage.getItem('hades_save_v24'); 
        if (!saved) return alert("ë°ì´í„° ì—†ìŒ"); 
        gameState = JSON.parse(saved);
        gameState.startDate = new Date(gameState.startDate);
        updateDisplay(); alert("ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ"); 
    }

    // === ì°¨íŠ¸ ë¡œì§ (ìˆ˜ì •: ë‚œì´ë„ í•˜í–¥, ë™ê¸°í™”, ê¸°ê°„ë³„ ì—…ë°ì´íŠ¸) ===
    function updateChartRanks(isInitial = false) {
        const platforms = ['subak', 'musicside', 'tube'];
        const periods = ['daily', 'monthly', 'yearly'];

        platforms.forEach(plat => {
            const allSongs = [];
            gameState.rivalCharts.forEach(rc => allSongs.push({ ref: rc, isPlayer: false, score: rc.scores[plat].daily }));
            gameState.activeCharts.forEach(ac => {
                if (ac.weekCount < 6) allSongs.push({ ref: ac, isPlayer: true, score: ac.scores[plat].daily });
            });

            allSongs.sort((a, b) => b.score - a.score);
            allSongs.forEach((song, idx) => {
                const rank = idx + 1;
                if (!song.ref.prevRanks) song.ref.prevRanks = {};
                
                // íŒì—… ì²´í¬ (í”Œë ˆì´ì–´ ê³¡ì´ 10ìœ„/1ìœ„ ì§„ì… ì‹œ)
                if (song.isPlayer && !isInitial) {
                    if (rank === 1 && song.ref.prevRanks[plat] !== 1) {
                        pushPopup("ğŸ† ì°¨íŠ¸ 1ìœ„ ë‹¬ì„±!", `ì¶•í•˜í•©ë‹ˆë‹¤! <${song.ref.name}> ê³¡ì´ ${plat === 'subak' ? 'ìˆ˜ë°•' : (plat === 'tube' ? 'ë„ˆíŠœë¸Œ' : 'ë®¤ì§ì‚¬ì´ë“œ')} ì°¨íŠ¸ 1ìœ„ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!`);
                    } else if (rank <= 10 && (song.ref.prevRanks[plat] > 10 || !song.ref.prevRanks[plat])) {
                        pushPopup("âœ¨ ì°¨íŠ¸ TOP 10 ì§„ì…!", `<${song.ref.name}> ê³¡ì´ ${plat === 'subak' ? 'ìˆ˜ë°•' : 'ì°¨íŠ¸'} 10ìœ„ê¶Œì— ì§„ì…í–ˆìŠµë‹ˆë‹¤!`);
                    }
                }
                song.ref.prevRanks[plat] = rank;
                if (song.isPlayer && plat === 'subak') song.ref.rank = rank;
            });
        });
    }

    function pushPopup(title, body) {
        gameState.popupQueue.push({ type: 'notice', event: { title, desc: body, choices: [{ text: "ì™€ì•„ì•„!", effect: () => {} }] } });
    }

    function processCharts() {
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        const isFirstOfMonth = d.getDate() === 1;
        const isFirstOfYear = isFirstOfMonth && d.getMonth() === 0;

        // ë©¤ë²„ ì´í•© ìŠ¤íƒ¯ (ìƒí•œì„  ë°˜ì˜ëœ ê°’ ê¸°ë°˜)
        let totalStat = 0;
        gameState.members.forEach(m => totalStat += (m.vocal + m.dance + m.visual + m.variety + m.charm));
        const teamPower = totalStat / 2; // ë‚œì´ë„ í•˜í–¥ ì¡°ì •

        // ë¼ì´ë²Œ ë³€ë™ (ë™ê¸°í™”ëœ íŠ¸ë Œë“œ ì ìš©)
        gameState.rivalCharts.forEach(rc => {
            const trend = (Math.random() * 400) - 200;
            ['subak', 'musicside', 'tube'].forEach(plat => {
                rc.scores[plat].daily = Math.max(500, Math.min(10000, rc.scores[plat].daily + trend + (Math.random() * 100 - 50)));
                rc.scores[plat].monthly += rc.scores[plat].daily;
                rc.scores[plat].yearly += rc.scores[plat].daily;
            });
        });

        // í”Œë ˆì´ì–´ ê³¡ ë³€ë™
        gameState.activeCharts.forEach(ac => {
            if (ac.weekCount >= 6) return;
            const fanBonus = gameState.fandom / 10000;
            const gain = teamPower + fanBonus + (Math.random() * 500);
            
            ['subak', 'musicside', 'tube'].forEach(plat => {
                ac.scores[plat].daily += gain;
                ac.scores[plat].monthly += ac.scores[plat].daily;
                ac.scores[plat].yearly += ac.scores[plat].daily;
            });
        });

        // ì›”ê°„/ì—°ê°„ ìŠ¤ëƒ…ìƒ· (ë§¤ë‹¬ 1ì¼/ë§¤ë…„ 1ì›” 1ì¼)
        if (isFirstOfMonth) {
            gameState.rivalCharts.concat(gameState.activeCharts).forEach(s => {
                ['subak', 'musicside', 'tube'].forEach(p => {
                    if(!s.scores[p].displayMonthly) s.scores[p].displayMonthly = s.scores[p].monthly;
                    s.scores[p].monthly = 0;
                });
            });
        }
        if (isFirstOfYear) {
            gameState.rivalCharts.concat(gameState.activeCharts).forEach(s => {
                ['subak', 'musicside', 'tube'].forEach(p => {
                    if(!s.scores[p].displayYearly) s.scores[p].displayYearly = s.scores[p].yearly;
                    s.scores[p].yearly = 0;
                });
            });
        }

        updateChartRanks();
    }

    // === UI ì—…ë°ì´íŠ¸ ===
    function updateDisplay() {
        document.getElementById('current-day').innerText = gameState.day;
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        document.getElementById('current-date').innerText = d.toISOString().split('T')[0];
        document.getElementById('p-finance').innerText = gameState.finance.toLocaleString() + 'ì›';
        document.getElementById('p-fandom').innerText = gameState.fandom.toLocaleString() + 'ëª…';
        document.getElementById('p-youtube').innerText = gameState.youtube.toLocaleString() + 'ëª…';
        document.getElementById('p-sns').innerText = gameState.sns.toLocaleString() + 'ëª…';
        document.getElementById('p-sales').innerText = gameState.accumulatedSales.toLocaleString() + 'ì›';
        
        const score = calculateTierScore();
        const tierInfo = getTierInfo(score);
        document.getElementById('p-tier').innerText = tierInfo.name;

        if (d >= new Date('2025-12-25')) document.getElementById('chart-section').style.display = 'block';

        renderMemberCards();
        renderHomeCharts(gameState.currentChartPlatform, gameState.currentChartPeriod);
    }

    function renderMemberCards() {
        document.getElementById('member-grid-container').innerHTML = gameState.members.map((m, idx) => {
            const bonuses = { vocal:0, dance:0, visual:0, variety:0, charm:0 };
            m.equipment.forEach(eq => bonuses[eq.stat] += (eq.val + eq.level));
            return `
            <div class="member-card">
                <button class="equip-btn" onclick="openEquipModal(${idx})">ğŸ’ ì¥ë¹„/ê°•í™”</button>
                <div class="profile-container">
                    <img src="${m.image}" class="profile-img">
                    <div class="profile-info">
                        <div style="font-weight:bold;">${m.name}</div>
                        <div style="font-size:11px; color:#999;">ğŸ‚ ${m.birth}</div>
                    </div>
                </div>
                ${renderStat('ë³´ì»¬', m.vocal, bonuses.vocal, 'var(--vocal)')}
                ${renderStat('ëŒ„ìŠ¤', m.dance, bonuses.dance, 'var(--dance)')}
                ${renderStat('ë¹„ì£¼ì–¼', m.visual, bonuses.visual, 'var(--visual)')}
                ${renderStat('ì˜ˆëŠ¥', m.variety, bonuses.variety, 'var(--variety)')}
                ${renderStat('ë§¤ë ¥', m.charm, bonuses.charm, 'var(--charm)')}
                <div class="equipped-items">${m.equipment.length > 0 ? m.equipment.map(e => `[+${e.level} ${e.name}]`).join(' ') : 'ì¥ë¹„ ì—†ìŒ'}</div>
                <div style="font-size:11px; text-align:right; color:#888;">í”¼ë¡œë„: ${m.fatigue}%</div>
            </div>`;
        }).join('');
    }

    function renderStat(label, base, bonus, color) {
        return `<div class="stat-row">
            <div class="stat-label">${label}</div>
            <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${(base + bonus) * 5}%; background:${color}"></div></div>
            <div style="font-size:10px;">${base}${bonus > 0 ? `<span class="bonus-stat">(+${bonus})</span>` : ''}</div>
        </div>`;
    }

    function renderHomeCharts(platform, period) {
        const container = document.getElementById('chart-list-container');
        const allSongs = [];
        gameState.rivalCharts.forEach(s => allSongs.push({...s, isPlayer: false}));
        gameState.activeCharts.forEach(s => { if(s.weekCount < 6) allSongs.push({artist: "HADES", ...s, isPlayer: true}); });

        const scoreKey = (period === 'monthly' ? 'displayMonthly' : (period === 'yearly' ? 'displayYearly' : 'daily'));
        
        allSongs.sort((a, b) => (b.scores[platform][scoreKey] || 0) - (a.scores[platform][scoreKey] || 0));
        
        container.innerHTML = allSongs.slice(0, 10).map((song, idx) => {
            const rank = idx + 1;
            let changeHtml = '<span class="rank-change">-</span>';
            if(period === 'daily' && song.prevRanks && song.prevRanks[platform]) {
                const diff = song.prevRanks[platform] - rank;
                if(diff > 0) changeHtml = `<span class="rank-change rank-up">â–²${diff}</span>`;
                else if(diff < 0) changeHtml = `<span class="rank-change rank-down">â–¼${Math.abs(diff)}</span>`;
            }
            return `
            <div class="chart-row ${song.isPlayer ? 'my-song' : ''}">
                <div class="rank">${rank}</div>
                ${changeHtml}
                <div class="song-info">
                    <span class="song-title">${song.title}</span>
                    <span class="artist-name">${song.artist}</span>
                </div>
                <div class="chart-score">${Math.floor(song.scores[platform][scoreKey] || 0).toLocaleString()}</div>
            </div>`;
        }).join('');
    }

    // === ë‹¤ìŒë‚ ë¡œ (ìˆ˜ì •: ìŠ¤íƒ¯ ìƒí•œì„  ë° ìŠ¤í¬ë¡¤ ë°©ì§€) ===
    function nextDay() {
        if (document.getElementById('eventModal').style.display === 'block') return;

        const actionsPool = ['vocal', 'dance', 'visual', 'variety', 'charm', 'rest'];
        gameState.members.forEach(m => {
            let action = m.manualAct || actionsPool[Math.floor(Math.random() * actionsPool.length)];
            let total = m.vocal + m.dance + m.visual + m.variety + m.charm;
            
            if (action === 'rest') {
                m.fatigue = Math.max(0, m.fatigue - 40);
            } else if (m.fatigue < 100) {
                // ê°œë³„ ëŠ¥ë ¥ì¹˜ 20, ì´í•© 100 ìƒí•œ ì ìš©
                if (m[action] < 20 && total < 100 && Math.random() < 0.4) {
                    m[action]++;
                    gameState.weeklyStats.push({ name: m.name, stat: action });
                }
                m.fatigue = Math.min(100, m.fatigue + 15);
            }
            m.manualAct = null;
        });

        processCharts();
        
        let dailyProfit = Math.floor(Math.random() * 500000) + 500000;
        gameState.finance += dailyProfit;
        gameState.accumulatedSales += dailyProfit;
        gameState.day++;

        updateDisplay();
        
        // ë¦¬í¬íŠ¸ í‘œì‹œ (í™”ë©´ ì´ë™ ìµœì†Œí™”)
        document.getElementById('profit-report').style.display = 'block';
        document.getElementById('profit-content').innerHTML = `ì¼ì¼ ìˆ˜ìµ: <span class="money-text">${dailyProfit.toLocaleString()}ì›</span>`;
        
        processNextPopup();
    }

    function calculateTierScore() {
        return gameState.fandom + Math.floor(gameState.youtube * 0.5) + Math.floor(gameState.accumulatedSales / 10000);
    }

    function getTierInfo(score) {
        if (score >= 10000000) return { name: "ì „ì„¸ê³„ì—ì„œ ì•Œë ¤ì§", class: "tier-world" };
        if (score >= 2000000) return { name: "êµ­ë‚´ì—ì„œ ì•Œë ¤ì§", class: "tier-domestic" };
        return { name: "ë£¨í‚¤", class: "tier-rookie" };
    }

    function openPage(pId, btn) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById(pId).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        if(pId === 'contents') renderContents();
        if(pId === 'store') renderShop();
    }

    function renderContents() {
        const container = document.getElementById('content-list');
        container.innerHTML = Object.values(contentTypes).map(c => {
            const remain = c.cooldown - (gameState.day - gameState.lastContents[c.id]);
            const isAvail = remain <= 0;
            return `<div class="content-card">
                <div class="content-header"><strong>${c.name}</strong><span class="content-badge ${c.badge}">${c.type}</span></div>
                <button class="content-btn ${isAvail ? 'btn-available' : 'btn-cooldown'}" onclick="${isAvail ? `executeContent('${c.id}')` : ''}">${isAvail ? 'ì œì‘í•˜ê¸°' : 'ì¤€ë¹„ ì¤‘'}</button>
            </div>`;
        }).join('');
    }

    function renderShop() {
        document.getElementById('shop-list').innerHTML = shopItems.map(item => `
            <div class="content-card">
                <div class="content-header"><strong>${item.name}</strong><span class="content-badge badge-item">${item.statKr} +${item.val}</span></div>
                <div class="content-info"><div>ğŸ’° ${item.price.toLocaleString()}ì›</div></div>
                <button class="content-btn ${gameState.finance >= item.price ? 'btn-available' : 'btn-cooldown'}" onclick="buyItem('${item.id}')">êµ¬ë§¤í•˜ê¸°</button>
            </div>
        `).join('');
    }

    function buyItem(id) {
        const item = shopItems.find(i => i.id === id);
        if(gameState.finance >= item.price) {
            gameState.finance -= item.price;
            gameState.inventory.push({ ...item, level: 0 });
            alert("êµ¬ë§¤ ì™„ë£Œ!");
            updateDisplay(); renderShop();
        }
    }

    function openEquipModal(mIdx) {
        const m = gameState.members[mIdx];
        document.getElementById('modal-title').innerText = `${m.name} ê´€ë¦¬`;
        let html = `<h4>ì°©ìš© ì¤‘ì¸ ì¥ë¹„</h4>`;
        html += m.equipment.map((eq, i) => `<div class="choice-btn"><span>${eq.name} (+${eq.level})</span><button onclick="unequipItem(${mIdx}, ${i})">í•´ì œ</button></div>`).join('');
        html += `<h4>ì°½ê³ </h4>`;
        html += gameState.inventory.map((eq, i) => `<button class="choice-btn" onclick="equipItem(${mIdx}, ${i})">${eq.name}</button>`).join('');
        document.getElementById('modal-body').innerHTML = html;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">ë‹«ê¸°</button>`;
        document.getElementById('eventModal').style.display = 'block';
    }

    function equipItem(mIdx, iIdx) {
        const item = gameState.inventory.splice(iIdx, 1)[0];
        gameState.members[mIdx].equipment.push(item);
        closeModal(); updateDisplay();
    }

    function unequipItem(mIdx, eIdx) {
        const item = gameState.members[mIdx].equipment.splice(eIdx, 1)[0];
        gameState.inventory.push(item);
        closeModal(); updateDisplay();
    }

    function closeModal() { document.getElementById('eventModal').style.display = 'none'; }
    function processNextPopup() {
        if (gameState.popupQueue.length > 0) {
            const pop = gameState.popupQueue.shift();
            document.getElementById('modal-title').innerText = pop.event.title;
            document.getElementById('modal-body').innerText = pop.event.desc;
            document.getElementById('modal-choices').innerHTML = pop.event.choices.map(c => `<button class="primary-btn" onclick="closeModal()">${c.text}</button>`).join('');
            document.getElementById('eventModal').style.display = 'block';
        }
    }

    function switchChartPlatform(p) { gameState.currentChartPlatform = p; updateDisplay(); }
    function switchChartPeriod(p) { gameState.currentChartPeriod = p; updateDisplay(); }

    window.addEventListener('keydown', e => { if (e.code === 'Space' && document.getElementById('start-page').style.display === 'none') nextDay(); });

</script>
</body>
</html>
