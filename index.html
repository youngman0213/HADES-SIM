<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í•˜ë°ìŠ¤ í‚¤ìš°ê¸° v11.0 (Custom Events Applied)</title>
    <style>
        :root { --bg: #f5f7fa; --card: #ffffff; --point: #ff4d94; --text: #333; --border: #e1e4e8; --success: #40c057; --vocal: #ff4d94; --dance: #ae3ec9; --visual: #4dadff; --variety: #fab005; --charm: #f06595; --money: #2b8a3e; --danger: #fa5252; --sns: #405de6; --yt: #ff0000; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; margin: 0; padding: 0; }
        .nav-bar { display: flex; background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; padding: 18px; border: none; background: transparent; color: #666; cursor: pointer; font-weight: bold; font-size: 14px; }
        .nav-btn.active { color: var(--point); border-bottom: 3px solid var(--point); background: #fffafc; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 20px 100px 20px; }
        .page { display: none; }
        .page.active { display: block; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); position: relative; }
        .date-display { position: absolute; top: 15px; right: 25px; text-align: right; }
        .day-count { font-weight: bold; color: var(--point); font-size: 18px; display: block; }
        .real-date { font-size: 12px; color: #888; }
        h2 { color: #222; font-size: 1.1rem; margin-top: 0; border-left: 4px solid var(--point); padding-left: 10px; margin-bottom: 15px; }
        .money-text { color: var(--money); font-weight: bold; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-item small { color: #777; font-size: 12px; }
        .stat-item strong { font-size: 16px; display: block; margin-top: 2px; }
        .comm-post { border-bottom: 1px solid #eee; padding: 12px 0; }
        .comm-site { font-size: 10px; font-weight: bold; padding: 2px 5px; border-radius: 4px; margin-right: 8px; }
        .site-ebem { background: #e7f5ff; color: #1971c2; }
        .site-cafe { background: #fff0f6; color: #d6336c; }
        .site-sns { background: #f0f1ff; color: var(--sns); }
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 15px; }
        .member-card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 15px; }
        .stat-row { display: flex; align-items: center; margin-bottom: 5px; font-size: 12px; }
        .stat-label { width: 45px; color: #777; }
        .stat-bar-bg { flex: 1; height: 6px; background: #eee; border-radius: 3px; overflow: hidden; margin: 0 8px; }
        .stat-bar-fill { height: 100%; border-radius: 3px; transition: 0.5s; }
        .primary-btn { width: 100%; padding: 15px; background: var(--point); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .choice-btn { width: 100%; padding: 12px; background: #f1f3f5; color: #333; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; margin-bottom: 8px; text-align: left; font-size: 14px; }
        .choice-btn:hover { background: #e9ecef; }
        .next-day-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid var(--border); text-align: center; z-index: 100; }
        .modal-overlay { display: none; position: fixed; z-index: 2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal-content { background:white; margin:10% auto; padding:30px; width:450px; border-radius:20px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div class="nav-bar">
    <button class="nav-btn active" onclick="openPage('home', this)">ğŸ“Š í™ˆ</button>
    <button class="nav-btn" onclick="openPage('members', this)">ğŸ‘¥ ë©¤ë²„í˜„í™©</button>
    <button class="nav-btn" onclick="openPage('manual', this)">ğŸ“… ìˆ˜ë™ì§€ì‹œ</button>
</div>

<div class="container">
    <div id="home" class="page active">
        <div class="card">
            <div class="date-display">
                <span class="day-count">ìš´ì˜ <span id="current-day">1</span>ì¼ì°¨</span>
                <span class="real-date" id="current-date">2025-09-05</span>
            </div>
            <h2>ìƒíƒœ</h2>
            <div class="stat-grid">
                <div class="stat-item"><small>ë³´ìœ  ìì‚°</small><strong id="p-finance" class="money-text">200,000,000</strong></div>
                <div class="stat-item"><small>ì¼€ë¡œ íŒ¬ë¤ìˆ˜</small><strong id="p-fandom">12,405</strong></div>
                <div class="stat-item"><small>ë„ˆíŠœë¸Œ êµ¬ë…ì</small><strong id="p-youtube">8,200</strong></div>
                <div class="stat-item"><small>SNS íŒ”ë¡œì›Œ</small><strong id="p-sns">15,300</strong></div>
            </div>
        </div>
        <div class="card" id="profit-report" style="display:none; background: #f2fcf0; border-color: #40c057;">
            <h2>ğŸˆ ìˆ˜ìµ ë¦¬í¬íŠ¸ </h2>
            <div id="profit-content" style="font-size: 14px;"></div>
        </div>
        <div class="card">
            <h2>ğŸŒ ì‹¤ì‹œê°„ ì»¤ë®¤ë‹ˆí‹° / SNS </h2>
            <div id="comm-container"></div>
        </div>
    </div>
    <div id="members" class="page">
        <div class="member-grid" id="member-grid-container"></div>
    </div>
    <div id="manual" class="page">
        <div class="card">
            <h2>ìˆ˜ë™ ì§€ì‹œ </h2>
            <select id="sel-member" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px;"></select>
            <select id="sel-stat" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px;">
                <option value="vocal">ğŸ¤ ë³´ì»¬ ì§‘ì¤‘ í›ˆë ¨</option>
                <option value="dance">ğŸ’ƒ ì•ˆë¬´ ì—°ìŠµ</option>
                <option value="visual">âœ¨ ë¹„ì£¼ì–¼ ì¼€ì–´</option>
                <option value="variety">ğŸ—£ï¸ ì˜ˆëŠ¥ ìŠ¤í”¼ì¹˜</option>
                <option value="charm">ğŸ€ ë§¤ë ¥ ê°•í™”</option>
                <option value="stream">ğŸ“¡ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</option>
                <option value="rest">ğŸ’¤ ê¿€ê°™ì€ íœ´ì‹</option>
            </select>
            <button class="primary-btn" onclick="manualTrainAction()">ì§€ì‹œ ì™„ë£Œ</button>
        </div>
    </div>
</div>

<div class="next-day-bar"><button class="primary-btn" style="background: #40c057; width: auto; padding: 12px 40px;" onclick="nextDay()">ğŸŒ™ ë‹¤ìŒë‚ ë¡œ (Space)</button></div>
<div id="eventModal" class="modal-overlay"><div class="modal-content"><h2 id="modal-title"></h2><div id="modal-body" style="margin: 20px 0;"></div><div id="modal-choices"></div></div></div>

<script>
    let gameState = {
        day: 1, startDate: new Date('2025-09-05'), finance: 200000000, fandom: 12405, youtube: 8200, sns: 15300,
        members: [
            {name: 'í‚¤ë§ˆ', birth: '04-22', vocal: 11, dance: 10, visual: 10, variety: 9, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ëµê·¤', birth: '12-24', vocal: 11, dance: 10, visual: 10, variety: 9, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ì±ˆë‚˜', birth: '02-26', vocal: 9, dance: 10, visual: 11, variety: 9, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ì†œì£¼ë¨¹', birth: '11-11', vocal: 9, dance: 10, visual: 10, variety: 11, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ì—°ì´ˆë¡', birth: '03-26', vocal: 11, dance: 10, visual: 10, variety: 10, charm: 10, fatigue: 10, manualAct: null},
        ],
        community: [], weeklyLog: [], popupQueue: []
    };

    const ebemMsgs = ["í•˜ë°ìŠ¤ ì–´ì œ ë±…ì†¡ í¼ ë¯¸ì³¤ë”ë¼", "ì•„ë°”íƒ€ ì´ë²ˆì— ì—…ëƒí•¨?", "ë™ê¸°í™” ë°€ë¦¬ëŠ”ê±° ë‚˜ë§Œ ëŠë‚Œ?", "ì—°ì´ˆë¡ ì´ë²ˆ ë¹¨ê°„ì•½ ì°Œë¼ì‹œ ë­ì„?", "í•˜ë°ìŠ¤ ë©¤ë²„ë“¤ ë³¸ì²´ ê¶ê¸ˆí•´ ì£½ê² ë„¤", "ì˜¤ëŠ˜ ì†œì£¼ë¨¹ íŠ¸ë˜í‚¹ ê°œì˜ë¨", "ëµê·¤ ëª©ì†Œë¦¬ ë¯¹ì‹± ë°”ê¿¨ë‚˜?", "ì±ˆë‚˜ ëª¨ë¸ë§ í…ìŠ¤ì²˜ ê°œê³ í€„ì„", "ì—ë±€ í•˜ë°ìŠ¤ ì–¸ê¸‰ëŸ‰ ë³´ì†Œ ã…‹ã…‹", "í‚¤ë§ˆ ë…¸ë˜ë±… ë‹¤ì‹œë³´ê¸° ë‚´ë†”ë¼", "ë²„íŠœë²„ 1êµ° ê°€ì¦ˆì•„", "í•˜ë°ìŠ¤ ì´ë²ˆì£¼ íœ´ë°© ì‹¤í™”ëƒ", "ê³µì‹ êµ¿ì¦ˆ ì¥íŒ¨ë“œ ì‚¬ê³ ì‹¶ë‹¤", "ë¹„ì£¼ì–¼ ë¯¸í™” ì‹¤í™”ëƒ?", "íŠ¸ë˜ì»¤ íŠ€ëŠ”ê±° ê°œì›ƒê¹€ ã…‹ã…‹", "í•˜ë°ìŠ¤ ë‚™ìˆ˜íš¨ê³¼ ã„·ã„·", "ì´ë²ˆ ì¼ëŸ¬ë ˆ ëˆ„êµ¬ì„? ê¸ˆì†ì´ë„¤", "í•˜ë°ìŠ¤ ëŒ€í‘œ ì¼ ì˜í•˜ëŠ”ë“¯", "ë²„ì¸„ì–¼ ì•„ì´ëŒ ì›íƒ‘ ê°€ì", "ì˜¤ëŠ˜ë„ í•˜ë°ìŠ¤ì— ë¨¸ê°€ë¦¬ ê¹¨ì§", "ì—°ì´ˆë¡ ìºë¦­í„° ê·€ë‘ ê¼¬ë¦¬ ëŒ€ë°•", "ì†œì£¼ë¨¹ ì˜ˆëŠ¥ ìŠ¤í”¼ì¹˜ í•™ì› ë‹¤ë‹˜?", "ì±ˆë‚˜ ë¼ì´íˆ¬ë”” ë¶€ë“œëŸ¬ìš´ê±° ë³´ì†Œ", "ëµê·¤ ì´ë²ˆ ì»¤ë²„ê³¡ ë ˆì „ë“œ", "í•˜ë°ìŠ¤ ë±…ì†¡ ë„ë„¤ í™”ë ¥ ë³´ì†Œ", "ì•ˆì˜ ì‚¬ëŒ ëˆ„êµ¬ë“  ìƒê´€ì—†ë‹¤", "í•˜ë°ìŠ¤ ëª¨ë¸ë§ ëœ¯ì–´ë³´ê³  ì‹¶ë„¤", "ì˜¤ëŠ˜ ë¦¬ê¹… ëŒ€ë°•ì„", "í•˜ë°ìŠ¤ íŒ¬ë¤ ì‹¸ì›€ë‚¨?", "ë²„íŠœë²„ ì‹œì¥ ì •ë³µ ê°€ì"];
    const cafeMsgs = ["ì¼€ë¡œ 1ê¸° ê°€ì…ì¸ì‚¬ ë“œë¦½ë‹ˆë‹¤!", "ì„œí¬íŠ¸ ë„ì‹œë½ ì „ë‹¬ ì™„ë£Œëë‚˜ìš”?", "ì˜¤ëŠ˜ ë±…ì†¡ í›„ê¸°.. ê°“ë²½í–ˆë‹¤", "í•˜ë°ìŠ¤ êµ¿ì¦ˆ ê³µêµ¬í•´ìš”", "ì¹´í˜ í™œë™ ë“±ê¸‰ì—… ë¶€íƒë“œë ¤ìš”", "ë©¤ë²„ë“¤ ëª© ê´€ë¦¬ ì˜í–ˆìœ¼ë©´ ã… ã… ", "í•˜ë°ìŠ¤ ì‘ì›ë²• ì™¸ì›Œì˜¤ì„¸ìš”", "íŒ¬ì•„íŠ¸ ê·¸ë ¤ë´¤ìŠµë‹ˆë‹¤!", "ì˜¤ëŠ˜ í•˜ë°ìŠ¤ ì‹¤ë¶ 1ìœ„ ì¶•í•˜!", "íŒ¬ë¯¸íŒ… VRë¡œ í•˜ë‚˜ìš”?", "í•˜ë°ìŠ¤ ë‹¬ë ¥ ë„ì°© ì¸ì¦", "ì‚¬ë‘í•´ í•˜ë°ìŠ¤ ì˜ì›í•˜ì", "ëµê·¤ ìƒì¼ ê´‘ê³  ìœ„ì¹˜ ì–´ë””ì„?", "í‚¤ë§ˆ ëª©ì†Œë¦¬ ë“¤ìœ¼ëŸ¬ ë˜ ì˜´", "ì—°ì´ˆë¡ íŒ¬ì¹´í˜ ì±„íŒ…ë°© ëŒ€ë°•", "ì†œì£¼ë¨¹ ì‘ì›ë´‰ ì˜ˆì˜ë‹¤", "ì±ˆë‚˜ ì›ƒìŒì†Œë¦¬ ë²¨ì†Œë¦¬ í•˜ê³  ì‹¶ìŒ", "í•˜ë°ìŠ¤ ëŒ€í‘œë‹˜ ê°ì‚¬í•©ë‹ˆë‹¤", "ê³µì‹ ì¹´í˜ í™”ë ¥ ì¥ë‚œì•„ë‹ˆë„¤", "ì´ê²Œ ë°”ë¡œ í•˜ë°ìŠ¤ë‹¤", "ì˜¤ëŠ˜ ë±…ì†¡ì—ì„œ ë‚´ ë„ë„¤ ì½ì–´ì¤Œ!", "í•˜ë°ìŠ¤ ë©¤ë²„ë“¤ í‘¹ ì‰¬ê¸¸", "íŒ¬ì¹´í˜ ì •ëª¨ í•˜ì‹¤ ë¶„?", "í•˜ë°ìŠ¤ ì„¸ê³„ê´€ ì •ë¦¬ë³¸", "êµ¿ì¦ˆ í’ˆì ˆ ì‹¤í™”ì¸ê°€ìš”", "í•˜ë°ìŠ¤ë‘ ì†Œí†µí•´ì„œ í–‰ë³µí•¨", "ë²„ì¸„ì–¼ ì•„ì´ëŒ ëíŒì™•", "íŒ¬ì¹´í˜ ì´ë²¤íŠ¸ ì°¸ì—¬ ì™„ë£Œ", "ë©¤ë²„ë“¤ ì‚¬ë‘í•´!", "í•˜ë°ìŠ¤ 1ì£¼ë…„ ê¸°ë‹¤ë ¤ì§"];
    const snsComments = ["ì˜¤ëŠ˜ ëª¨ë¸ë§ í…ìŠ¤ì²˜ ë ˆì „ë“œ", "ë¼ì´íˆ¬ë”” ë¦¬ê¹… ëˆ„ê°€í•¨? ê°œë¶€ë“œëŸ¬ì›€", "ìºë¦­í„° ë¯¸ëª¨ì— ëˆˆë©€ë“¯", "ë™ê¸°í™”ìœ¨ 400% ã„·ã„·", "ì•„ë°”íƒ€ ì…€ì¹´ í•„í„° ì”Œìš´ê±°ì„? ê°œì˜ˆì˜ë„¤", "ì˜¤ëŠ˜ ë±…ì†¡ ê¸°ëŒ€í• ê²Œìš”!", "ë³¸ì²´ë‹˜ ì—´ì¼í•˜ë„¤ ì§„ì§œ", "ëª¨ë¸ë§ì—ì„œ ë¹›ì´ ë‚œë‹¤", "ì´ ë¹„ì£¼ì–¼ë¡œ ë°ë·”í•´ì¤˜ì„œ ì••ë„ì  ê°ì‚¬", "ë™ê¸°í™” ë°€ë ¤ë„ ê·€ì—¬ì›€ ã…‹ã…‹", "í•˜ë°ìŠ¤ ë©¤ë²„ë“¤ í…ìŠ¤ì²˜ ì‹¤í™”?", "ë²„ì¸„ì–¼ ì•„ì´ëŒ ë§ëƒ? ë¯¸ëª¨ ë¬´ì—‡", "íŠ¸ë˜í‚¹ íŠ€ëŠ”ê²ƒë„ ì»¨í…ì¸ ë‹¤", "ë¦¬ê¹… ì¥ì¸ ëˆ„êµ¬ì„? ì ˆí•˜ê³  ì‹¶ë‹¤", "ì˜¤ëŠ˜ë„ ë‚´ ì‹¬ì¥ì„ ì €ê²©í•˜ëŠ” ëª¨ë¸ë§", "í•˜ë°ìŠ¤ íŒ¬ì´ë¼ í–‰ë³µí•´ìš”", "ì…€ì¹´ ê°ë„ ì²œì¬ë„¤", "ì´ë²ˆ ì—…ëƒëœ ì˜ìƒ ì°°ë–¡ì„", "ìºë¦­í„°ì— ì˜í˜¼ì„ ë°”ì³¤ë‹¤", "ë™ê¸°í™” ì˜¤ë¥˜ë„ ì‚¬ë‘ìŠ¤ëŸ¬ì›€"];
    const snsPostThemes = ["ì˜¤ëŠ˜ ì•„ë°”íƒ€ ì…€ì¹´ ì—…ë°ì´íŠ¸!", "ë…¹ìŒì‹¤ì—ì„œ í•œ ì»·! ê¸°ëŒ€í•´ ì£¼ì„¸ìš”ğŸ¤", "ì•ˆë¬´ ì—°ìŠµ ë!", "ì˜¤ëŠ˜ ì•¼ì‹ì€ 0ì¹¼ë¡œë¦¬ ê°„ì‹.. ë§›ìˆê² ì£ ?ğŸ•", "ì‡¼ì¸  ì´¬ì˜ ì¤‘!", "ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ì¤‘ í•œ ì»·!", "ìƒˆë¡œìš´ ì˜ìƒ í”¼íŒ…í•´ë´¤ì–´ìš”!", "íŒ¬ì•„íŠ¸ ë³´ëŠ” ì¤‘! ë„ˆë¬´ ê°ë™ì´ì•¼..ğŸ¨", "ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ 10ë¶„ ì „!", "ë©¤ë²„ë“¤ì´ë‘ ë‹¤ê°™ì´ ìˆ˜ë‹¤ íƒ€ì„!âœ¨", "ì•„ì¹¨ ìš´ë™ ì™„ë£Œ!", "ì–´ì œ ë°©ì†¡ ë‹¤ì‹œë³´ê¸° í•˜ëŠ” ì¤‘..ğŸ˜­", "êµ¬ë…ì 10ë§Œ ê°€ì!â¤ï¸", "ë¹„ì£¼ì–¼ ì¼€ì–´ ë°›ëŠ” ë‚ !âœ¨", "ì»¤ë²„ê³¡ ë…¹ìŒ ì¤‘ì¸ë° ë„ˆë¬´ ì–´ë ¤ì›Œìš”ã… ã… ğŸ¶", "ì¹´í˜ì—ì„œ ì ì‹œ íœ´ì‹..â˜•", "êµ¿ì¦ˆ ìƒ˜í”Œ ë„ì°©!ğŸ", "ëŒ€ê¸°ì‹¤ì—ì„œ ë© ë•Œë¦¬ê¸°..ğŸ’­", "ë²„ì¸„ì–¼ ì„¸ìƒì€ ì˜¤ëŠ˜ë„ í‰í™”ë¡­ìŠµë‹ˆë‹¤ğŸŒˆ", "ê¹œì§ ë±…ì†¡ ì˜ˆê³ !ğŸŒ™"];
    const ytComments = Array.from({length: 30}, (_, i) => `ë„ˆíŠœë¸Œ íŒ¬ ë°˜ì‘ #${i+1}: í•˜ë°ìŠ¤ ì˜ìƒ í€„ë¦¬í‹° ëŒ€ë°•! ì¡°íšŒìˆ˜ ë–¡ìƒ ê°€ì!`);

    // ëŒ€í‘œë‹˜ì´ ì „ë‹¬í•´ì£¼ì‹  ì´ë²¤íŠ¸ ë°ì´í„°
    const virtualEvents = [
        { id: 'server', title: "ğŸ’» ì„œë²„ ë ‰ ë°œìƒ", desc: "ë°©ì†¡ ì¤‘ ì„œë²„ê°€ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤.", choices: [{ text: "ì„œë²„ ì¦ì„¤ (-500ë§Œ/íŒ¬ë¤+2000)", effect: () => { gameState.finance -= 5000000; updateFandom(2000); } }, { text: "ë°©ì¢… (íŒ¬ë¤-1000)", effect: () => { updateFandom(-1000); } }, { text: "ë°©ì¹˜ (íŒ¬ë¤-2000)", effect: () => { updateFandom(-2000); } }] },
        { id: 'costume', title: "ğŸ‘— ì‹ ê·œ ì˜ìƒ", desc: "ê³ í€„ë¦¬í‹° ì•„ë°”íƒ€ ì˜ìƒì„ ì œì‘í• ê¹Œìš”?", choices: [{ text: "í”„ë¦¬ë¯¸ì—„ (-1500ë§Œ/íŒ¬ë¤+8000)", effect: () => { gameState.finance -= 15000000; updateFandom(8000); } }, { text: "ë³´ê¸‰í˜• (-500ë§Œ/íŒ¬ë¤+2000)", effect: () => { gameState.finance -= 5000000; updateFandom(2000); } }, { text: "ë³´ë¥˜ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'copyright', title: "ğŸ¤ ì €ì‘ê¶Œ ê²½ê³ ", desc: "ì»¤ë²„ê³¡ ì˜ìƒì— ë…¸ë€ ë”±ì§€ê°€ ë¶™ì—ˆìŠµë‹ˆë‹¤.", choices: [{ text: "ê³„ì•½ ì²´ê²° (-300ë§Œ/íŒ¬ë¤+1500)", effect: () => { gameState.finance -= 3000000; updateFandom(1500); } }, { text: "ì˜ìƒ ì‚­ì œ (íŒ¬ë¤-500)", effect: () => { updateFandom(-500); } }, { text: "ë¬´ëŒ€ì‘ (íŒ¬ë¤-1200)", effect: () => { updateFandom(-1200); } }] },
        { id: 'contest', title: "ğŸ¨ íŒ¬ì•„íŠ¸ ê³µëª¨ì „", desc: "ê³µì‹ ê³µëª¨ì „ì„ í†µí•´ ê´€ì‹¬ì„ ëª¨ìë‹ˆë‹¤.", choices: [{ text: "ëŒ€ê·œëª¨ (-1000ë§Œ/íŒ¬ë¤+10000)", effect: () => { gameState.finance -= 10000000; updateFandom(10000); } }, { text: "ì†Œê·œëª¨ (-200ë§Œ/íŒ¬ë¤+3000)", effect: () => { gameState.finance -= 2000000; updateFandom(3000); } }, { text: "ì·¨ì†Œ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'gear', title: "ğŸ•¶ï¸ ì¥ë¹„ ê³ ì¥", desc: "í’€íŠ¸ë˜í‚¹ ì¥ë¹„ê°€ ì˜¤ì‘ë™í•©ë‹ˆë‹¤.", choices: [{ text: "ìµœê³ ê¸‰ êµì²´ (-1000ë§Œ/íŒ¬ë¤+3000)", effect: () => { gameState.finance -= 10000000; updateFandom(3000); } }, { text: "ë¶€ë¶„ ìˆ˜ë¦¬ (-300ë§Œ)", effect: () => { gameState.finance -= 3000000; } }, { text: "ë°©ì¹˜ (í”¼ë¡œë„+20)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+20)); } }] },
        { id: 'collab', title: "ğŸŒŸ íƒ€ ìœ íŠœë²„ í•©ë°©", desc: "ëŒ€ê¸°ì—… ë²„íŠœë²„ê°€ í•©ë°©ì„ ì œì˜í–ˆìŠµë‹ˆë‹¤.", choices: [{ text: "ìœ ë£Œ ê´‘ê³  ë™ë°˜ (-500ë§Œ/íŒ¬ë¤+6000)", effect: () => { gameState.finance -= 5000000; updateFandom(6000); } }, { text: "ì¼ë°˜ ì°¸ì—¬ (íŒ¬ë¤+2500)", effect: () => { updateFandom(2500); } }, { text: "ê±°ì ˆ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'goldfan', title: "ğŸ–Œï¸ ê¸ˆì† ì‘ê°€ì˜ íŒ¬ì•„íŠ¸", desc: "ìœ ëª… ì‘ê°€ê°€ í•˜ë°ìŠ¤ íŒ¬ì•„íŠ¸ë¥¼ ê²Œì‹œí–ˆìŠµë‹ˆë‹¤!", choices: [{ text: "ë©”ì¸ ê²Œì‹œ (-100ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 1000000; updateFandom(5000); } }, { text: "ë‹¨ìˆœ ê³µìœ  (íŒ¬ë¤+2000)", effect: () => { updateFandom(2000); } }, { text: "ë¬´ì‹œ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'ai', title: "ğŸ¤– AI ë³´ì´ìŠ¤ ë…¼ë€", desc: "ì•ˆí‹°ë“¤ì´ AI ì‚¬ìš© ì˜í˜¹ì„ ì œê¸°í•©ë‹ˆë‹¤.", choices: [{ text: "ì „ë¬¸ í•´ëª… ë°©ì†¡ (-200ë§Œ/íŒ¬ë¤+3000)", effect: () => { gameState.finance -= 2000000; updateFandom(3000); } }, { text: "ì§§ì€ ê³µì§€ (íŒ¬ë¤+500)", effect: () => { updateFandom(500); } }, { text: "ë¬´ëŒ€ì‘ (íŒ¬ë¤-1500)", effect: () => { updateFandom(-1500); } }] },
        { id: 'game', title: "ğŸ® ê²Œì„ ëŒ€íšŒ", desc: "ë²„ì¶”ì–¼ ë¡¤ ëŒ€íšŒì— ì´ˆì²­ë°›ì•˜ìŠµë‹ˆë‹¤.", choices: [{ text: "íŒ€ ìŠ¤í°ì„œì‹­ (-700ë§Œ/íŒ¬ë¤+8000)", effect: () => { gameState.finance -= 7000000; updateFandom(8000); } }, { text: "ê°œì¸ ì°¸ê°€ (íŒ¬ë¤+1800)", effect: () => { updateFandom(1800); } }, { text: "ë¶ˆì°¸ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'asmr', title: "ğŸ§ ASMR ê¸°íš", desc: "ìƒˆë²½ ASMR ë°©ì†¡ì„ ì¤€ë¹„í• ê¹Œìš”?", choices: [{ text: "ì¥ë¹„ í’€ì„¸íŠ¸ (-800ë§Œ/íŒ¬ë¤+6000)", effect: () => { gameState.finance -= 8000000; updateFandom(6000); } }, { text: "ê¸°ì¡´ ì¥ë¹„ (íŒ¬ë¤+1000)", effect: () => { updateFandom(1000); } }, { text: "ì·¨ì†Œ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'goods', title: "ğŸ§¸ ê³µì‹ êµ¿ì¦ˆ", desc: "ë´‰ì œ ì¸í˜• êµ¿ì¦ˆ ì œì‘ ì˜ë¢°ê°€ ì™”ìŠµë‹ˆë‹¤.", choices: [{ text: "í•œì •íŒ ì œì‘ (-1000ë§Œ/íŒ¬ë¤+12000)", effect: () => { gameState.finance -= 10000000; updateFandom(12000); } }, { text: "ì¼ë°˜íŒ ì œì‘ (-500ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 5000000; updateFandom(5000); } }, { text: "ê±°ì ˆ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'shorts', title: "ğŸ“‰ ìœ íŠœë¸Œ ì•Œê³ ë¦¬ì¦˜", desc: "ì•Œê³ ë¦¬ì¦˜ì„ ìœ„í•´ ìˆì¸ ë¥¼ ì–‘ì‚°í• ê¹Œìš”?", choices: [{ text: "ì „ë¬¸ ì—…ì²´ (-400ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 4000000; updateFandom(5000); } }, { text: "ì§ì ‘ í¸ì§‘ (íŒ¬ë¤+2000/í”¼ë¡œë„+20)", effect: () => { updateFandom(2000); gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+20)); } }, { text: "ì¤‘ë‹¨ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'chat', title: "ğŸš« ì±„íŒ…ì°½ í…ŒëŸ¬", desc: "ìƒë°©ì†¡ ì¤‘ ì•…í”ŒëŸ¬ë“¤ì´ ë‚œì…í–ˆìŠµë‹ˆë‹¤.", choices: [{ text: "ë³´ì•ˆ ì‹œìŠ¤í…œ (-300ë§Œ/íŒ¬ë¤+2000)", effect: () => { gameState.finance -= 3000000; updateFandom(2000); } }, { text: "ì„ì‹œ ì°¨ë‹¨ (íŒ¬ë¤+500)", effect: () => { updateFandom(500); } }, { text: "ë°©ê´€ (íŒ¬ë¤-2000)", effect: () => { updateFandom(-2000); } }] },
        { id: 'ad', title: "ğŸŒŒ ì˜¤í”„ë¼ì¸ ì „ê´‘íŒ", desc: "ì§€í•˜ì² ì—­ ê´‘ê³ ë¥¼ ì§„í–‰í• ê¹Œìš”?", choices: [{ text: "ëŒ€í˜• ì „ê´‘íŒ (-2000ë§Œ/íŒ¬ë¤+15000)", effect: () => { gameState.finance -= 20000000; updateFandom(15000); } }, { text: "ì†Œí˜• ì „ê´‘íŒ (-800ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 8000000; updateFandom(5000); } }, { text: "ë³´ë¥˜ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'mix', title: "ğŸ¤ ë³´ì»¬ ë¯¹ì‹± ì™¸ì£¼", desc: "ì»¤ë²„ê³¡ í€„ë¦¬í‹°ë¥¼ ìœ„í•´ ë¯¹ì‹±ì„ ë§¡ê¹ë‹ˆë‹¤.", choices: [{ text: "ìœ ëª… ìŠ¤íŠœë””ì˜¤ (-400ë§Œ/íŒ¬ë¤+3000)", effect: () => { gameState.finance -= 4000000; updateFandom(3000); } }, { text: "ê°œì¸ í”„ë¦¬ëœì„œ (-100ë§Œ/íŒ¬ë¤+1000)", effect: () => { gameState.finance -= 1000000; updateFandom(1000); } }, { text: "ìì²´ ì‘ì—… (í”¼ë¡œë„+10)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+10)); } }] },
        { id: 'popup', title: "ğŸ›ï¸ ì‡¼í•‘ëª° íŒì—…ìŠ¤í† ì–´", desc: "ëŒ€í˜• ì‡¼í•‘ëª° íŒì—… ì œì˜ê°€ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤!", choices: [{ text: "ë‹¨ë… ê°œìµœ (-2500ë§Œ/íŒ¬ë¤+20000)", effect: () => { gameState.finance -= 25000000; updateFandom(20000); } }, { text: "ì†Œê·œëª¨ ë¶€ìŠ¤ (-800ë§Œ/íŒ¬ë¤+6000)", effect: () => { gameState.finance -= 8000000; updateFandom(6000); } }, { text: "ê±°ì ˆ (ì—†ìŒ)", effect: () => {} }] },
        { id: 'rumor', title: "ğŸ­ ë©¤ë²„ê°„ ë¶ˆí™”ì„¤", desc: "ë°©ì†¡ ì¤‘ í‘œì • ê´€ë¦¬ ì•ˆ ëœ ì¥ë©´ì´ í¼ì¡ŒìŠµë‹ˆë‹¤.", choices: [{ text: "í•©ë™ í† í¬ì‡¼ (-200ë§Œ/íŒ¬ë¤+4000)", effect: () => { gameState.finance -= 2000000; updateFandom(4000); } }, { text: "ì§§ì€ ì‡¼ì¸  (íŒ¬ë¤+1500)", effect: () => { updateFandom(1500); } }, { text: "ì¹¨ë¬µ (íŒ¬ë¤-1000)", effect: () => { updateFandom(-1000); } }] },
        { id: 'power', title: "âš¡ ì „ë ¥ ëˆ„ì „", desc: "ìŠ¤íŠœë””ì˜¤ ì •ì „ìœ¼ë¡œ ë°©ì†¡ì´ ëŠê²¼ìŠµë‹ˆë‹¤.", choices: [{ text: "ìµœê³ ê¸‰ UPS (-500ë§Œ)", effect: () => { gameState.finance -= 5000000; } }, { text: "ì¼ë°˜ ìˆ˜ë¦¬ (-100ë§Œ)", effect: () => { gameState.finance -= 1000000; } }, { text: "ëŒ€ê¸° (íŒ¬ë¤-1000)", effect: () => { updateFandom(-1000); } }] },
        { id: 'meeting', title: "ğŸ ëŒ€ê·œëª¨ íŒ¬ë¯¸íŒ…", desc: "ì²« ì˜¤í”„ë¼ì¸ íŒ¬ë¯¸íŒ…ì„ ê³„íší•©ë‹ˆë‹¤.", choices: [{ text: "ëŒ€ê´€ ì»¨ë²¤ì…˜ (-3500ë§Œ/íŒ¬ë¤+35000)", effect: () => { gameState.finance -= 35000000; updateFandom(35000); } }, { text: "ì¤‘í˜• í™€ (-1500ë§Œ/íŒ¬ë¤+12000)", effect: () => { gameState.finance -= 15000000; updateFandom(12000); } }, { text: "ì˜¨ë¼ì¸ ëŒ€ì²´ (íŒ¬ë¤+3000)", effect: () => { updateFandom(3000); } }] },
        { id: 'gen2', title: "ğŸ†• ì‹ ì¸ ë°œêµ´", desc: "2ê¸°ìƒ ì˜¤ë””ì…˜ ë£¨ë¨¸ê°€ ëŒê³  ìˆìŠµë‹ˆë‹¤.", choices: [{ text: "í™•ì¥ íˆ¬ì (-1000ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 10000000; updateFandom(5000); } }, { text: "1ê¸° ì§‘ì¤‘ ì„ ì–¸ (íŒ¬ë¤+3000)", effect: () => { updateFandom(3000); } }, { text: "ë¬´ëŒ€ì‘ (íŒ¬ë¤-500)", effect: () => { updateFandom(-500); } }] }
    ];

    window.addEventListener('keydown', e => { 
        if (e.code === 'Space') {
            const modal = document.getElementById('eventModal');
            if (modal.style.display === 'block') return;
            nextDay();
        }
    });

    function updateFandom(val) {
        gameState.fandom = Math.max(0, gameState.fandom + val);
        gameState.youtube += Math.floor(val * 0.7);
        gameState.sns += Math.floor(val * 1.2);
    }

    function updateDisplay() {
        document.getElementById('current-day').innerText = gameState.day;
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        document.getElementById('current-date').innerText = d.toISOString().split('T')[0];
        document.getElementById('p-finance').innerText = gameState.finance.toLocaleString();
        document.getElementById('p-fandom').innerText = gameState.fandom.toLocaleString();
        document.getElementById('p-youtube').innerText = gameState.youtube.toLocaleString();
        document.getElementById('p-sns').innerText = gameState.sns.toLocaleString();
        
        document.getElementById('member-grid-container').innerHTML = gameState.members.map(m => `
            <div class="member-card" style="${m.fatigue >= 100 ? 'border-color:var(--danger); background:#fff5f5;' : ''}">
                <div style="display:flex; justify-content:space-between;"><strong>${m.name}</strong><span style="font-size:10px; color:#999;">ğŸ‚ ${m.birth}</span></div>
                ${renderStat('ë³´ì»¬',m.vocal,'var(--vocal)')}${renderStat('ëŒ„ìŠ¤',m.dance,'var(--dance)')}${renderStat('ë¹„ì£¼ì–¼',m.visual,'var(--visual)')}${renderStat('ì˜ˆëŠ¥',m.variety, 'var(--variety)')}${renderStat('ë§¤ë ¥',m.charm,'var(--charm)')}
                <div style="font-size:11px; text-align:right; color:${m.fatigue >= 100 ? 'var(--danger)' : '#888'};">í”¼ë¡œë„: ${m.fatigue}%</div>
            </div>
        `).join('');
        document.getElementById('comm-container').innerHTML = gameState.community.map(c => `
            <div class="comm-post"><span class="comm-site ${c.site==='SNS'?'site-sns':(c.site==='ì—ë±€'?'site-ebem':'site-cafe')}">${c.site}</span><div style="font-size:13px; margin-top:4px;">${c.content}</div></div>
        `).reverse().join('');

        const sel = document.getElementById('sel-member');
        if(sel.options.length === 0) gameState.members.forEach(m => sel.innerHTML += `<option value="${m.name}">${m.name}</option>`);
    }

    function renderStat(l, v, c) {
        return `<div class="stat-row"><div class="stat-label">${l}</div><div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${(v/20)*100}%; background:${v>=20?'#333':c}"></div></div><div style="font-size:10px;">${v}</div></div>`;
    }

    function nextDay() {
        let totalProfit = Math.floor(Math.random() * 600001) + 400000;
        const actionsPool = ['vocal', 'dance', 'visual', 'variety', 'charm', 'rest'];

        gameState.members.forEach(m => {
            let action = m.manualAct || actionsPool[Math.floor(Math.random() * actionsPool.length)];
            if (action === 'rest') { m.fatigue = Math.max(0, m.fatigue - 25); m.manualAct = null; return; }
            if (m.fatigue >= 100) { m.manualAct = null; return; }
            if (m[action] < 20 && Math.random() < 0.3) { m[action]++; m.fatigue = Math.min(100, m.fatigue + 15); }
            else { m.fatigue = Math.min(100, m.fatigue + 10); }
            m.manualAct = null;
        });

        if (Math.random() < 0.4) gameState.community.push({site:'ì—ë±€', content: ebemMsgs[Math.floor(Math.random()*ebemMsgs.length)]});
        if (Math.random() < 0.4) gameState.community.push({site:'íŒ¬ì¹´í˜', content: cafeMsgs[Math.floor(Math.random()*cafeMsgs.length)]});
        
        const weekDay = (gameState.day - 1) % 7;
        if (weekDay < 5) {
            const m = gameState.members[weekDay];
            const theme = snsPostThemes[Math.floor(Math.random() * snsPostThemes.length)];
            gameState.community.push({site:'SNS', content: `ğŸ“± @${m.name}: ${theme} (ëŒ“ê¸€: ${snsComments[Math.floor(Math.random()*snsComments.length)]})`});
        }

        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        let dateStr = `${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        gameState.members.forEach(m => { if (m.birth === dateStr) gameState.popupQueue.push({type: 'birthday', member: m}); });

        gameState.finance += totalProfit; gameState.finance -= 500000;
        updateFandom(Math.floor(totalProfit / 10000));
        
        if(gameState.day % 7 === 0 && gameState.day > 1) gameState.popupQueue.push({type: 'weekly'});
        if(Math.random() < 0.15) gameState.popupQueue.push({type: 'virtual'});

        gameState.day++;
        gameState.members.forEach(m => m.fatigue = Math.max(0, m.fatigue - 10));
        
        document.getElementById('profit-report').style.display = 'block';
        document.getElementById('profit-content').innerHTML = `ìˆ˜ìµ: <span class="money-text">${totalProfit.toLocaleString()}ì›</span>`;
        if(gameState.community.length > 8) gameState.community = gameState.community.slice(-8);
        
        updateDisplay();
        processNextPopup();
    }

    function processNextPopup() {
        if(gameState.popupQueue.length === 0) return;
        const item = gameState.popupQueue.shift();
        if(item.type === 'weekly') showWeeklyReportPopup();
        else if(item.type === 'birthday') showBirthdayPopup(item.member);
        else if(item.type === 'virtual') showVirtualEventPopup();
    }

    function showVirtualEventPopup() {
        const ev = virtualEvents[Math.floor(Math.random()*virtualEvents.length)];
        const modal = document.getElementById('eventModal');
        document.getElementById('modal-title').innerText = ev.title;
        document.getElementById('modal-body').innerText = ev.desc;
        document.getElementById('modal-choices').innerHTML = ev.choices.map((c, idx) => `
            <button class="choice-btn" onclick="executeVirtualChoice('${ev.id}', ${idx})">${c.text}</button>
        `).join('');
        modal.style.display = 'block';
    }

    function executeVirtualChoice(evId, chIdx) {
        const ev = virtualEvents.find(e => e.id === evId);
        ev.choices[chIdx].effect();
        closeModal();
    }

    function showWeeklyReportPopup() {
        const modal = document.getElementById('eventModal');
        const views = (Math.floor(Math.random() * 291) + 10) * 10000;
        const star = gameState.members[Math.floor(Math.random()*gameState.members.length)].name;
        document.getElementById('modal-title').innerText = "ğŸ“ˆ ì£¼ê°„ ë„ˆíŠœë¸Œ ê²°ì‚°";
        document.getElementById('modal-body').innerHTML = `<div style="text-align:left; background:#fff5f5; padding:15px; border-radius:10px;"><strong>ì´ë²ˆ ì£¼ ì£¼ì¸ê³µ: <span style="color:var(--point)">${star}</span></strong><br>ì¡°íšŒìˆ˜: ${views.toLocaleString()}íšŒ<hr><div style="font-size:11px; line-height:1.4;">- ${ytComments[Math.floor(Math.random()*30)]}<br>- ${ytComments[Math.floor(Math.random()*30)]}</div></div>`;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">í™•ì¸</button>`;
        modal.style.display = 'block';
    }

    function showBirthdayPopup(m) {
        const modal = document.getElementById('eventModal');
        updateFandom(15000); ['vocal','dance','visual','variety','charm'].forEach(s => m[s] = Math.min(20, m[s]+1));
        document.getElementById('modal-title').innerText = `ğŸ‚ HAPPY BIRTHDAY!`;
        document.getElementById('modal-body').innerHTML = `<h3>${m.name}ì˜ ìƒì¼ì…ë‹ˆë‹¤!</h3><p>íŒ¬ë¤ +15,000 / ì „ìŠ¤íƒ¯ +1</p>`;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">ì¶•í•˜í•´ì£¼ê¸°</button>`;
        modal.style.display = 'block';
    }

    function manualTrainAction() {
        const name = document.getElementById('sel-member').value; const stat = document.getElementById('sel-stat').value;
        const m = gameState.members.find(i => i.name === name);
        if (stat !== 'rest' && m.fatigue >= 100) return alert("í”¼ë¡œë„ ì´ˆê³¼!");
        m.manualAct = stat; alert(`${name} ì§€ì‹œ ì™„ë£Œ`); updateDisplay();
    }

    function closeModal() { document.getElementById('eventModal').style.display = 'none'; processNextPopup(); }
    function openPage(pId, btn) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(pId).classList.add('active'); if(btn) btn.classList.add('active');
        updateDisplay();
    }
    updateDisplay();
</script>
</body>
</html>
