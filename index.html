<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í•˜ë°ìŠ¤ í‚¤ìš°ê¸° v7.9</title>
    <style>
        :root { --bg: #f5f7fa; --card: #ffffff; --point: #ff4d94; --text: #333; --border: #e1e4e8; --success: #40c057; --vocal: #ff4d94; --dance: #ae3ec9; --visual: #4dadff; --variety: #fab005; --charm: #f06595; --money: #2b8a3e; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; margin: 0; padding: 0; }
        .nav-bar { display: flex; background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; padding: 18px; border: none; background: transparent; color: #666; cursor: pointer; font-weight: bold; font-size: 14px; }
        .nav-btn.active { color: var(--point); border-bottom: 3px solid var(--point); background: #fffafc; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 20px 100px 20px; }
        .page { display: none; }
        .page.active { display: block; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); position: relative; }
        .date-display { position: absolute; top: 15px; right: 25px; text-align: right; }
        .day-count { font-weight: bold; color: var(--point); font-size: 18px; display: block; }
        .real-date { font-size: 12px; color: #888; }
        h2 { color: #222; font-size: 1.1rem; margin-top: 0; border-left: 4px solid var(--point); padding-left: 10px; margin-bottom: 15px; }
        .money-text { color: var(--money); font-weight: bold; }
        .comm-post { border-bottom: 1px solid #eee; padding: 12px 0; }
        .comm-site { font-size: 10px; font-weight: bold; padding: 2px 5px; border-radius: 4px; margin-right: 8px; }
        .site-ebem { background: #e7f5ff; color: #1971c2; }
        .site-cafe { background: #fff0f6; color: #d6336c; }
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 15px; }
        .member-card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 15px; }
        .stat-row { display: flex; align-items: center; margin-bottom: 5px; font-size: 12px; }
        .stat-label { width: 45px; color: #777; }
        .stat-bar-bg { flex: 1; height: 6px; background: #eee; border-radius: 3px; overflow: hidden; margin: 0 8px; }
        .stat-bar-fill { height: 100%; border-radius: 3px; transition: 0.5s; }
        .primary-btn { width: 100%; padding: 15px; background: var(--point); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .next-day-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid var(--border); text-align: center; z-index: 100; }
        .modal-overlay { display: none; position: fixed; z-index: 2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal-content { background:white; margin:10% auto; padding:30px; width:420px; border-radius:20px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.5); }
        .weekly-line { text-align: left; font-size: 13px; padding: 8px 0; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="nav-bar">
    <button class="nav-btn active" onclick="openPage('home', this)">ğŸ“Š í™ˆ</button>
    <button class="nav-btn" onclick="openPage('members', this)">ğŸ‘¥ ë©¤ë²„í˜„í™©</button>
    <button class="nav-btn" onclick="openPage('manual', this)">ğŸ“… ìˆ˜ë™ì§€ì‹œ</button>
</div>

<div class="container">
    <div id="home" class="page active">
        <div class="card">
            <div class="date-display">
                <span class="day-count">ìš´ì˜ <span id="current-day">1</span>ì¼ì°¨</span>
                <span class="real-date" id="current-date">2025-09-05</span>
            </div>
            <h2>ìƒíƒœ ì½˜ì†”</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div><small>ë³´ìœ  ìì‚°</small><br><strong id="p-finance">200,000,000</strong></div>
                <div><small>ì¼€ë¡œ íŒ¬ë¤ìˆ˜</small><br><strong id="p-fandom">12,405</strong></div>
            </div>
        </div>
        <div class="card" id="profit-report" style="display:none; background: #f2fcf0; border-color: #40c057;">
            <h2>ğŸˆ ì¼ì¼ ë¬¼í’ì„  ìˆ˜ìµ </h2>
            <div id="profit-content" style="font-size: 14px;"></div>
        </div>
        <div class="card">
            <h2>ğŸŒ ì»¤ë®¤ë‹ˆí‹° / íŒ¬ì¹´í˜ ë°˜ì‘ </h2>
            <div id="comm-container"></div>
        </div>
    </div>

    <div id="members" class="page">
        <div class="member-grid" id="member-grid-container"></div>
    </div>

    <div id="manual" class="page">
        <div class="card">
            <h2>ìˆ˜ë™ íŠ¸ë ˆì´ë‹ </h2>
            <select id="sel-member" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px;"></select>
            <select id="sel-stat" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px;">
                <option value="vocal">ğŸ¤ ë³´ì»¬ ì§‘ì¤‘ í›ˆë ¨</option>
                <option value="dance">ğŸ’ƒ ì•ˆë¬´ ì—°ìŠµ</option>
                <option value="visual">âœ¨ ë¹„ì£¼ì–¼ ì¼€ì–´</option>
                <option value="variety">ğŸ—£ï¸ ì˜ˆëŠ¥ ìŠ¤í”¼ì¹˜</option>
                <option value="charm">ğŸ€ ë§¤ë ¥ ê°•í™”</option>
                <option value="stream">ğŸ“¡ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° (ëœë¤ ìƒìŠ¹)</option>
            </select>
            <button class="primary-btn" onclick="manualTrainAction()">ì§€ì‹œ ì™„ë£Œ</button>
        </div>
    </div>
</div>

<div class="next-day-bar">
    <button class="primary-btn" style="background: #40c057; width: auto; padding: 12px 40px;" onclick="nextDay()">ğŸŒ™ ë‹¤ìŒë‚ ë¡œ (Space)</button>
</div>

<div id="eventModal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modal-title">ì•Œë¦¼</h2>
        <div id="modal-body" style="margin: 20px 0;"></div>
        <div id="modal-choices"></div>
    </div>
</div>

<script>
    let gameState = {
        day: 1, startDate: new Date('2025-09-05'), finance: 200000000, fandom: 12405,
        members: [
            {name: 'í‚¤ë§ˆ', vocal: 11, dance: 10, visual: 10, variety: 9, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ëµê·¤', vocal: 11, dance: 10, visual: 10, variety: 9, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ì±ˆë‚˜', vocal: 9, dance: 10, visual: 11, variety: 9, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ì†œì£¼ë¨¹', vocal: 9, dance: 10, visual: 10, variety: 11, charm: 10, fatigue: 10, manualAct: null},
            {name: 'ì—°ì´ˆë¡', vocal: 11, dance: 10, visual: 10, variety: 10, charm: 10, fatigue: 10, manualAct: null},
        ],
        community: [], weeklyLog: [], popupQueue: []
    };

    const ebemMsgs = ["í‚¤ë§ˆ ê³ ìŒ ë¯¸ì³¤ë„¤ ã…‹ã…‹", "ì—°ì´ˆë¡ ë¹„ì£¼ì–¼ ì‹¤í™”ëƒ?", "í•˜ë°ìŠ¤ í¼ ë¯¸ì³¤ë‹¤", "ì—ë±€ ì¸ê¸°ê¸€ í•˜ë°ìŠ¤ê°€ ë¨¹ì—ˆë„¤", "ì˜¤ëŠ˜ ë°©ì†¡ ê¿€ì¼ì´ì—ˆìŒ", "ì†œì£¼ë¨¹ ì»¤ì—½ë…¸", "ì±ˆë‚˜ ì˜ˆëŠ¥ê° ë¬´ì—‡?", "ëµê·¤ ëª©ì†Œë¦¬ ë³´ë¬¼ì´ë‹¤", "ê·¼ë° í•˜ë°ìŠ¤ ìˆ˜ìµ ì–´ë””ë¡œ ê°€ëƒ?", "ìš”ì¦˜ ë²„íŠœë²„ íŒ í•˜ë°ìŠ¤ê°€ ì ë ¹í•¨", "ì•„ë‹ˆ í›ˆë ¨ ì‹¤íŒ¨ ì‹¤í™”? ã…‹ã…‹ã…‹", "í‚¤ë§ˆ ë…¸ë˜ ì‹¤ë ¥ ì–µê¹Œí•˜ëŠ” ì• ë“¤ ë­ëƒ", "ëµê·¤ ë§¤ë ¥ì— ì •ì‹  ëª»ì°¨ë¦¬ê² ë‹¤", "í•˜ë°ìŠ¤ ë¬´ì§€ì„± ê°œì¶”", "ì´ë²ˆì— ì‹ ê·œ ì•„ë°”íƒ€ ë½‘ì", "ì˜¤ëŠ˜ ë°©ì†¡ ì±„íŒ…ì°½ ê´€ë¦¬ ì¢€ í•´ë¼", "ì—ë±€ í˜•ë‹˜ë“¤ í•˜ë°ìŠ¤ ì…ë•í–ˆë‹¤", "ì—°ì´ˆë¡ì€ ì‚¬ëŒ í™€ë¦¬ëŠ” ì¬ì£¼ê°€ ìˆìŒ", "ì±ˆë‚˜ ì›ƒìŒì†Œë¦¬ ì¤‘ë…ì„± ê°‘", "ì†œì£¼ë¨¹ ì´ë¦„ê°’ í•˜ë„¤ ã…‹ã…‹", "í•˜ë°ìŠ¤ ì½”ì¸ íƒ€ê¸¸ ì˜í–ˆë‹¤", "ë²„ì¶”ì–¼ ì‹œì¥ì˜ í˜ëª…ì´ë‹¤", "ì†”ì§íˆ ì–˜ë„¤ê°€ 1í™©ì„", "ì˜¤ëŠ˜ë„ ë¬¼í’ì„  ìˆë‹¤", "í›ˆë ¨ íš¨ìœ¨ ì‹¤í™”ëƒ ëŒ€í‘œì•¼ ì¼í•´ë¼"];
    const cafeMsgs = ["ì¼€ë¡œ 1ê¸° ëª¨ì—¬ë¼!", "ì˜¤ëŠ˜ë„ ë©¤ë²„ë“¤ ê³ ìƒí–ˆì–´ìš”", "ëŒ€í‘œë‹˜ ê³ ê¸° ì‚¬ì£¼ì„¸ìš”", "í•˜ë°ìŠ¤ ì…ë• ì™„ë£Œ", "íŒ¬ì¹´í˜ íšŒì›ìˆ˜ ì‹¤ì‹œê°„ ìƒìŠ¹ì¤‘", "ì‚¬ë‘í•´ìš” í•˜ë°ìŠ¤!", "í‚¤ë§ˆ ì–¸ë‹ˆ ë…¸ë˜ ë¶ˆëŸ¬ì¤˜ì„œ ê³ ë§ˆì›Œìš”", "ëµê·¤ì´ ì˜¤ëŠ˜ ë„ˆë¬´ ì˜ˆë»¤ë‹¤", "í•˜ë°ìŠ¤ ë•ë¶„ì— í•˜ë£¨ê°€ í–‰ë³µí•´", "ìš°ë¦¬ ë©¤ë²„ë“¤ ì•„í”„ì§€ ë§ˆìš”", "ì—°ì´ˆë¡ ê³µì£¼ë‹˜ ã… ã… ", "ì±ˆë‚˜ ë•ë¶„ì— ì˜¤ëŠ˜ ë°° ì°¢ì–´ì§", "ì†œì£¼ë¨¹ì´ ìš°ë¦¬ ì§€ì¼œì£¼ëŠ” ê±°ì•¼?", "ì¹´í˜ ë“±ê¸‰ì—… ë“œë””ì–´ í–ˆë‹¤!", "í•˜ë°ìŠ¤ ì˜ì›í•˜ì", "ì˜¤ëŠ˜ ë°©ì†¡ ìš”ì•½ë³¸ ì˜¬ë¼ì™”ë‚˜ìš”?", "ë©¤ë²„ë“¤ í”¼ë¡œë„ê°€ ê±±ì •ë¼ìš” ã… ã… ", "ëŒ€í‘œë‹˜ ì¥ë¹„ ì¢€ ë°”ê¿”ì£¼ì„¸ìš”", "í•˜ë°ìŠ¤ êµ¿ì¦ˆ ë‚˜ì˜¤ë©´ ë°”ë¡œ ì‚¼", "ë§¤ì¼ ë°¤ í•˜ë°ìŠ¤ ë°©ì†¡ë§Œ ê¸°ë‹¤ë ¤", "ì„¸ìƒì—ì„œ ì œì¼ ë¹›ë‚˜ëŠ” í•˜ë°ìŠ¤", "ëµê·¤ë‹˜ ëª©ì†Œë¦¬ ë“£ê³  ê¿€ì  ì ", "í‚¤ë§ˆëŠ” ë…¸ë˜ì²œì¬ê°€ í™•ì‹¤í•´", "í•˜ë°ìŠ¤ íŒ¬ë¯¸íŒ… ì–¸ì œ í•˜ë‚˜ìš”?", "ë©¤ë²„ë“¤ ë°¥ ì˜ ì±™ê²¨ ë¨¹ê¸¸"];

    const virtualEvents = [
        { title: "ğŸ’» ì„œë²„ ë ‰ ë°œìƒ", desc: "ë°©ì†¡ ì¤‘ ì„œë²„ê°€ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤.", choices: [{ text: "ì„œë²„ ì¦ì„¤ (-500ë§Œ/íŒ¬ë¤+2000)", effect: () => { gameState.finance -= 5000000; gameState.fandom += 2000; } }, { text: "ë°©ì¢… (íŒ¬ë¤-1000)", effect: () => { gameState.fandom -= 1000; } }] },
        { title: "ğŸ‘— ì‹ ê·œ ì˜ìƒ", desc: "ê³ í€„ë¦¬í‹° ì•„ë°”íƒ€ ì˜ìƒì„ ì œì‘í• ê¹Œìš”?", choices: [{ text: "ì œì‘ (-1000ë§Œ/ë¹„ì£¼ì–¼+1)", effect: () => { gameState.finance -= 10000000; gameState.members.forEach(m=>m.visual = Math.min(20, m.visual+1)); } }, { text: "ë³´ë¥˜ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ¤ ì €ì‘ê¶Œ ê²½ê³ ", desc: "ì»¤ë²„ê³¡ ì˜ìƒì— ë…¸ë€ ë”±ì§€ê°€ ë¶™ì—ˆìŠµë‹ˆë‹¤.", choices: [{ text: "ìˆ˜ìµ ê³„ì•½ (-300ë§Œ/íŒ¬ë¤+1500)", effect: () => { gameState.finance -= 3000000; gameState.fandom += 1500; } }, { text: "ì˜ìƒ ì‚­ì œ (íŒ¬ë¤-500)", effect: () => { gameState.fandom -= 500; } }] },
        { title: "ğŸ¨ íŒ¬ì•„íŠ¸ ê³µëª¨ì „", desc: "ê³µì‹ ê³µëª¨ì „ì„ í†µí•´ ê´€ì‹¬ì„ ëª¨ìë‹ˆë‹¤.", choices: [{ text: "ìƒê¸ˆ ì§€ê¸‰ (-200ë§Œ/íŒ¬ë¤+3000)", effect: () => { gameState.finance -= 2000000; gameState.fandom += 3000; } }, { text: "ì·¨ì†Œ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ•¶ï¸ ì¥ë¹„ ê³ ì¥", desc: "í’€íŠ¸ë˜í‚¹ ì¥ë¹„ê°€ ì˜¤ì‘ë™í•©ë‹ˆë‹¤.", choices: [{ text: "êµì²´ (-800ë§Œ/ëŒ„ìŠ¤+1)", effect: () => { gameState.finance -= 8000000; gameState.members.forEach(m=>m.dance = Math.min(20, m.dance+1)); } }, { text: "ìˆ˜ë¦¬ (í”¼ë¡œë„+10)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+10)); } }] },
        { title: "ğŸŒŸ íƒ€ ìœ íŠœë²„ í•©ë°©", desc: "ëŒ€ê¸°ì—… ë²„íŠœë²„ê°€ í•©ë°©ì„ ì œì˜í–ˆìŠµë‹ˆë‹¤.", choices: [{ text: "ìˆ˜ë½ (ë§¤ë ¥+1/íŒ¬ë¤+2500)", effect: () => { gameState.members.forEach(m=>m.charm = Math.min(20, m.charm+1)); gameState.fandom += 2500; } }, { text: "ê±°ì ˆ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ–Œï¸ ê¸ˆì† ì‘ê°€ì˜ íŒ¬ì•„íŠ¸", desc: "ì‹ ì˜ ì†ìœ¼ë¡œ ë¶ˆë¦¬ëŠ” ì‘ê°€ê°€ í•˜ë°ìŠ¤ íŒ¬ì•„íŠ¸ë¥¼ ê²Œì‹œí•´ í™”ì œì…ë‹ˆë‹¤!", choices: [{ text: "ê³µì‹ ê³„ì • ê³µìœ  (íŒ¬ë¤+4000)", effect: () => { gameState.fandom += 4000; } }, { text: "ì‘ê°€ì—ê²Œ ê°ì‚¬ ë©˜ì…˜ (í”¼ë¡œë„-30)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.max(0, m.fatigue-30)); } }] },
        { title: "ğŸ¤– AI ë³´ì´ìŠ¤ ë…¼ë€", desc: "ì•ˆí‹°ë“¤ì´ AI ì‚¬ìš© ì˜í˜¹ì„ ì œê¸°í•©ë‹ˆë‹¤.", choices: [{ text: "ìƒëª© ì¸ì¦ (í”¼ë¡œë„+15/íŒ¬ë¤+1200)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+15)); gameState.fandom += 1200; } }, { text: "ë¬´ëŒ€ì‘ (íŒ¬ë¤-1500)", effect: () => { gameState.fandom -= 1500; } }] },
        { title: "ğŸ® ê²Œì„ ëŒ€íšŒ", desc: "ë²„ì¶”ì–¼ ë¡¤ ëŒ€íšŒì— ì´ˆì²­ë°›ì•˜ìŠµë‹ˆë‹¤.", choices: [{ text: "ì°¸ì „ (ì˜ˆëŠ¥+1/íŒ¬ë¤+1800)", effect: () => { gameState.members.forEach(m=>m.variety = Math.min(20, m.variety+1)); gameState.fandom += 1800; } }, { text: "ê±°ì ˆ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ§ ASMR ê¸°íš", desc: "ìƒˆë²½ ASMR ë°©ì†¡ì„ ì¤€ë¹„í• ê¹Œìš”?", choices: [{ text: "ì¥ë¹„ êµ¬ë§¤ (-400ë§Œ/íŒ¬ë¤+2800)", effect: () => { gameState.finance -= 4000000; gameState.fandom += 2800; } }, { text: "ë³´ë¥˜ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ§¸ ê³µì‹ êµ¿ì¦ˆ", desc: "ë´‰ì œ ì¸í˜• êµ¿ì¦ˆ ì œì‘ ì˜ë¢°ê°€ ì™”ìŠµë‹ˆë‹¤.", choices: [{ text: "ì„ ì…ê¸ˆ ì§„í–‰ (-500ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 5000000; gameState.fandom += 5000; } }, { text: "ê±°ì ˆ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ“‰ ìœ íŠœë¸Œ ì•Œê³ ë¦¬ì¦˜", desc: "ì•Œê³ ë¦¬ì¦˜ì„ íƒ€ê¸° ìœ„í•´ ìˆì¸ ë¥¼ ì–‘ì‚°í• ê¹Œìš”?", choices: [{ text: "í¸ì§‘ì ê³ ìš© (-300ë§Œ/íŒ¬ë¤+3500)", effect: () => { gameState.finance -= 3000000; gameState.fandom += 3500; } }, { text: "ì§ì ‘ í¸ì§‘ (í”¼ë¡œë„+20/íŒ¬ë¤+2000)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+20)); gameState.fandom += 2000; } }] },
        { title: "ğŸš« ì±„íŒ…ì°½ í…ŒëŸ¬", desc: "ìƒë°©ì†¡ ì¤‘ ì•…í”ŒëŸ¬ë“¤ì´ ë‚œì…í–ˆìŠµë‹ˆë‹¤.", choices: [{ text: "ë§¤ë‹ˆì € ê³ ìš© (-100ë§Œ/íŒ¬ë¤+1000)", effect: () => { gameState.finance -= 1000000; gameState.fandom += 1000; } }, { text: "ë©˜íƒˆ ì¼€ì–´ (í”¼ë¡œë„+10)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+10)); } }] },
        { title: "ğŸŒŒ ì˜¤í”„ë¼ì¸ ì „ê´‘íŒ", desc: "ì§€í•˜ì² ì—­ì— í•˜ë°ìŠ¤ ê´‘ê³ ë¥¼ ê±¸ê¹Œìš”?", choices: [{ text: "ì§‘í–‰ (-1200ë§Œ/íŒ¬ë¤+8000)", effect: () => { gameState.finance -= 12000000; gameState.fandom += 8000; } }, { text: "ë³´ë¥˜ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ¤ ë³´ì»¬ ë¯¹ì‹± ì™¸ì£¼", desc: "ì»¤ë²„ê³¡ì˜ í€„ë¦¬í‹°ë¥¼ ìœ„í•´ ë¯¹ì‹±ì„ ë§¡ê¹ë‹ˆë‹¤.", choices: [{ text: "ì „ë¬¸ ì™¸ì£¼ (-200ë§Œ/ë³´ì»¬+1)", effect: () => { gameState.finance -= 2000000; gameState.members.forEach(m=>m.vocal = Math.min(20, m.vocal+1)); } }, { text: "ìì²´ ë¯¹ì‹± (í”¼ë¡œë„+5)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+5)); } }] },
        { title: "ğŸŒ VR í”Œë«í¼ ë©”ì¸ ì „ì‹œ", desc: "ìœ ëª… VR í”Œë«í¼ì˜ ë©”ì¸ ë¡œë¹„ì— í•˜ë°ìŠ¤ì˜ ë“±ì‹ ëŒ€ê°€ ì„¸ì›Œì§‘ë‹ˆë‹¤!", choices: [{ text: "ê´‘ê³ ë¹„ ì§€ë¶ˆ (-300ë§Œ/íŒ¬ë¤+5000)", effect: () => { gameState.finance -= 3000000; gameState.fandom += 5000; } }, { text: "ë¬´ë£Œ ë…¸ì¶œë§Œ (íŒ¬ë¤+1000)", effect: () => { gameState.fandom += 1000; } }] },
        { title: "ğŸ­ ë©¤ë²„ê°„ ë¶ˆí™”ì„¤", desc: "ë°©ì†¡ ì¤‘ í‘œì • ê´€ë¦¬ ì•ˆ ëœ ì¥ë©´ì´ í¼ì¡ŒìŠµë‹ˆë‹¤.", choices: [{ text: "í•´ëª… ë°©ì†¡ (í”¼ë¡œë„+15/íŒ¬ë¤+1000)", effect: () => { gameState.members.forEach(m=>m.fatigue = Math.min(100, m.fatigue+15)); gameState.fandom += 1000; } }, { text: "ì¹œëª© ìˆì¸  ì—…ë¡œë“œ (íŒ¬ë¤+2000)", effect: () => { gameState.fandom += 2000; } }] },
        { title: "âš¡ ì „ë ¥ ëˆ„ì „", desc: "ìŠ¤íŠœë””ì˜¤ ì •ì „ìœ¼ë¡œ ë°©ì†¡ì´ ëŠê²¼ìŠµë‹ˆë‹¤.", choices: [{ text: "UPS êµ¬ë§¤ (-300ë§Œ)", effect: () => { gameState.finance -= 3000000; } }, { text: "ê·¸ëƒ¥ ëŒ€ê¸° (íŒ¬ë¤-1000)", effect: () => { gameState.fandom -= 1000; } }] },
        { title: "ğŸ íŒ¬ë¯¸íŒ… ëŒ€ê´€", desc: "ì†Œê·œëª¨ ë²„ì¶”ì–¼ íŒ¬ë¯¸íŒ…ì„ ê³„íší•©ë‹ˆë‹¤.", choices: [{ text: "ëŒ€ê´€ (-700ë§Œ/íŒ¬ë¤+6000)", effect: () => { gameState.finance -= 7000000; gameState.fandom += 6000; } }, { text: "ì·¨ì†Œ (ì—†ìŒ)", effect: () => {} }] },
        { title: "ğŸ†• ì‹ ì¸ ë°œêµ´", desc: "2ê¸°ìƒ ì˜¤ë””ì…˜ ë£¨ë¨¸ë¡œ ì¹´í˜ê°€ ì‹œë„ëŸ½ìŠµë‹ˆë‹¤.", choices: [{ text: "1ê¸° ì§‘ì¤‘ ì„ ì–¸ (íŒ¬ë¤+3000)", effect: () => { gameState.fandom += 3000; } }, { text: "ë¬´ëŒ€ì‘ (íŒ¬ë¤-500)", effect: () => { gameState.fandom -= 500; } }] }
    ];

    window.addEventListener('keydown', e => { if (e.code === 'Space' && document.getElementById('eventModal').style.display !== 'block') nextDay(); });

    function updateDisplay() {
        document.getElementById('current-day').innerText = gameState.day;
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        document.getElementById('current-date').innerText = d.toISOString().split('T')[0];
        document.getElementById('p-finance').innerText = gameState.finance.toLocaleString();
        document.getElementById('p-fandom').innerText = gameState.fandom.toLocaleString();
        
        const sel = document.getElementById('sel-member');
        if(sel.options.length === 0) gameState.members.forEach(m => sel.innerHTML += `<option value="${m.name}">${m.name}</option>`);

        document.getElementById('member-grid-container').innerHTML = gameState.members.map(m => `
            <div class="member-card">
                <strong>${m.name}</strong> ${m.manualAct ? '<small style="color:var(--point)">(ì§€ì‹œë¨)</small>' : ''}
                ${renderStat('ë³´ì»¬',m.vocal,'var(--vocal)')}${renderStat('ëŒ„ìŠ¤',m.dance,'var(--dance)')}${renderStat('ë¹„ì£¼ì–¼',m.visual,'var(--visual)')}${renderStat('ì˜ˆëŠ¥',m.variety, 'var(--variety)')}${renderStat('ë§¤ë ¥',m.charm,'var(--charm)')}
                <div style="font-size:11px; text-align:right; color:#888;">í”¼ë¡œë„: ${m.fatigue}%</div>
            </div>
        `).join('');

        document.getElementById('comm-container').innerHTML = gameState.community.map(c => `
            <div class="comm-post"><span class="comm-site ${c.site==='ì—ë±€'?'site-ebem':'site-cafe'}">${c.site}</span><div style="font-size:13px; margin-top:4px;">${c.content}</div></div>
        `).reverse().join('');
    }

    function renderStat(l, v, c) {
        const isMax = v >= 20;
        return `<div class="stat-row">
            <div class="stat-label">${l}</div>
            <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${(v/20)*100}%; background:${isMax ? '#333' : c}"></div></div>
            <div style="font-size:10px;">${v}${isMax ? 'MAX' : ''}</div>
        </div>`;
    }

    function manualTrainAction() {
        const name = document.getElementById('sel-member').value;
        const stat = document.getElementById('sel-stat').value;
        const m = gameState.members.find(i => i.name === name);
        if (stat !== 'stream' && m[stat] >= 20) return alert("ì´ë¯¸ ìµœëŒ€ì¹˜ì…ë‹ˆë‹¤.");
        m.manualAct = stat;
        alert(`${name} ì§€ì‹œ ì™„ë£Œ`);
        updateDisplay();
    }

    function nextDay() {
        let totalProfit = Math.floor(Math.random() * (1000000 - 400000 + 1)) + 400000;
        let dailyReport = [];
        const stats = ['vocal', 'dance', 'visual', 'variety', 'charm'];

        gameState.members.forEach(m => {
            let action = m.manualAct;
            if (action === 'stream') {
                const avail = stats.filter(s => m[s] < 20);
                action = avail.length > 0 ? avail[Math.floor(Math.random() * avail.length)] : null;
            }
            if (!action || m[action] >= 20) {
                const avail = stats.filter(s => m[s] < 20);
                action = avail.length > 0 ? avail[Math.floor(Math.random() * avail.length)] : null;
            }
            
            if (action) {
                let roll = Math.random() * 100;
                let inc = 0;
                let msg = "ì‹¤íŒ¨";
                if (roll < 50) { inc = 1; msg = "ì„±ê³µ(+1)"; }
                m[action] = Math.min(20, m[action] + inc);
                m.fatigue = Math.min(100, m.fatigue + 15);
                dailyReport.push({name: m.name, stat: action, msg: msg});
            }
            m.manualAct = null;
        });

        gameState.finance += totalProfit;
        gameState.finance -= 500000;
        gameState.fandom += Math.floor(totalProfit / 10000);
        gameState.day++;
        gameState.members.forEach(m => m.fatigue = Math.max(0, m.fatigue - 10));

        gameState.weeklyLog.push({day: gameState.day-1, data: dailyReport});
        if(gameState.weeklyLog.length > 7) gameState.weeklyLog.shift();

        document.getElementById('profit-report').style.display = 'block';
        document.getElementById('profit-content').innerHTML = `ì–´ì œ ë¬¼í’ì„  ìˆ˜ìµ: <span class="money-text">${totalProfit.toLocaleString()}ì›</span>`;

        gameState.community.push({site:'ì—ë±€', content: ebemMsgs[Math.floor(Math.random()*ebemMsgs.length)]});
        gameState.community.push({site:'ì¹´í˜', content: cafeMsgs[Math.floor(Math.random()*cafeMsgs.length)]});
        if(gameState.community.length > 3) gameState.community = gameState.community.slice(-3);

        updateDisplay();
        
        gameState.popupQueue = [];
        if(gameState.day % 7 === 1 && gameState.day > 1) gameState.popupQueue.push('weekly');
        if(gameState.day % 7 === 0) gameState.popupQueue.push('event');
        
        processNextPopup();
    }

    function processNextPopup() {
        if(gameState.popupQueue.length === 0) { openPage('home'); return; }
        const type = gameState.popupQueue.shift();
        if(type === 'weekly') showWeeklyReportPopup();
        else if(type === 'event') triggerEvent();
    }

    function showWeeklyReportPopup() {
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');
        const choices = document.getElementById('modal-choices');
        title.innerText = "ğŸ“ˆ ì£¼ê°„ íŠ¸ë ˆì´ë‹ ê²°ì‚°"; title.style.color = "#339af0";
        let totals = {};
        gameState.members.forEach(m => totals[m.name] = 0);
        gameState.weeklyLog.forEach(log => log.data.forEach(d => {
            const inc = d.msg.includes('+1') ? 1 : 0;
            totals[d.name] += inc;
        }));
        body.innerHTML = Object.keys(totals).map(name => `<div class="weekly-line"><strong>${name}</strong>: <span style="color:#1971c2;">ì´ ìŠ¤íƒ¯ +${totals[name]} ìƒìŠ¹</span></div>`).join('') + `<p style="font-size:11px; color:#888; margin-top:15px;">â€» í›ˆë ¨ í™•ë¥  50%ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
        choices.innerHTML = `<button class="primary-btn" style="background:#339af0;" onclick="closeModal()">í™•ì¸</button>`;
        document.getElementById('eventModal').style.display = 'block';
    }

    function triggerEvent() {
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');
        const choices = document.getElementById('modal-choices');
        title.style.color = "var(--point)";
        const ev = virtualEvents[Math.floor(Math.random() * virtualEvents.length)];
        title.innerText = ev.title;
        body.innerHTML = `<p style="font-size:14px; line-height:1.6;">${ev.desc}</p>`;
        choices.innerHTML = '';
        ev.choices.forEach(c => {
            const b = document.createElement('button'); b.className = "primary-btn"; b.innerText = c.text;
            b.onclick = () => { 
                c.effect(); 
                updateDisplay();
                closeModal(); 
            };
            choices.appendChild(b);
        });
        document.getElementById('eventModal').style.display = 'block';
    }

    function closeModal() { document.getElementById('eventModal').style.display = 'none'; processNextPopup(); }

    function openPage(pId, btn) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(pId).classList.add('active');
        if(btn) btn.classList.add('active');
        updateDisplay();
    }

    updateDisplay();
</script>
</body>
</html>
