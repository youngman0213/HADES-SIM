<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•˜ë°ìŠ¤ í‚¤ìš°ê¸° v24.0 (Live Stream Update)</title>
    <style>
        :root { --bg: #f5f7fa; --card: #ffffff; --point: #ff4d94; --text: #333; --border: #e1e4e8; --success: #40c057; --vocal: #ff4d94; --dance: #ae3ec9; --visual: #4dadff; --variety: #fab005; --charm: #f06595; --money: #2b8a3e; --danger: #fa5252; --sns: #405de6; --yt: #ff0000; --yz: #000000; --subak: #0ca678; --musicside: #1c7ed6; --tube: #f03e3e; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; margin: 0; padding: 0; line-height: 1.5; overflow-x: hidden; }
        
        /* ì‹œì‘ & ë„¤ë¹„ */
        #start-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a1a 0%, #333 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; color: white; text-align: center; }
        .start-logo { font-size: 3rem; font-weight: 900; color: var(--point); margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,77,148,0.5); }
        .start-btn { padding: 18px 60px; background: var(--point); color: white; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 10px 20px rgba(255,77,148,0.3); transition: 0.3s; }
        .start-btn:hover { transform: scale(1.05); }
        .nav-bar { display: none; background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; padding: 15px 5px; border: none; background: transparent; color: #666; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.2s; white-space: nowrap; }
        .nav-btn.active { color: var(--point); border-bottom: 3px solid var(--point); background: #fffafc; }
        
        /* ë ˆì´ì•„ì›ƒ */
        .container { display: none; max-width: 900px; margin: 0 auto; padding: 15px 15px 100px 15px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); position: relative; }
        .date-display { position: relative; text-align: right; margin-bottom: 10px; }
        @media (min-width: 600px) { .date-display { position: absolute; top: 15px; right: 25px; } }
        .day-count { font-weight: bold; color: var(--point); font-size: 18px; display: block; }
        .real-date { font-size: 12px; color: #888; }
        h2 { color: #222; font-size: 1.1rem; margin-top: 0; border-left: 4px solid var(--point); padding-left: 10px; margin-bottom: 15px; }
        .money-text { color: var(--money); font-weight: bold; }
        
        /* ë‰´ìŠ¤ í‹°ì»¤ */
        .ticker-container { background: #212529; color: white; padding: 12px 0; overflow: hidden; white-space: nowrap; position: relative; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .ticker-wrapper { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 20px; font-size: 13px; }
        .ticker-site { font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 4px; margin-right: 5px; vertical-align: middle; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* ì‚¬ì´íŠ¸ ë±ƒì§€ ìƒ‰ìƒ */
        .site-ebem { background: #e7f5ff; color: #1971c2; }
        .site-cafe { background: #fff0f6; color: #d6336c; }
        .site-sns { background: #f0f1ff; color: var(--sns); }
        .site-yt { background: #ffe3e3; color: var(--yt); }
        .site-yz { background: #495057; color: #fff; }
        .site-news { background: #fa5252; color: #fff; }
        .site-music { background: #e6fcf5; color: #0ca678; }

        /* ìŠ¤íƒ¯ */
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .stat-item { background: #f8f9fa; padding: 10px; border-radius: 10px; }
        .stat-item small { color: #777; font-size: 11px; }
        .stat-item strong { font-size: 15px; display: block; margin-top: 2px; }

        /* ì°¨íŠ¸ ì „ìš© ìŠ¤íƒ€ì¼ */
        .chart-tabs { display: flex; border: 1px solid var(--border); border-radius: 8px 8px 0 0; overflow: hidden; }
        .chart-tab-btn { flex: 1; border: none; background: #f8f9fa; padding: 12px; cursor: pointer; font-size: 14px; font-weight: bold; color: #888; transition: 0.2s; }
        .chart-tab-btn.active { background: white; color: #333; }
        .chart-tab-btn.subak.active { color: var(--subak); border-bottom: 3px solid var(--subak); }
        .chart-tab-btn.musicside.active { color: var(--musicside); border-bottom: 3px solid var(--musicside); }
        .chart-tab-btn.tube.active { color: var(--tube); border-bottom: 3px solid var(--tube); }

        .sub-chart-tabs { display: flex; background: #fff; border-bottom: 1px solid var(--border); margin-bottom: 10px; padding: 5px; gap: 5px; }
        .sub-tab-btn { flex: 1; border: 1px solid transparent; background: transparent; padding: 6px; cursor: pointer; font-size: 11px; color: #666; border-radius: 20px; transition: 0.2s; }
        .sub-tab-btn:hover { background: #f1f3f5; }
        .sub-tab-btn.active { background: #333; color: white; font-weight: bold; }
        
        .chart-list { min-height: 350px; }
        .chart-row { display: flex; align-items: center; padding: 10px 5px; border-bottom: 1px solid #f1f3f5; font-size: 13px; }
        .chart-row:nth-child(1) .rank { color: #ffd43b; text-shadow: 1px 1px 0 #e67700; font-size: 16px; }
        .chart-row:nth-child(2) .rank { color: #adb5bd; font-size: 15px; }
        .chart-row:nth-child(3) .rank { color: #e599f7; font-size: 15px; }
        .chart-row.my-song { background: #fff0f6; border-radius: 8px; border: 1px solid #fcc2d7; }
        
        .rank { width: 30px; font-weight: 900; text-align: center; margin-right: 10px; color: #495057; }
        .rank-change { width: 30px; font-size: 10px; text-align: center; margin-right: 5px; color: #888; }
        .rank-up { color: var(--danger); }
        .rank-down { color: #1c7ed6; }
        .song-info { flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .song-title { font-weight: bold; display: block; }
        .artist-name { font-size: 11px; color: #888; }
        .chart-score { font-size: 10px; color: #868e96; text-align: right; width: 60px; font-variant-numeric: tabular-nums; }

        /* ë©¤ë²„ & ì»¨í…ì¸  */
        .member-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 650px) { .member-grid { grid-template-columns: repeat(2, 1fr); } }
        .member-card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; transition: 0.3s; }
        .profile-container { display: flex; align-items: center; margin-bottom: 15px; }
        .profile-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); margin-right: 12px; background: #eee; }
        .profile-info { flex: 1; }
        .stat-row { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; }
        .stat-label { width: 40px; color: #777; font-size: 11px; }
        .stat-bar-bg { flex: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin: 0 8px; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: 0.5s; }
        .bonus-stat { color: var(--success); font-weight: bold; font-size: 10px; margin-left: 4px; }
        .equip-btn { position: absolute; top: 15px; right: 15px; padding: 5px 10px; background: #333; color: white; font-size: 11px; border-radius: 5px; border:none; cursor: pointer; }
        .equipped-items { margin-top: 10px; font-size: 11px; color: #666; background: #f8f9fa; padding: 8px; border-radius: 6px; min-height: 20px;}

        .content-card { border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 12px; background: #fff; transition:0.2s; position: relative; }
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .content-badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .badge-short { background: #e3fafc; color: #0c8599; }
        .badge-mid { background: #f3f0ff; color: #6741d9; }
        .badge-long { background: #fff0f6; color: #c2255c; }
        .badge-item { background: #f3f0ff; color: #5c7cfa; }
        .badge-special { background: #fff5f5; color: #ff0000; border: 1px solid #ffc9c9; }
        .content-info { font-size: 12px; color: #555; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        .content-btn { width: 100%; padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-available { background: var(--point); box-shadow: 0 4px 6px rgba(255, 77, 148, 0.2); }
        .btn-available:hover { filter: brightness(0.9); }
        .btn-cooldown { background: #adb5bd; cursor: not-allowed; }
        
        /* ë²„íŠ¼ & ëª¨ë‹¬ */
        .next-day-bar { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 12px; border-top: 1px solid var(--border); text-align: center; z-index: 100; box-sizing: border-box; }
        .primary-btn { width: 100%; padding: 14px; background: var(--point); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; transition:0.2s; }
        .primary-btn:hover { background: #e64980; }
        .choice-btn { width: 100%; padding: 14px; background: #f1f3f5; color: #333; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; margin-bottom: 8px; text-align: left; font-size: 14px; display: flex; justify-content: space-between; align-items: center; transition:0.2s; }
        .upgrade-btn { padding: 4px 8px; font-size: 11px; background: #7950f2; color:white; border:none; border-radius:4px; cursor:pointer; margin-left:5px; font-weight:bold; }
        .modal-overlay { display: none; position: fixed; z-index: 9000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter: blur(3px); }
        .modal-content { background:white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding:25px; width: 85%; max-width:400px; border-radius:20px; text-align:center; box-sizing: border-box; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        .tier-badge { font-size: 16px; font-weight: 900; margin: 10px 0; display: inline-block; padding: 8px 20px; border-radius: 50px; color:white; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .tier-rookie { background: #ced4da; color: #495057; }
        .tier-rising { background: #74c0fc; }
        .tier-domestic { background: #40c057; }
        .tier-asia { background: #fab005; }
        .tier-na { background: #e64980; }
        .tier-world { background: linear-gradient(45deg, #a5d8ff, #7950f2, #ff8787); box-shadow: 0 0 15px rgba(121, 80, 242, 0.5); position: relative; overflow: hidden; }
        .tier-world::after { content:''; position: absolute; top:0; left:-100%; width:100%; height:100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shine 2s infinite; }
        @keyframes shine { 100% { left: 100%; } }

        /* ë¼ì´ë¸Œ ë°©ì†¡ ë¯¸ë‹ˆê²Œì„ ì „ìš© ìŠ¤íƒ€ì¼ */
        #live-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 20000; overflow: hidden; }
        .live-header { position: absolute; top: 20px; left: 20px; color: white; border-left: 4px solid red; padding-left: 10px; font-size: 14px; }
        .live-header span { background: red; padding: 2px 6px; border-radius: 3px; font-weight: bold; animation: blink 1s infinite; margin-right: 5px; }
        @keyframes blink { 50% { opacity: 0; } }
        .chat-container { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; height: 75%; display: flex; flex-direction: column; justify-content: flex-end; padding-bottom: 20px; pointer-events: none; }
        .chat-bubble { pointer-events: auto; padding: 10px 15px; border-radius: 15px; margin-bottom: 8px; font-size: 14px; animation: slideUp 3.5s linear forwards; position: absolute; width: fit-content; white-space: nowrap; cursor: pointer; user-select: none; }
        @keyframes slideUp { 0% { transform: translateY(150px); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-600px); opacity: 0; } }
        .chat-good { background: rgba(255,255,255,0.15); color: white; border: 1px solid rgba(255,255,255,0.1); }
        .chat-bad { background: #fa5252; color: white; font-weight: bold; border: 2px solid #fff; box-shadow: 0 0 15px rgba(250,82,82,0.6); }
        .live-score { position: absolute; top: 20px; right: 20px; color: white; font-size: 16px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 5px 12px; border-radius: 20px; }
    </style>
</head>
<body>

<div id="start-page">
    <div class="start-logo">HADES</div>
    <div class="start-sub">Virtual Idol Management v24.0</div>
    <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
</div>

<!-- ë¼ì´ë¸Œ ë°©ì†¡ ë¯¸ë‹ˆê²Œì„ ë ˆì´ì–´ -->
<div id="live-overlay">
    <div class="live-header"><span>LIVE</span> <strong id="live-member-name">ë©¤ë²„</strong> ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì¤‘...</div>
    <div id="live-chat-area" class="chat-container"></div>
    <div class="live-score">ì°¨ë‹¨í•œ ì•…í”Œ: <span id="bad-count">0</span></div>
</div>

<div class="nav-bar" id="main-nav">
    <button class="nav-btn active" onclick="openPage('home', this)">ğŸ“Š í™ˆ</button>
    <button class="nav-btn" onclick="openPage('members', this)">ğŸ‘¥ ë©¤ë²„</button>
    <button class="nav-btn" onclick="openPage('contents', this)">ğŸ¬ ì»¨í…ì¸ </button>
    <button class="nav-btn" onclick="openPage('store', this)">ğŸ›ï¸ ìƒì </button>
    <button class="nav-btn" onclick="openPage('manual', this)">ğŸ“… ì§€ì‹œ</button>
</div>

<div class="container" id="main-container">
    <div id="home" class="page active">
        <div class="ticker-container">
            <div class="ticker-wrapper" id="reaction-ticker">
                <div class="ticker-item">ë¡œë“œ ì¤‘...</div>
            </div>
        </div>

        <div class="card">
            <div class="date-display">
                <span class="day-count">ìš´ì˜ <span id="current-day">1</span>ì¼ì°¨</span>
                <span class="real-date" id="current-date">2025-09-05</span>
            </div>
            <h2>ìƒíƒœ</h2>
            <div class="stat-grid">
                <div class="stat-item"><small>ë³´ìœ  ìì‚°</small><strong id="p-finance" class="money-text">200,000,000ì›</strong></div>
                <div class="stat-item"><small>íŒ¬ì¹´í˜ íšŒì›</small><strong id="p-fandom">110,000ëª…</strong></div>
                <div class="stat-item"><small>ë„ˆíŠœë¸Œ êµ¬ë…</small><strong id="p-youtube">20,000ëª…</strong></div>
                <div class="stat-item"><small>SNS íŒ”ë¡œì›Œ</small><strong id="p-sns">1,000ëª…</strong></div>
                <div class="stat-item"><small>í˜„ì¬ ì¸ì§€ë„</small><strong id="p-tier" style="color:#7950f2;">ë£¨í‚¤</strong></div>
                <div class="stat-item"><small>ëˆ„ì  ë§¤ì¶œ</small><strong id="p-sales">0ì›</strong></div>
            </div>
        </div>

        <div class="card" id="chart-section" style="display:none;">
            <h2>ğŸ† ì‹¤ì‹œê°„ í†µí•© ì°¨íŠ¸</h2>
            <div class="chart-tabs">
                <button class="chart-tab-btn subak active" onclick="switchChartPlatform('subak')">ğŸˆ ìˆ˜ë°•</button>
                <button class="chart-tab-btn musicside" onclick="switchChartPlatform('musicside')">ğŸ’¿ ë®¤ì§ì‚¬ì´ë“œ</button>
                <button class="chart-tab-btn tube" onclick="switchChartPlatform('tube')">ğŸ“º ë„ˆíŠœë¸Œ</button>
            </div>
            <div class="sub-chart-tabs">
                <button class="sub-tab-btn active" onclick="switchChartPeriod('daily')">ğŸ“… ì¼ê°„</button>
                <button class="sub-tab-btn" onclick="switchChartPeriod('monthly')">ğŸŒ” ì›”ê°„</button>
                <button class="sub-tab-btn" onclick="switchChartPeriod('yearly')">ğŸ‘‘ ì—°ê°„</button>
            </div>
            <div id="chart-list-container" class="chart-list"></div>
        </div>

        <div class="card" id="profit-report" style="display:none; background: #f2fcf0; border-color: #40c057;">
            <h2>ğŸˆ ì¼ì¼ ë¦¬í¬íŠ¸</h2>
            <div id="profit-content" style="font-size: 14px;"></div>
        </div>
        
        <div class="save-load-btns">
            <button class="save-btn" onclick="saveGame()">ğŸ’¾ ë°ì´í„° ì €ì¥</button>
            <button class="save-btn" style="background:#212529;" onclick="loadGame()">ğŸ“‚ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
    </div>

    <div id="members" class="page">
        <div class="member-grid" id="member-grid-container"></div>
    </div>

    <div id="contents" class="page">
        <div class="card">
            <h2>ğŸ”¥ ìŠ¤í˜ì…œ í”„ë¡œì íŠ¸ (í•œì •)</h2>
            <div id="special-content-list"></div>
        </div>
        <div class="card">
            <h2>ğŸ¬ ì¼ë°˜ ì»¨í…ì¸  ì œì‘</h2>
            <div id="content-list"></div>
        </div>
    </div>

    <div id="store" class="page">
        <div class="card">
            <h2>ğŸ›ï¸ ë°©ì†¡ ì¥ë¹„ ìƒì </h2>
            <div id="shop-list"></div>
        </div>
    </div>

    <div id="manual" class="page">
        <div class="card">
            <h2>ìˆ˜ë™ ì§€ì‹œ</h2>
            <select id="sel-member" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;"></select>
            <select id="sel-stat" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
                <option value="vocal">ğŸ¤ ë³´ì»¬ ì§‘ì¤‘ í›ˆë ¨</option>
                <option value="dance">ğŸ’ƒ ì•ˆë¬´ ì—°ìŠµ</option>
                <option value="visual">âœ¨ ë¹„ì£¼ì–¼ ì¼€ì–´</option>
                <option value="variety">ğŸ—£ï¸ ì˜ˆëŠ¥ ìŠ¤í”¼ì¹˜</option>
                <option value="charm">ğŸ€ ë§¤ë ¥ ê°•í™”</option>
                <option value="stream">ğŸ“¡ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</option>
                <option value="rest">ğŸ’¤ ê¿€ê°™ì€ íœ´ì‹</option>
            </select>
            <button class="primary-btn" onclick="manualTrainAction()">ì§€ì‹œ ì™„ë£Œ</button>
        </div>
    </div>
</div>

<div class="next-day-bar" id="main-footer">
    <button class="primary-btn" style="background: #40c057;" onclick="nextDay()">ğŸŒ™ ë‹¤ìŒë‚ ë¡œ (Space)</button>
</div>

<div id="eventModal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modal-title"></h2>
        <div id="modal-body" style="margin: 15px 0; font-size: 14px;"></div>
        <div id="modal-choices"></div>
    </div>
</div>

<script>
    // === ë°ì´í„° ===
    const rivalArtists = ["ì‹œí€€ì„œ", "ë””ì§€ë…¸ë¯¹", "ê¸€ë¦¬ì¹˜ë¬¸", "ë‰´ëŸ´ì›¨ì´ë¸Œ", "ë¹„íŠ¸ì…¸", "ì½”ì–´ë§í¬", "ì‚¬ì´ë²„ë¦¬í”„", "í”½ì…€í—¤ì´ì¦ˆ", "ì‹±í¬ë¹„ì „", "ë²¡í„°ë³´ì´ì¦ˆ", "ì•Œê³ ë¦¬ë“¬", "í”Œë¡œíŒ…ì¹©", "ì–¸ë¦¬ì–¼ì†Œìš¸", "ì„œë¸Œë ˆì´ì–´", "ë©”íƒ€ëª¨í”„", "í•˜ì´í¼ë£¨í”„", "ì‹ ìŠ¤í”Œë¡œìš°", "ëˆ„í´ë¦¬ì–´ìŠ¤", "KRYX", "LYNQ", "V-ZIT", "X-IEL", "JOYN", "N-ZIA", "RYZE-O", "QUV", "W-AVE", "SYLK", "F-REEL", "G-LOWD", "VEXEN", "TYRO", "Z-EEN", "M-NEX", "O-RIT", "P-LEY", "B-ZON", "X-WAY", "H-YDE", "L-UVN", "S-YDE", "A-XIS", "N-TICK", "ëˆ„ë³´", "ë””íŠ¸", "ê¸€ë¦¿", "ì˜¤ë¡œ", "ì œë¡œë‹ˆ", "ì‹±í¬", "ë² ì´í¼í”Œë¡œ", "ì—ì´ë“ ", "ë£¨ë¯¸ë„ˆ", "ì½”ë”", "ì„œë¸Œ", "í…”ë ˆ", "ë¦¬ì…‹", "ë¯¸ëŸ¬", "ê³ ìŠ¤íŠ¸"];
    const kpopSongTitles = ["Black Out", "Glitch Mode", "Venomous Love", "Wildfire", "No Gravity", "Double Dare", "Phantom Pain", "Crimson Sky", "Thunderbolt", "Overload", "Shatter", "Iron Heart", "Vortex", "Unstoppable", "Midnight Chase", "Blue Lemonade", "Summer Breeze", "Sparkling", "Neon Dream", "Surf's Up", "Candy Cloud", "Electric Youth", "Paper Plane", "Star Gazing", "Wink", "Soda Pop", "Sun-Kissed", "Bubble Gum", "Kickboard", "Rainbow Bridge", "ë‹¬ì˜ ë’·ë©´", "ìƒˆë²½ ì„¸ ì‹œ", "ë¹„ë°€ì˜ ì •ì›", "Last Letter", "ì”ìƒ", "Mist", "ê¸°ì–µ ì¡°ê°", "Falling Star", "Urban Night", "ì ë“¤ì§€ ì•ŠëŠ” ë„ì‹œ", "Deep Blue", "ìš°ì£¼ ìœ ì˜", "Timeline", "Whisper", "Stardust", "Bad Attitude", "Level Up", "Money Talk", "Swagger", "On the Top", "Zero to One", "Game Changer", "Flashlight", "New Rules", "Vibe Check", "Backstage", "No Filter", "Hustle", "Iconic", "Last Shot", "High Tension", "Silver Lining", "Deja Vu", "Under the Radar", "Maverick", "Gravity Pull", "Velvet Rope", "Heartbeat Sensor", "After Party", "Neon Sign", "Blindfold", "Catalyst", "Golden Hour", "Wild Side", "Midnight Sun", "Prism", "Love Dive", "Satellite", "Break the Wall", "Egoist", "Blue Hour", "Cherry Bomb", "Dive In", "Focus On", "Get Loud", "Horizon", "In the Dark", "Just Go", "Keep It Real", "Lucid Dream", "Make a Wish", "Night Owl", "Off the Record", "Purple Night", "Quiet Riot", "Road Trip", "Stay Up", "Take a Chance", "Up and Down", "Vivid", "Way Home", "X-Ray", "Young and Free", "ZigZag", "ê°€ì‹œë°©ì„", "ê²¨ìš¸ì ", "ë‚˜ë¹„íš¨ê³¼", "ëˆˆë§ì¶¤", "ë‹¤ì‹œ ë§Œë‚  ë•Œê¹Œì§€", "ë§ˆì§€ë§‰ ì¶¤", "ë°¤í•˜ëŠ˜ì˜ ì €í¸", "ë¹„ë°€ë²ˆí˜¸", "ì‚¬ë§‰ì˜ ì˜¤ì•„ì‹œìŠ¤", "ì–´ì§€ëŸ¬ì›Œ", "ìœ ì„±ìš°", "ì´ë°©ì¸", "ì¢…ì´ì‹¬ì¥", "ì²«ëˆˆì—", "íƒœì–‘ ì•„ë˜ì„œ", "í˜¼ì£ë§"];
    const goodChats = ["í•˜ë°ìŠ¤ í¼ ë¯¸ì³¤ë‹¤ ã„·ã„·", "í‚¤ë§ˆ ëª©ì†Œë¦¬ ê·¹ë½ì´ë„¤", "ì‚¬ë‘í•´ í•˜ë°ìŠ¤!", "ì˜¤ëŠ˜ ì˜ìƒ ì°°ë–¡ì„", "ë…¸ë˜ ë¬´í•œë°˜ë³µ ì¤‘", "ëµê·¤ ê·€ì—¬ì›Œ ì£½ìŒ ã… ã… ", "ì±ˆë‚˜ ì¶¤ì„  ì‹¤í™”ëƒ", "ì—°ì´ˆë¡ ë¹„ì£¼ì–¼ ë¯¸ì¹¨", "ì†œì£¼ë¨¹ ì˜ˆëŠ¥ì‹  ê°•ë¦¼", "í•˜ë°ìŠ¤ ìŠˆìŠ¤ ê°€ì!!", "ì•„ë°”íƒ€ í€„ë¦¬í‹° ë¨¸ì„?", "ë°©ê¸ˆ ìœ™í¬ì— ì‹¬ë©í•¨", "ì˜¤ëŠ˜ë„ ì¶œì„ ì™„ë£Œ!", "ë²„ì¶”ì–¼ ì•„ì´ëŒ ì›íƒ‘ í•˜ë°ìŠ¤", "ì‘ì›ë²• ë‹¤ ì™¸ì› ë‹¤"];
    const badChats = ["ë…¸ë˜ ì‹¤ë ¥ ì‹¤í™”ëƒ ã…‹", "ë²„ì¶”ì–¼ ì™œ ë´„?", "ëª¨ë¸ë§ ê°œêµ¬ë¦¬ë„¤", "í•˜ë°ìŠ¤ ë…¸ì¼", "ì‘ ì•ˆ ë´~", "ì‹¤ë ¥ë„ ì—†ëŠ”ë° ì™œ ë‚˜ì˜´?", "ì–µì§€ í…ì…˜ ì—­ê²¹ë„¤", "í•´ì²´í•´ë¼ ã…‰ã…‰", "ì´ê²Œ ì•„ì´ëŒ? ã…‹", "ëª©ì†Œë¦¬ íŠ  ë„ˆë¬´ ì‹¬í•¨", "ë¦¬ê¹… ì—‰ë§ì´ë„¤", "ë°©ì†¡ ì‚¬ê³  ê°€ì¦ˆì•„", "ì–˜ë„¤ëŠ” ëœ° ìˆ˜ê°€ ì—†ìŒ", "ë…¸ë˜ ì¹´í”¼ ì•„ë‹˜?", "í‘œì • í•˜ë‚˜ë„ ì•ˆ ë§ë„¤"];

    let liveGameInterval;
    let badCommentsCaught = 0;

    function getRandomSong() { return kpopSongTitles[Math.floor(Math.random() * kpopSongTitles.length)]; }

    // === ê²Œì„ ìƒíƒœ ===
    let gameState = {
        day: 1, startDate: new Date('2025-09-05'), finance: 200000000, fandom: 110000, youtube: 20000, sns: 1000,
        accumulatedSales: 0, currentTier: "ë£¨í‚¤", activeCharts: [], rivalCharts: [],
        flags: { albumPaid: false, concertBought: false, concertDone: false },
        currentChartPlatform: 'subak', currentChartPeriod: 'daily',
        members: [
            createMember('í‚¤ë§ˆ', '04-22', 1, {vocal:8, dance:3, visual:3, variety:3, charm:3}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/29/513/80329513_20260120180131_org.jpg/melon/quality/80/optimize'), 
            createMember('ëµê·¤', '12-24', 2, {vocal:7, dance:3, visual:3, variety:4, charm:3}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/813/80326813_20251224160243_org.jpg/melon/quality/80/optimize'), 
            createMember('ì±ˆë‚˜', '02-26', 3, {vocal:2, dance:5, visual:9, variety:2, charm:2}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/812/80326812_20251224160127_org.jpg/melon/quality/80/optimize'),
            createMember('ì†œì£¼ë¨¹', '11-11', 4, {vocal:2, dance:2, visual:3, variety:9, charm:4}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/815/80326815_20251224160500_org.jpg/melon/quality/80/optimize'), 
            createMember('ì—°ì´ˆë¡', '03-26', 5, {vocal:7, dance:2, visual:5, variety:2, charm:4}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/814/80326814_20251224160415_org.jpg/melon/quality/80/optimize'),
        ],
        community: [], popupQueue: [], weeklyStats: [], hasPostedThisWeek: false,
        lastContents: { short: -999, mid: -999, long: -999 }, inventory: []
    };

    function createMember(name, birth, imgId, customStats, customUrl = null) {
        return { 
            name, birth, image: customUrl || `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`, 
            vocal: customStats.vocal, dance: customStats.dance, visual: customStats.visual, variety: customStats.variety, charm: customStats.charm, 
            fatigue: 0, mental: Math.floor(Math.random() * 60) + 40, manualAct: null, equipment: [] 
        };
    }

    // === ê²Œì„ ì‹œì‘ & ë¡œë“œ ===
    function startGame() {
        document.getElementById('start-page').style.display = 'none';
        document.getElementById('main-nav').style.display = 'flex';
        document.getElementById('main-container').style.display = 'block';
        document.getElementById('main-footer').style.display = 'block';
        initRivalCharts(); updateDisplay(); renderHomeCharts('subak', 'daily');
    }

    function initRivalCharts() {
        if (gameState.rivalCharts.length > 0) return;
        for(let i=0; i<60; i++) {
            const artist = rivalArtists[Math.floor(Math.random() * rivalArtists.length)];
            const title = getRandomSong();
            const baseScore = Math.floor(Math.random() * 9500) + 500;
            gameState.rivalCharts.push({
                artist, title,
                scores: { subak: createScoreObj(baseScore), musicside: createScoreObj(baseScore), tube: createScoreObj(baseScore) },
                prevRanks: { subak: 0, musicside: 0, tube: 0 }
            });
        }
        updateChartRanks();
    }
    function createScoreObj(base) { return { daily: base, monthly: base * 30, yearly: base * 365 }; }

    // === ë¯¸ë‹ˆê²Œì„: ë¼ì´ë¸Œ ë°©ì†¡ ===
    function startLiveGame(memberIdx) {
        const member = gameState.members[memberIdx];
        document.getElementById('live-member-name').innerText = member.name;
        document.getElementById('live-overlay').style.display = 'block';
        document.getElementById('live-chat-area').innerHTML = '';
        badCommentsCaught = 0;
        document.getElementById('bad-count').innerText = "0";

        let gameTime = 0;
        liveGameInterval = setInterval(() => {
            gameTime++;
            spawnChat();
            if (gameTime > 40) endLiveGame(memberIdx);
        }, 400);
    }

    function spawnChat() {
        const isBad = Math.random() < 0.35;
        const chatText = isBad ? badChats[Math.floor(Math.random() * badChats.length)] : goodChats[Math.floor(Math.random() * goodChats.length)];
        const bubble = document.createElement('div');
        bubble.className = `chat-bubble ${isBad ? 'chat-bad' : 'chat-good'}`;
        bubble.innerText = (isBad ? "ğŸš« " : "ğŸ’¬ ") + chatText;
        bubble.style.left = (Math.random() * 50 + 10) + "%";
        
        if (isBad) {
            bubble.onclick = function() {
                badCommentsCaught++;
                document.getElementById('bad-count').innerText = badCommentsCaught;
                this.style.transform = "scale(0)";
                this.style.opacity = "0";
                setTimeout(() => this.remove(), 200);
            };
        }
        document.getElementById('live-chat-area').appendChild(bubble);
        setTimeout(() => { if(bubble.parentNode) bubble.remove(); }, 3500);
    }

    function endLiveGame(memberIdx) {
        clearInterval(liveGameInterval);
        document.getElementById('live-overlay').style.display = 'none';
        const member = gameState.members[memberIdx];
        let resTitle, resText;
        if (badCommentsCaught >= 6) {
            resTitle = "âœ… í´ë¦° ë°©ì†¡ ëŒ€ì„±ê³µ!";
            resText = `${member.name}(ì´)ê°€ ì•…í”Œì„ ì™„ë²½í•˜ê²Œ ì°¨ë‹¨í•˜ë©° íŒ¬ì‹¬ì„ ì–»ì—ˆìŠµë‹ˆë‹¤! (íŒ¬ë¤ +5,000, ë©˜íƒˆ +20)`;
            updateFandom(5000); member.mental = Math.min(100, member.mental + 20);
        } else if (badCommentsCaught >= 2) {
            resTitle = "ğŸ˜ ë¬´ë‚œí•œ ì†Œí†µ ë°©ì†¡";
            resText = "ì•…í”Œì´ ìˆì—ˆì§€ë§Œ í° ë¬¸ì œ ì—†ì´ ë°©ì†¡ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤. (íŒ¬ë¤ +1,000)";
            updateFandom(1000);
        } else {
            resTitle = "ğŸ˜­ ë©˜íƒˆ ë°”ì‚¬ì‚­...";
            resText = "ìŸì•„ì§€ëŠ” ì•…í”Œì— ë©¤ë²„ê°€ í° ìƒì²˜ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤. (íŒ¬ë¤ -2,000, ë©˜íƒˆ -30)";
            updateFandom(-2000); member.mental = Math.max(0, member.mental - 30);
        }
        document.getElementById('modal-title').innerText = resTitle;
        document.getElementById('modal-body').innerText = resText;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">í™•ì¸</button>`;
        document.getElementById('eventModal').style.display = 'block';
        updateDisplay();
    }

    // === ìƒì  & ì»¨í…ì¸  ë°ì´í„° ===
    const shopItems = [
        { id: 'mic_1', name: 'USB ë§ˆì´í¬', price: 300000, stat: 'vocal', val: 1, desc: 'ê°€ì„±ë¹„ ë§ˆì´í¬ (ë³´ì»¬+1)' },
        { id: 'cam_1', name: 'FHD ì›¹ìº ', price: 500000, stat: 'visual', val: 1, desc: 'ê¸°ë³¸ ìº  (ë¹„ì£¼ì–¼+1)' },
        { id: 'light_1', name: 'ë°©ì†¡ìš© ì¡°ëª…', price: 800000, stat: 'charm', val: 1, desc: 'í™”ì‚¬í•œ ì¡°ëª… (ë§¤ë ¥+1)' },
        { id: 'mic_2', name: 'ì½˜ë´ì„œ ë§ˆì´í¬', price: 2000000, stat: 'vocal', val: 1, desc: 'ê¹”ë”í•œ ìŒì§ˆ (ë³´ì»¬+1)' },
        { id: 'cpu_1', name: 'ë°©ì†¡ ì†¡ì¶œì»´', price: 2500000, stat: 'variety', val: 1, desc: 'ë ‰ ì—†ëŠ” ë°©ì†¡ (ì˜ˆëŠ¥+1)' },
        { id: 'tracker_1', name: 'ë³´ê¸‰í˜• íŠ¸ë˜ì»¤', price: 3000000, stat: 'dance', val: 1, desc: 'ê¸°ë³¸ì ì¸ ì›€ì§ì„ (ëŒ„ìŠ¤+1)' }
    ];
    const contentTypes = {
        short: { id: 'short', name: 'ì»¤ë²„ê³¡ / ìˆì¸  ì±Œë¦°ì§€', type: 'ë‹¨ê¸°', badge: 'badge-short', cooldown: 14, cost: 2000000, risk: 10, rewardMin: 1500, rewardMax: 3000 },
        mid: { id: 'mid', name: 'í•©ë™ ëª¨ì…˜ìº¡ì³ ê¸°íš', type: 'ì¤‘ê¸°', badge: 'badge-mid', cooldown: 30, cost: 15000000, risk: 20, rewardMin: 8000, rewardMax: 15000 },
        long: { id: 'long', name: 'ì‹±ê¸€ ë°œë§¤ / ë‹¨ë… ì½˜ì„œíŠ¸', type: 'ì¥ê¸°', badge: 'badge-long', cooldown: 90, cost: 50000000, risk: 30, rewardMin: 40000, rewardMax: 80000 }
    };
    const newsHeadlines = ["ë²„ì¶”ì–¼ ì‹œì¥ ê¸‰ì„±ì¥", "ëŒ€ê¸°ì—…, ë²„ì¶”ì–¼ ì§„ì¶œ", "MZì„¸ëŒ€ ì¥ë˜í¬ë§ 1ìœ„ í¬ë¦¬ì—ì´í„°", "ìŒë°©ì— ë²„ì¶”ì–¼ ë“±ì¥", "8K ëª¨ì…˜ìº¡ì³ ì‹œëŒ€", "ìœ ëª… ì‘ê³¡ê°€ ë²„ì¶”ì–¼ í˜‘ì—… í¬ë§", "K-POP ë‹¤ìŒì€ V-POP?", "ë²„ì¶”ì–¼ êµ¿ì¦ˆ í’ˆê·€"];
    const upgradeConfig = { 0: { chance: 0.8, costMult: 0.3 }, 1: { chance: 0.5, costMult: 0.6 }, 2: { chance: 0.3, costMult: 1.0 } };
    const tierOrder = ["UNRANKED", "ë£¨í‚¤", "ë¼ì´ì§•ìŠ¤íƒ€", "êµ­ë‚´ì—ì„œ ì•Œë ¤ì§", "ì•„ì‹œì•„ì—ì„œ ì•Œë ¤ì§", "ë¶ë¯¸ì—ì„œ ì•Œë ¤ì§", "ì „ì„¸ê³„ì—ì„œ ì•Œë ¤ì§"];

    // === í•µì‹¬ ì‹œìŠ¤í…œ í•¨ìˆ˜ ===
    function updateFandom(val) {
        gameState.fandom = Math.max(0, gameState.fandom + val);
        gameState.youtube += Math.floor(val * 0.7);
        gameState.sns += Math.floor(val * 1.2);
    }
    function calculateTierScore() {
        return gameState.fandom + Math.floor(gameState.youtube * 0.5) + Math.floor(gameState.sns * 0.2) + Math.floor(gameState.accumulatedSales / 10000);
    }
    function getTierInfo(score) {
        if (score >= 15000000) return { name: "ì „ì„¸ê³„ì—ì„œ ì•Œë ¤ì§", class: "tier-world" };
        if (score >= 6000000) return { name: "ë¶ë¯¸ì—ì„œ ì•Œë ¤ì§", class: "tier-na" };
        if (score >= 2000000) return { name: "ì•„ì‹œì•„ì—ì„œ ì•Œë ¤ì§", class: "tier-asia" };
        if (score >= 600000) return { name: "êµ­ë‚´ì—ì„œ ì•Œë ¤ì§", class: "tier-domestic" };
        if (score >= 200000) return { name: "ë¼ì´ì§•ìŠ¤íƒ€", class: "tier-rising" };
        return { name: "ë£¨í‚¤", class: "tier-rookie" };
    }

    function updateChartRanks() {
        const allSongs = [];
        gameState.rivalCharts.forEach(rc => allSongs.push({ artist: rc.artist, title: rc.title, scores: rc.scores, isPlayer: false, ref: rc }));
        gameState.activeCharts.forEach(ac => { if(ac.weekCount < 6) allSongs.push({ artist: "HADES", title: ac.name, scores: ac.scores, isPlayer: true, ref: ac }); });
        ['subak', 'musicside', 'tube'].forEach(plat => {
            allSongs.sort((a, b) => b.scores[plat].daily - a.scores[plat].daily);
            allSongs.forEach((song, idx) => {
                if(!song.ref.prevRanks) song.ref.prevRanks = {};
                song.ref.prevRanks[plat] = idx + 1;
                if(song.isPlayer && plat === 'subak') song.ref.rank = idx + 1;
            });
        });
    }

    function updateDisplay() {
        document.getElementById('current-day').innerText = gameState.day;
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        document.getElementById('current-date').innerText = d.toISOString().split('T')[0];
        document.getElementById('p-finance').innerText = gameState.finance.toLocaleString() + 'ì›';
        document.getElementById('p-fandom').innerText = gameState.fandom.toLocaleString() + 'ëª…';
        document.getElementById('p-youtube').innerText = gameState.youtube.toLocaleString() + 'ëª…';
        document.getElementById('p-sns').innerText = gameState.sns.toLocaleString() + 'ëª…';
        document.getElementById('p-sales').innerText = gameState.accumulatedSales.toLocaleString() + 'ì›';
        const score = calculateTierScore();
        const tierInfo = getTierInfo(score);
        document.getElementById('p-tier').innerText = tierInfo.name;
        document.getElementById('chart-section').style.display = (d >= new Date('2025-12-26')) ? 'block' : 'none';
        
        const reactionHtml = gameState.community.slice(-10).reverse().map(c => `<div class="ticker-item"><span class="ticker-site site-sns">${c.site}</span> ${c.content}</div>`).join('');
        document.getElementById('reaction-ticker').innerHTML = reactionHtml || '<div class="ticker-item">ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</div>';
        
        renderMemberGrid();
        renderHomeCharts(gameState.currentChartPlatform, gameState.currentChartPeriod);
    }

    function renderMemberGrid() {
        document.getElementById('member-grid-container').innerHTML = gameState.members.map((m, idx) => {
            const bonuses = { vocal:0, dance:0, visual:0, variety:0, charm:0 };
            m.equipment.forEach(eq => { bonuses[eq.stat] += (eq.val + (eq.level*2)); });
            let mentalIcon = m.mental >= 80 ? "ğŸ’" : (m.mental <= 30 ? "â˜ï¸" : "ğŸ™‚");
            return `<div class="member-card">
                <button class="equip-btn" onclick="openEquipModal(${idx})">ğŸ’ ì¥ë¹„/ê°•í™”</button>
                <div class="profile-container">
                    <img src="${m.image}" class="profile-img">
                    <div class="profile-info">
                        <strong>${m.name} ${mentalIcon}</strong><div style="font-size:11px; color:#999;">ğŸ‚ ${m.birth}</div>
                    </div>
                </div>
                ${renderStat('ë³´ì»¬', m.vocal, bonuses.vocal, 'var(--vocal)')}
                ${renderStat('ëŒ„ìŠ¤', m.dance, bonuses.dance, 'var(--dance)')}
                ${renderStat('ë¹„ì£¼ì–¼', m.visual, bonuses.visual, 'var(--visual)')}
                ${renderStat('ì˜ˆëŠ¥', m.variety, bonuses.variety, 'var(--variety)')}
                ${renderStat('ë§¤ë ¥', m.charm, bonuses.charm, 'var(--charm)')}
                <div class="equipped-items">${m.equipment.length > 0 ? m.equipment.map(e => `[${e.level>0?`+${e.level} `:''}${e.name}]`).join(' ') : 'ì¥ë¹„ ì—†ìŒ'}</div>
                <div style="font-size:11px; text-align:right; color:#888;">í”¼ë¡œë„: ${m.fatigue}%</div>
            </div>`;
        }).join('');
    }
    function renderStat(l, base, bonus, c) { 
        return `<div class="stat-row"><div class="stat-label">${l}</div><div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${Math.min(100, (base+bonus)*2)}%; background:${c}"></div></div><div style="font-size:10px;">${base}${bonus>0?`(+${bonus})`:''}</div></div>`; 
    }

    function nextDay() {
        if (document.getElementById('eventModal').style.display === 'block' || document.getElementById('live-overlay').style.display === 'block') return;
        if (gameState.finance < -50000000) { alert("íŒŒì‚°í–ˆìŠµë‹ˆë‹¤!"); location.reload(); return; }

        let dailyProfit = Math.floor(Math.random() * 800001) + 400000;
        gameState.finance += dailyProfit; gameState.accumulatedSales += dailyProfit;
        updateFandom(Math.floor(dailyProfit / 10000));

        gameState.members.forEach(m => {
            let act = m.manualAct || ['vocal','dance','visual','variety','charm','rest'][Math.floor(Math.random()*6)];
            if(act === 'rest') { m.fatigue = Math.max(0, m.fatigue-30); m.mental = Math.min(100, m.mental+10); }
            else { 
                if(Math.random()<0.3) m[act]++; 
                m.fatigue = Math.min(100, m.fatigue+20);
            }
            m.manualAct = null;
        });

        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        
        // ë¼ì´ë¸Œ ë°©ì†¡ í™•ë¥ ì  ë°œìƒ (15%)
        if (Math.random() < 0.15) {
            const ridx = Math.floor(Math.random() * 5);
            gameState.popupQueue.push({
                type: 'live_stream',
                event: {
                    id: 'live_'+gameState.day, title: "ğŸš¨ ê¸´ê¸‰ ë¼ì´ë¸Œ ë°©ì†¡!", 
                    desc: `${gameState.members[ridx].name}(ì´)ê°€ íŒ¬ë“¤ê³¼ ì†Œí†µí•˜ê¸° ìœ„í•´ ë°©ì†¡ì„ ì¼°ìŠµë‹ˆë‹¤. ì•…í”Œì´ ì˜¬ë¼ì˜¤ë©´ í´ë¦­í•´ì„œ ì°¨ë‹¨í•˜ì„¸ìš”!`,
                    choices: [{ text: "ë°©ì†¡ ì‹œì‘ (Game Start)", effect: () => startLiveGame(ridx) }]
                }
            });
        }

        if (gameState.day % 3 === 0) gameState.community.push({site:'íŒ¬ì¹´í˜', content: `ì˜¤ëŠ˜ í•˜ë°ìŠ¤ ë°©ì†¡ ëŒ€ë°•ì„ ã… ã… `});
        
        processCharts();
        checkDateEvents(d);
        
        document.getElementById('profit-report').style.display = 'block';
        document.getElementById('profit-content').innerHTML = `ì¼ì¼ ìˆ˜ìµ: <span class="money-text">${dailyProfit.toLocaleString()}ì›</span>`;
        
        gameState.day++; updateDisplay(); processNextPopup();
    }

    function processNextPopup() {
        if (document.getElementById('eventModal').style.display === 'block' || gameState.popupQueue.length === 0) return;
        const item = gameState.popupQueue.shift();
        renderEventPopup(item.event);
    }
    let currentEvent = null;
    function renderEventPopup(ev) {
        currentEvent = ev;
        document.getElementById('modal-title').innerText = ev.title;
        document.getElementById('modal-body').innerText = ev.desc;
        document.getElementById('modal-choices').innerHTML = ev.choices.map((c, i) => `<button class="choice-btn" onclick="handleChoice(${i})">${c.text}</button>`).join('');
        document.getElementById('eventModal').style.display = 'block';
    }
    function handleChoice(idx) { 
        const effect = currentEvent.choices[idx].effect;
        closeModal(); 
        if(effect) effect(); 
    }
    function closeModal() { document.getElementById('eventModal').style.display = 'none'; setTimeout(processNextPopup, 100); }

    function switchChartPlatform(p) { gameState.currentChartPlatform = p; updateDisplay(); }
    function switchChartPeriod(p) { gameState.currentChartPeriod = p; updateDisplay(); }

    function renderHomeCharts(plat, period) {
        const container = document.getElementById('chart-list-container');
        const all = [];
        gameState.rivalCharts.forEach(s => all.push({...s, isPlayer: false}));
        gameState.activeCharts.forEach(s => { if(s.weekCount < 6) all.push({...s, artist: "HADES", title: s.name, isPlayer: true}); });
        all.sort((a, b) => b.scores[plat][period] - a.scores[plat][period]);
        container.innerHTML = all.slice(0, 10).map((s, i) => `
            <div class="chart-row ${s.isPlayer?'my-song':''}">
                <div class="rank">${i+1}</div>
                <div class="song-info"><span class="song-title">${s.title}</span><span class="artist-name">${s.artist}</span></div>
                <div class="chart-score">${Math.floor(s.scores[plat][period]).toLocaleString()}</div>
            </div>`).join('');
    }

    function checkDateEvents(d) {
        const ds = d.toISOString().split('T')[0];
        if (ds === '2025-12-25') {
            gameState.popupQueue.push({ type: 'event', event: { title: "ğŸ’¸ ì •ì‚°ì˜ ë‚ ", desc: "í†µí•© ì •ì‚° 1.6ì–µì›ì´ í•„ìš”í•©ë‹ˆë‹¤.", choices: [{ text: "ë‚©ë¶€í•˜ê¸°", effect: () => { gameState.finance-=160000000; gameState.flags.albumPaid=true; } }] } });
        }
    }

    function processCharts() {
        gameState.activeCharts.forEach(ac => {
            if(ac.weekCount < 6) {
                ac.scores.subak.daily += 1000 + Math.floor(Math.random()*500);
                ac.scores.musicside.daily += 1000;
                ac.scores.tube.daily += 1000;
                ['subak','musicside','tube'].forEach(p => { ac.scores[p].monthly += ac.scores[p].daily; ac.scores[p].yearly += ac.scores[p].daily; });
            }
        });
        updateChartRanks();
    }

    function openPage(p, btn) {
        document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        if(p==='store') renderShop();
    }

    function renderShop() {
        document.getElementById('shop-list').innerHTML = shopItems.map(item => `
            <div class="content-card">
                <div class="content-header"><strong>${item.name}</strong></div>
                <div class="content-info">ğŸ’° ${item.price.toLocaleString()}ì›</div>
                <button class="content-btn btn-available" onclick="buyItem('${item.id}')">êµ¬ë§¤í•˜ê¸°</button>
            </div>`).join('');
    }
    function buyItem(id) {
        const itm = shopItems.find(i=>i.id===id);
        if(gameState.finance >= itm.price) {
            gameState.finance -= itm.price;
            gameState.inventory.push({...itm, level:0});
            alert("êµ¬ë§¤ ì™„ë£Œ!"); updateDisplay();
        }
    }

    function openEquipModal(idx) {
        const m = gameState.members[idx];
        document.getElementById('modal-title').innerText = `${m.name} ì¥ë¹„`;
        document.getElementById('modal-body').innerHTML = gameState.inventory.map((it, i) => `<button class="choice-btn" onclick="equip(${idx}, ${i})">${it.name} ì¥ì°©</button>`).join('');
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">ë‹«ê¸°</button>`;
        document.getElementById('eventModal').style.display = 'block';
    }
    function equip(mIdx, iIdx) {
        const itm = gameState.inventory.splice(iIdx, 1)[0];
        gameState.members[mIdx].equipment.push(itm);
        closeModal(); updateDisplay();
    }

    function saveGame() { localStorage.setItem('hades_save_v24', JSON.stringify(gameState)); alert("ì €ì¥ë¨"); }
    function loadGame() { 
        const s = localStorage.getItem('hades_save_v24'); 
        if(s) { gameState = JSON.parse(s); gameState.startDate = new Date(gameState.startDate); updateDisplay(); alert("ë¡œë“œë¨"); }
    }

    window.addEventListener('keydown', e => { if(e.code === 'Space') nextDay(); });
</script>
</body>
</html>
