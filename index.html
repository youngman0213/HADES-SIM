
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•˜ë°ìŠ¤ í‚¤ìš°ê¸° v24.1 (Studio Update)</title>
    <style>
        :root { --bg: #f8f9fa; --card: #ffffff; --point: #ff4d94; --text: #333; --border: #e9ecef; --success: #40c057; --vocal: #ff4d94; --dance: #ae3ec9; --visual: #4dadff; --variety: #fab005; --charm: #f06595; --money: #2b8a3e; --danger: #fa5252; --sns: #405de6; --yt: #ff0000; --yz: #000000; --subak: #0ca678; --musicside: #1c7ed6; --tube: #f03e3e; --rep: #fd7e14; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; margin: 0; padding: 0; line-height: 1.5; overflow-x: hidden; user-select: none; }
        
        /* ì‹œì‘ & ë„¤ë¹„ */
        #start-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #212529 0%, #343a40 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; color: white; text-align: center; }
        .start-logo { font-size: 3rem; font-weight: 900; color: var(--point); margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,77,148,0.5); }
        .start-btn { padding: 18px 60px; background: var(--point); color: white; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 10px 20px rgba(255,77,148,0.3); transition: 0.3s; }
        .start-btn:hover { transform: scale(1.05); }
        .nav-bar { display: none; background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-btn { flex: 1; padding: 15px 5px; border: none; background: transparent; color: #868e96; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.2s; white-space: nowrap; }
        .nav-btn.active { color: var(--point); border-bottom: 3px solid var(--point); background: #fffafc; }
        
        /* ë ˆì´ì•„ì›ƒ */
        .container { display: none; max-width: 800px; margin: 0 auto; padding: 15px 15px 100px 15px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); position: relative; }
        .date-display { position: relative; text-align: right; margin-bottom: 10px; }
        @media (min-width: 600px) { .date-display { position: absolute; top: 15px; right: 25px; } }
        .day-count { font-weight: bold; color: var(--point); font-size: 18px; display: block; }
        .real-date { font-size: 12px; color: #888; }
        h2 { color: #222; font-size: 1.1rem; margin-top: 0; border-left: 4px solid var(--point); padding-left: 10px; margin-bottom: 15px; }
        .money-text { color: var(--money); font-weight: bold; }
        
        /* ë‰´ìŠ¤ í‹°ì»¤ */
        .ticker-container { background: #343a40; color: white; padding: 12px 0; overflow: hidden; white-space: nowrap; position: relative; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .ticker-wrapper { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 20px; font-size: 13px; }
        .ticker-site { font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 4px; margin-right: 5px; vertical-align: middle; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        .site-ebem { background: #e7f5ff; color: #1971c2; }
        .site-cafe { background: #fff0f6; color: #d6336c; }
        .site-sns { background: #f0f1ff; color: var(--sns); }
        .site-yt { background: #ffe3e3; color: var(--yt); }
        .site-yz { background: #495057; color: #fff; }
        .site-news { background: #fa5252; color: #fff; }
        .site-music { background: #e6fcf5; color: #0ca678; }

        /* ìŠ¤íƒ¯ */
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .stat-item { background: #f8f9fa; padding: 12px; border-radius: 12px; border: 1px solid #f1f3f5; }
        .stat-item small { color: #868e96; font-size: 11px; }
        .stat-item strong { font-size: 14px; display: block; margin-top: 4px; }
        
        /* ì°¨íŠ¸ */
        .chart-tabs { display: flex; border: 1px solid var(--border); border-radius: 8px 8px 0 0; overflow: hidden; }
        .chart-tab-btn { flex: 1; border: none; background: #f8f9fa; padding: 12px; cursor: pointer; font-size: 14px; font-weight: bold; color: #888; transition: 0.2s; }
        .chart-tab-btn.active { background: white; color: #333; }
        .chart-tab-btn.subak.active { color: var(--subak); border-bottom: 3px solid var(--subak); }
        .chart-tab-btn.musicside.active { color: var(--musicside); border-bottom: 3px solid var(--musicside); }
        .chart-tab-btn.tube.active { color: var(--tube); border-bottom: 3px solid var(--tube); }
        .sub-chart-tabs { display: flex; background: #fff; border-bottom: 1px solid var(--border); margin-bottom: 10px; padding: 5px; gap: 5px; }
        .sub-tab-btn { flex: 1; border: 1px solid transparent; background: transparent; padding: 6px; cursor: pointer; font-size: 11px; color: #666; border-radius: 20px; transition: 0.2s; }
        .sub-tab-btn.active { background: #333; color: white; font-weight: bold; }
        .chart-list { min-height: 350px; }
        .chart-row { display: flex; align-items: center; padding: 10px 5px; border-bottom: 1px solid #f1f3f5; font-size: 13px; }
        .chart-row.my-song { background: #fff0f6; border-radius: 8px; border: 1px solid #fcc2d7; }
        .rank { width: 30px; font-weight: 900; text-align: center; margin-right: 10px; color: #495057; }
        .rank-change { width: 30px; font-size: 10px; text-align: center; margin-right: 5px; color: #888; }
        .rank-up { color: var(--danger); }
        .rank-down { color: #1c7ed6; }
        .song-info { flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .chart-score { font-size: 10px; color: #868e96; text-align: right; width: 60px; font-variant-numeric: tabular-nums; }

        /* ë©¤ë²„ */
        .member-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 650px) { .member-grid { grid-template-columns: repeat(2, 1fr); } }
        .member-card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; transition: 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.02); }
        .profile-container { display: flex; align-items: center; margin-bottom: 10px; }
        .profile-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); margin-right: 12px; background: #eee; }
        .stat-row { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; }
        .stat-label { width: 40px; color: #777; font-size: 11px; }
        .stat-bar-bg { flex: 1; height: 8px; background: #f1f3f5; border-radius: 4px; overflow: hidden; margin: 0 8px; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: 0.5s; }
        .bonus-stat { color: var(--success); font-weight: bold; font-size: 10px; margin-left: 4px; }
        .trait-badge { font-size:10px; padding:2px 6px; border-radius:4px; background:#e9ecef; color:#495057; margin-right:4px; font-weight:bold; }
        .trait-good { background:#d3f9d8; color:#2b8a3e; }
        .trait-bad { background:#ffe3e3; color:#fa5252; }
        .position-select { font-size:11px; padding:2px; border:1px solid #ddd; border-radius:4px; margin-left:auto; cursor:pointer; }
        .equip-btn { position: absolute; top: 15px; right: 15px; padding: 5px 10px; background: #333; color: white; font-size: 11px; border-radius: 5px; border:none; cursor: pointer; }
        .equipped-items { margin-top: 10px; font-size: 11px; color: #666; background: #f8f9fa; padding: 8px; border-radius: 6px; min-height: 20px;}

        /* ì»¨í…ì¸  & ìƒì  */
        .content-card { border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 12px; background: #fff; transition:0.2s; position: relative; }
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .content-badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .badge-short { background: #e3fafc; color: #0c8599; }
        .badge-mid { background: #f3f0ff; color: #6741d9; }
        .badge-long { background: #fff0f6; color: #c2255c; }
        .badge-item { background: #f3f0ff; color: #5c7cfa; }
        .badge-special { background: #fff5f5; color: #ff0000; border: 1px solid #ffc9c9; }
        .content-btn { width: 100%; padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-available { background: var(--point); box-shadow: 0 4px 6px rgba(255, 77, 148, 0.2); }
        .btn-available:hover { filter: brightness(0.9); }
        .btn-cooldown { background: #adb5bd; cursor: not-allowed; }
        .content-info { font-size: 12px; color: #555; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px; }

        /* ê³µìš© */
        .next-day-bar { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 12px; border-top: 1px solid var(--border); text-align: center; z-index: 100; box-sizing: border-box; }
        .primary-btn { width: 100%; padding: 14px; background: var(--point); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; transition:0.2s; }
        .primary-btn:hover { background: #e64980; }
        .choice-btn { width: 100%; padding: 14px; background: #f1f3f5; color: #333; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; margin-bottom: 8px; text-align: left; font-size: 14px; display: flex; justify-content: space-between; align-items: center; transition:0.2s; }
        
        .modal-overlay { display: none; position: fixed; z-index: 9000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter: blur(3px); }
        .modal-content { background:white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding:25px; width: 85%; max-width:400px; border-radius:20px; text-align:center; box-sizing: border-box; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        /* ì•¨ë²” ì œì‘ ëª¨ë‹¬ */
        .slider-container { margin-bottom: 15px; text-align: left; }
        .slider-label { font-size: 12px; font-weight: bold; display: flex; justify-content: space-between; margin-bottom: 5px; }
        .stat-slider { width: 100%; accent-color: var(--point); }
        .upgrade-btn { padding: 4px 8px; font-size: 11px; background: #7950f2; color:white; border:none; border-radius:4px; cursor:pointer; margin-left:5px; font-weight:bold; }

        /* ë¯¸ë‹ˆê²Œì„ (ì±„íŒ…) */
        #game-screen { position: relative; width: 100%; height: 250px; background: #000; overflow: hidden; border-radius: 10px; margin-bottom: 15px; display: none; }
        .chat-msg { position: absolute; color: white; font-weight: bold; white-space: nowrap; user-select: none; cursor: pointer; padding: 5px 10px; border-radius: 4px; font-size: 14px; animation: floatUp linear forwards; }
        .chat-bad { color: #ff6b6b; border: 1px solid #ff6b6b; z-index: 10; }
        .chat-good { color: #ffffff; opacity: 0.7; pointer-events: none; }
        @keyframes floatUp { from { transform: translateY(250px); } to { transform: translateY(-50px); } }

        .tier-badge { font-size: 16px; font-weight: 900; margin: 10px 0; display: inline-block; padding: 8px 20px; border-radius: 50px; color:white; }
        .tier-rookie { background: #ced4da; color: #495057; }
        .tier-rising { background: #74c0fc; }
        .tier-domestic { background: #40c057; }
        .tier-asia { background: #fab005; }
        .tier-na { background: #e64980; }
        .tier-world { background: linear-gradient(45deg, #a5d8ff, #7950f2, #ff8787); }
    </style>
</head>
<body>

<div id="start-page">
    <div class="start-logo">HADES</div>
    <div class="start-sub">Virtual Idol Maker v24.1</div>
    <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
</div>

<div class="nav-bar" id="main-nav">
    <button class="nav-btn active" onclick="openPage('home', this)">ğŸ“Š í™ˆ</button>
    <button class="nav-btn" onclick="openPage('members', this)">ğŸ‘¥ ë©¤ë²„</button>
    <button class="nav-btn" onclick="openPage('contents', this)">ğŸ¬ ê¸°íš</button>
    <button class="nav-btn" onclick="openPage('store', this)">ğŸ¢ ê²½ì˜</button>
    <button class="nav-btn" onclick="openPage('manual', this)">ğŸ“… ì§€ì‹œ</button>
</div>

<div class="container" id="main-container">
    <div id="home" class="page active">
        <div class="ticker-container">
            <div class="ticker-wrapper" id="reaction-ticker">
                <div class="ticker-item">ë¡œë“œ ì¤‘...</div>
            </div>
        </div>

        <div class="card">
            <div class="date-display">
                <span class="day-count">ìš´ì˜ <span id="current-day">1</span>ì¼ì°¨</span>
                <span class="real-date" id="current-date">2025-09-05</span>
            </div>
            <h2>ìƒíƒœ</h2>
            <div class="stat-grid">
                <div class="stat-item"><small>ë³´ìœ  ìì‚°</small><strong id="p-finance" class="money-text">200,000,000ì›</strong></div>
                <div class="stat-item"><small>ëŒ€ì¤‘ í‰íŒ</small><strong id="p-rep" style="color:var(--rep);">100</strong></div>
                <div class="stat-item"><small>íŒ¬ì¹´í˜ íšŒì›</small><strong id="p-fandom">110,000ëª…</strong></div>
                <div class="stat-item"><small>í˜„ì¬ ì¸ì§€ë„</small><strong id="p-tier" style="color:#7950f2;">ë£¨í‚¤</strong></div>
                <div class="stat-item"><small>ëˆ„ì  ë§¤ì¶œ</small><strong id="p-sales">0ì›</strong></div>
                <div class="stat-item"><small>ìŠ¤íŠœë””ì˜¤</small><strong id="p-office">ë°©êµ¬ì„ ì›¹ìº </strong></div>
            </div>
        </div>

        <div class="card" id="chart-section" style="display:none;">
            <h2>ğŸ† ì‹¤ì‹œê°„ í†µí•© ì°¨íŠ¸</h2>
            <div class="chart-tabs">
                <button class="chart-tab-btn subak active" onclick="switchChartPlatform('subak')">ğŸˆ ìˆ˜ë°•</button>
                <button class="chart-tab-btn musicside" onclick="switchChartPlatform('musicside')">ğŸ’¿ ë®¤ì§ì‚¬ì´ë“œ</button>
                <button class="chart-tab-btn tube" onclick="switchChartPlatform('tube')">ğŸ“º ë„ˆíŠœë¸Œ</button>
            </div>
            <div class="sub-chart-tabs">
                <button class="sub-tab-btn active" onclick="switchChartPeriod('daily')">ğŸ“… ì¼ê°„</button>
                <button class="sub-tab-btn" onclick="switchChartPeriod('monthly')">ğŸŒ” ì›”ê°„</button>
                <button class="sub-tab-btn" onclick="switchChartPeriod('yearly')">ğŸ‘‘ ì—°ê°„</button>
            </div>
            <div id="chart-list-container" class="chart-list"></div>
        </div>

        <div class="card" id="profit-report" style="display:none; background: #f2fcf0; border-color: #40c057;">
            <h2>ğŸˆ ì¼ì¼ ë¦¬í¬íŠ¸</h2>
            <div id="profit-content" style="font-size: 14px;"></div>
        </div>
        
        <div class="save-load-btns">
            <button class="save-btn" onclick="saveGame()">ğŸ’¾ ë°ì´í„° ì €ì¥</button>
            <button class="save-btn" style="background:#212529;" onclick="loadGame()">ğŸ“‚ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
    </div>

    <div id="members" class="page">
        <div class="member-grid" id="member-grid-container"></div>
    </div>

    <div id="contents" class="page">
        <div class="card">
            <h2>ğŸ”¥ ìŠ¤í˜ì…œ í”„ë¡œì íŠ¸ (í•œì •)</h2>
            <div id="special-content-list"></div>
        </div>
        <div class="card">
            <h2>ğŸ¬ ì¼ë°˜ ì»¨í…ì¸  ì œì‘</h2>
            <div id="content-list"></div>
        </div>
    </div>

    <div id="store" class="page">
        <div class="card">
            <h2>ğŸ¢ ìŠ¤íŠœë””ì˜¤ ë° ì¸ë ¥</h2>
            <div id="office-list"></div>
        </div>
        <div class="card">
            <h2>ğŸ›ï¸ ë°©ì†¡ ì¥ë¹„ ìƒì </h2>
            <div id="shop-list"></div>
        </div>
    </div>

    <div id="manual" class="page">
        <div class="card">
            <h2>ìˆ˜ë™ ì§€ì‹œ</h2>
            <select id="sel-member" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;"></select>
            <select id="sel-stat" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
                <option value="vocal">ğŸ¤ ë³´ì»¬ ì§‘ì¤‘ í›ˆë ¨</option>
                <option value="dance">ğŸ’ƒ ì•ˆë¬´ ì—°ìŠµ</option>
                <option value="visual">âœ¨ ë¹„ì£¼ì–¼ ì¼€ì–´</option>
                <option value="variety">ğŸ—£ï¸ ì˜ˆëŠ¥ ìŠ¤í”¼ì¹˜</option>
                <option value="charm">ğŸ€ ë§¤ë ¥ ê°•í™”</option>
                <option value="stream">ğŸ“¡ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</option>
                <option value="rest">ğŸ’¤ ê¿€ê°™ì€ íœ´ì‹</option>
            </select>
            <button class="primary-btn" onclick="manualTrainAction()">ì§€ì‹œ ì™„ë£Œ</button>
        </div>
    </div>
</div>

<div class="next-day-bar" id="main-footer">
    <button class="primary-btn" style="background: #40c057;" onclick="nextDay()">ğŸŒ™ ë‹¤ìŒë‚ ë¡œ (Space)</button>
</div>

<!-- í†µí•© ëª¨ë‹¬ -->
<div id="eventModal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modal-title"></h2>
        <div id="modal-body" style="margin: 15px 0; font-size: 14px;"></div>
        
        <!-- ë¯¸ë‹ˆê²Œì„ í™”ë©´ -->
        <div id="game-screen">
            <div style="position:absolute; top:10px; left:10px; color:white; font-size:12px;">ì•…í”Œì„ í´ë¦­í•´ì„œ ì œê±°í•˜ì„¸ìš”!</div>
            <div id="game-score" style="position:absolute; top:10px; right:10px; color:#40c057; font-weight:bold;">SCORE: 0</div>
            <div id="chat-layer"></div>
        </div>

        <!-- ì•¨ë²” ì œì‘ í™”ë©´ -->
        <div id="album-maker" style="display:none;">
            <div style="background:#f8f9fa; padding:10px; border-radius:8px; margin-bottom:15px; font-size:12px;">
                ì˜ˆì‚°: <span style="font-weight:bold; color:var(--point);">5,000ë§Œì›</span><br>
                ë‚¨ì€ ë¹„ì¤‘: <span id="remain-pct">0</span>%
            </div>
            <div class="slider-container">
                <div class="slider-label"><span>ğŸµ ìŒì•… í€„ë¦¬í‹°</span><span id="val-music">25%</span></div>
                <input type="range" class="stat-slider" id="sl-music" value="25" min="0" max="100" oninput="updateSliders('music')">
            </div>
            <div class="slider-container">
                <div class="slider-label"><span>ğŸ“½ï¸ MV ì—°ì¶œ</span><span id="val-mv">25%</span></div>
                <input type="range" class="stat-slider" id="sl-mv" value="25" min="0" max="100" oninput="updateSliders('mv')">
            </div>
            <div class="slider-container">
                <div class="slider-label"><span>ğŸ“¢ ë°”ì´ëŸ´ ë§ˆì¼€íŒ…</span><span id="val-viral">25%</span></div>
                <input type="range" class="stat-slider" id="sl-viral" value="25" min="0" max="100" oninput="updateSliders('viral')">
            </div>
            <div class="slider-container">
                <div class="slider-label"><span>ğŸ‘— ì˜ìƒ/ì»¨ì…‰</span><span id="val-outfit">25%</span></div>
                <input type="range" class="stat-slider" id="sl-outfit" value="25" min="0" max="100" oninput="updateSliders('outfit')">
            </div>
        </div>

        <div id="modal-choices"></div>
    </div>
</div>

<script>
    // === ë°ì´í„° ===
    const rivalArtists = ["ì‹œí€€ì„œ", "ë””ì§€ë…¸ë¯¹", "ê¸€ë¦¬ì¹˜ë¬¸", "ë‰´ëŸ´ì›¨ì´ë¸Œ", "ë¹„íŠ¸ì…¸", "ì½”ì–´ë§í¬", "ì‚¬ì´ë²„ë¦¬í”„", "í”½ì…€í—¤ì´ì¦ˆ", "ì‹±í¬ë¹„ì „", "ë²¡í„°ë³´ì´ì¦ˆ", "ì•Œê³ ë¦¬ë“¬", "í”Œë¡œíŒ…ì¹©", "ì–¸ë¦¬ì–¼ì†Œìš¸", "ì„œë¸Œë ˆì´ì–´", "ë©”íƒ€ëª¨í”„", "í•˜ì´í¼ë£¨í”„", "ì‹ ìŠ¤í”Œë¡œìš°", "ëˆ„í´ë¦¬ì–´ìŠ¤", "KRYX", "LYNQ", "V-ZIT", "X-IEL", "JOYN", "N-ZIA", "RYZE-O", "QUV", "W-AVE", "SYLK", "F-REEL", "G-LOWD", "VEXEN", "TYRO", "Z-EEN"];
    const kpopSongTitles = ["Black Out", "Glitch Mode", "Venomous Love", "Wildfire", "No Gravity", "Double Dare", "Phantom Pain", "Crimson Sky", "Thunderbolt", "Overload", "Shatter", "Iron Heart", "Vortex", "Unstoppable", "Midnight Chase", "Blue Lemonade", "Summer Breeze", "Sparkling", "Neon Dream", "Surf's Up", "Candy Cloud", "Electric Youth", "Paper Plane", "Star Gazing", "Wink", "Soda Pop", "Sun-Kissed", "Bubble Gum", "Kickboard", "Rainbow Bridge", "ë‹¬ì˜ ë’·ë©´", "ìƒˆë²½ ì„¸ ì‹œ", "ë¹„ë°€ì˜ ì •ì›", "Last Letter", "ì”ìƒ", "Mist", "ê¸°ì–µ ì¡°ê°", "Falling Star", "Urban Night", "ì ë“¤ì§€ ì•ŠëŠ” ë„ì‹œ"];

    const traitsList = [
        { id: 'glass', name: 'ìœ ë¦¬ë©˜íƒˆ', type: 'bad', desc: 'ë©˜íƒˆ ê°ì†Œ 2ë°°', effect: 'mental_down' },
        { id: 'hard', name: 'ì—°ìŠµë²Œë ˆ', type: 'good', desc: 'ì„±ì¥ ì†ë„ 1.5ë°°', effect: 'grow_up' },
        { id: 'star', name: 'ìŠˆí¼ìŠ¤íƒ€', type: 'good', desc: 'íŒ¬ ìœ ì… ì¦ê°€', effect: 'fan_up' },
        { id: 'lazy', name: 'ê²Œìœ¼ë¦„', type: 'bad', desc: 'í”¼ë¡œë„ íšŒë³µ ëŠë¦¼', effect: 'rest_down' },
        { id: 'tough', name: 'ê°•ì² ë©˜íƒˆ', type: 'good', desc: 'ë©˜íƒˆ ë°©ì–´ë ¥ ë†’ìŒ', effect: 'mental_up' }
    ];

    const studioTiers = [
        { name: "ë°©êµ¬ì„ ì›¹ìº ", cost: 0, effect: "ì—†ìŒ" },
        { name: "ë Œíƒˆ ìŠ¤íŠœë””ì˜¤", cost: 50000000, effect: "í”¼ë¡œë„ íšŒë³µ +5" },
        { name: "ì „ìš© ëª¨ì…˜ìº¡ì³ ë£¸", cost: 300000000, effect: "íŒ¬ ìœ ì… +10%" },
        { name: "8K XR ë¼ì´ë¸Œ ìŠ¤í…Œì´ì§€", cost: 1000000000, effect: "ëª¨ë“  ìŠ¤íƒ¯ ì„±ì¥ +10%" }
    ];

    const staffTypes = [
        { id: 'manager', name: 'ë§¤ë‹ˆì €', salary: 3000000, desc: 'ë§¤ì¼ í”¼ë¡œë„ -5', hired: false },
        { id: 'marketer', name: 'ë§ˆì¼€í„°', salary: 4000000, desc: 'ë§¤ì¼ ì¸ì§€ë„ ìƒìŠ¹', hired: false },
        { id: 'trainer', name: 'íŠ¸ë ˆì´ë„ˆ', salary: 3500000, desc: 'í›ˆë ¨ íš¨ìœ¨ ì¦ê°€', hired: false }
    ];

    function getRandomSong() { return kpopSongTitles[Math.floor(Math.random() * kpopSongTitles.length)]; }

    // === ê²Œì„ ì´ˆê¸°í™” ===
    function startGame() {
        document.getElementById('start-page').style.display = 'none';
        document.getElementById('main-nav').style.display = 'flex';
        document.getElementById('main-container').style.display = 'block';
        document.getElementById('main-footer').style.display = 'block';
        initRivalCharts(); 
        updateDisplay();
        renderHomeCharts('subak', 'daily');
    }

    function createMember(name, birth, imgId, customStats, customUrl = null) {
        let stats = customStats;
        const mental = Math.floor(Math.random() * 90) + 11; 
        const imageUrl = customUrl ? customUrl : `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`;
        const trait = traitsList[Math.floor(Math.random() * traitsList.length)];
        return { 
            name, birth, image: imageUrl, 
            vocal: stats.vocal, dance: stats.dance, visual: stats.visual, variety: stats.variety, charm: stats.charm, 
            fatigue: 0, mental: mental, manualAct: null, equipment: [],
            trait: trait, position: 'none'
        };
    }

    let gameState = {
        day: 1, startDate: new Date('2025-09-05'), finance: 200000000, fandom: 110000, youtube: 20000, sns: 1000,
        reputation: 100, accumulatedSales: 0, 
        currentTier: "ë£¨í‚¤",
        activeCharts: [], rivalCharts: [],
        flags: { albumPaid: false, concertBought: false, concertDone: false },
        studioLevel: 0,
        staff: { manager: false, marketer: false, trainer: false },
        currentChartPlatform: 'subak', currentChartPeriod: 'daily',
        members: [
            createMember('í‚¤ë§ˆ', '04-22', 1, {vocal:8, dance:3, visual:3, variety:3, charm:3}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/29/513/80329513_20260120180131_org.jpg/melon/quality/80/optimize'), 
            createMember('ëµê·¤', '12-24', 2, {vocal:7, dance:3, visual:3, variety:4, charm:3}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/813/80326813_20251224160243_org.jpg/melon/quality/80/optimize'), 
            createMember('ì±ˆë‚˜', '02-26', 3, {vocal:2, dance:5, visual:9, variety:2, charm:2}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/812/80326812_20251224160127_org.jpg/melon/quality/80/optimize'),
            createMember('ì†œì£¼ë¨¹', '11-11', 4, {vocal:2, dance:2, visual:3, variety:9, charm:4}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/815/80326815_20251224160500_org.jpg/melon/quality/80/optimize'), 
            createMember('ì—°ì´ˆë¡', '03-26', 5, {vocal:7, dance:2, visual:5, variety:2, charm:4}, 'https://cdnimg.melon.co.kr/cm2/photo/images/000/803/26/814/80326814_20251224160415_org.jpg/melon/quality/80/optimize'),
        ],
        community: [], popupQueue: [], weeklyStats: [],
        lastContents: { short: -999, mid: -999, long: -999 },
        inventory: []
    };

    function initRivalCharts() {
        if (gameState.rivalCharts.length > 0) return;
        for(let i=0; i<60; i++) {
            const artist = rivalArtists[Math.floor(Math.random() * rivalArtists.length)];
            const title = getRandomSong();
            const baseScore = Math.floor(Math.random() * 9500) + 500;
            const createScoreObj = (base) => ({ daily: base, monthly: base * 30 + Math.floor(Math.random()*5000), yearly: base * 365 + Math.floor(Math.random()*50000) });
            gameState.rivalCharts.push({ artist, title, scores: { subak: createScoreObj(baseScore), musicside: createScoreObj(baseScore), tube: createScoreObj(baseScore) }, prevRanks: { subak: 0, musicside: 0, tube: 0 } });
        }
        updateChartRanks();
    }
    
    const shopItems = [
        { id: 'mic_1', name: 'USB ë§ˆì´í¬', price: 300000, stat: 'vocal', val: 1, desc: 'ê°€ì„±ë¹„ ë§ˆì´í¬ (ë³´ì»¬+1)' },
        { id: 'cam_1', name: 'FHD ì›¹ìº ', price: 500000, stat: 'visual', val: 1, desc: 'ê¸°ë³¸ ìº  (ë¹„ì£¼ì–¼+1)' },
        { id: 'light_1', name: 'ë°©ì†¡ìš© ì¡°ëª…', price: 800000, stat: 'charm', val: 1, desc: 'í™”ì‚¬í•œ ì¡°ëª… (ë§¤ë ¥+1)' },
        { id: 'mic_2', name: 'ì½˜ë´ì„œ ë§ˆì´í¬', price: 2000000, stat: 'vocal', val: 1, desc: 'ê¹”ë”í•œ ìŒì§ˆ (ë³´ì»¬+1)' },
        { id: 'cpu_1', name: 'ë°©ì†¡ ì†¡ì¶œì»´', price: 2500000, stat: 'variety', val: 1, desc: 'ë ‰ ì—†ëŠ” ë°©ì†¡ (ì˜ˆëŠ¥+1)' },
        { id: 'tracker_1', name: 'ë³´ê¸‰í˜• íŠ¸ë˜ì»¤', price: 3000000, stat: 'dance', val: 1, desc: 'ê¸°ë³¸ì ì¸ ì›€ì§ì„ (ëŒ„ìŠ¤+1)' }
    ];

    const contentTypes = {
        short: { id: 'short', name: 'ì»¤ë²„ê³¡ / ìˆì¸  ì±Œë¦°ì§€', type: 'ë‹¨ê¸°', badge: 'badge-short', cooldown: 14, cost: 2000000, risk: 10, desc: 'íŠ¸ë Œë“œë¥¼ ë”°ë¼ê°€ëŠ” ê°€ë²¼ìš´ ì»¨í…ì¸ ', rewardMin: 1500, rewardMax: 3000 },
        mid: { id: 'mid', name: 'í•©ë™ ëª¨ì…˜ìº¡ì³ ê¸°íš', type: 'ì¤‘ê¸°', badge: 'badge-mid', cooldown: 30, cost: 15000000, risk: 20, desc: 'íƒ€ ê¸°ì—…ì„¸/ê°œì¸ì„¸ì™€ ê¸°ìˆ  ì œíœ´ í•©ë°©', rewardMin: 8000, rewardMax: 15000 },
        long: { id: 'long', name: 'ìì²´ ì œì‘ ì•¨ë²” (ì „ëµ)', type: 'ì¥ê¸°', badge: 'badge-long', cooldown: 60, cost: 50000000, risk: 0, desc: 'ì§ì ‘ í”„ë¡œë“€ì‹±í•˜ëŠ” ì •ê·œ ì•¨ë²”', rewardMin: 0, rewardMax: 0 }
    };

    const ebemMsgs = ["í•˜ë°ìŠ¤ ì–˜ë„¤ëŠ” ì§„ì§œ ëª¨ë¸ë§ í€„ë¦¬í‹°ê°€ ë³¼ ë•Œë§ˆë‹¤ ê°íƒ„ ë‚˜ì˜¤ë„¤.", "í‚¤ë§ˆ ì˜¤ëŠ˜ ê³ ìŒ ëš«ë¦¬ëŠ” ê±° ë³´ë‹ˆê¹Œ ëª© ìƒíƒœ ìµœìƒì¸ ë“¯?", "ëµê·¤ ë°©ì†¡ ê°ê°ì€ ì§„ì§œ íƒ€ê³ ë‚¬ë‹¤. ì˜¤ë””ì˜¤ ì•ˆ ë¹„ëŠ” ê±° ë´ë¼ ã…‹ã…‹ã…‹", "ì—°ì´ˆë¡ ì•„ë°”íƒ€ í…ìŠ¤ì²˜ ìˆ˜ì •í•œ ê±°ì„? ê´‘íƒì´ ì¢€ ë‹¬ë¼ì§„ ê±° ê°™ì€ë°.", "ì†”ì§íˆ ì´ ì •ë„ í€„ë¦¬í‹°ë©´ ë©”ì´ì €ë‘ ë¹„ë²¼ë„ ì•ˆ ê¿€ë¦¼.", "ì•„ë‹ˆ ì±ˆë‚˜ ì¶¤ì„  ì–µê¹Œí•˜ë˜ ë†ˆë“¤ ë‹¤ ì–´ë”” ê°”ëƒ? ë¦¬ê¹… ìì—°ìŠ¤ëŸ¬ìš´ ê±° ë´ë¼.", "ì†œì£¼ë¨¹ ì˜ˆëŠ¥ê° ë¯¸ì³¤ë„¤. ì˜¤ëŠ˜ í´ë¦½ ê° í•˜ë‚˜ ë‚˜ì™”ë‹¤.", "ê·¼ë° í•˜ë°ìŠ¤ ì• ë“¤ ì—°ìŠµëŸ‰ ì§„ì§œ ì¥ë‚œ ì•„ë‹Œ ë“¯. ì„±ì¥ ì†ë„ê°€ ë³´ì„.", "ë°©ê¸ˆ ë¦¬ì•¡ì…˜ íƒ€ì´ë° ì§€ë ¸ë‹¤. ì´ê²Œ ë²„ì¶”ì–¼ì˜ ë§›ì´ì§€.", "í•˜ë°ìŠ¤ ìœ ì…ì¸ë° ì…ë• ê°€ì´ë“œ ì–´ë””ì„œ ë´„?", "ì˜¤ëŠ˜ ë°©ì†¡ ë³´ê³  êµ¬ë… ëˆŒë €ë‹¤. ë…¸ë˜ ì£¼ë¨¸ë‹ˆ ë“ ë“ í•˜ë„¤.", "ì–˜ë„¤ëŠ” ë©¤ë²„ë“¤ë¼ë¦¬ í‹°í‚¤íƒ€ì¹´ê°€ ì˜ ë¼ì„œ ë³´ê¸° í¸í•¨.", "ì—°ì´ˆë¡ ë¹„ì£¼ì–¼ ì‹¤í™”ëƒ? ì¸ë„¤ì¼ ë³´ê³  í™€ë¦° ë“¯ ë“¤ì–´ì˜´.", "ì†”ì§íˆ 3D ë¼ì´ë¸Œ í•  ë•Œë§ˆë‹¤ ê¸°ìˆ ë ¥ ë°œì „í•˜ëŠ” ê±° ì²´ê°ë¨.", "í‚¤ë§ˆ ëª©ì†Œë¦¬ëŠ” ì§„ì§œ ë…ë³´ì ì´ë‹¤. ì»¤ë²„ê³¡ í•˜ë‚˜ ë” ë½‘ì•„ì£¼ë¼.", "ì˜¤ëŠ˜ ëµê·¤ ë“œë¦½ ë•Œë¬¸ì— ê´‘ëŒ€ ì•„íŒŒì„œ ë°©ì†¡ ëª» ë³´ê² ìŒ ã…‹ã…‹ã…‹", "í•˜ë°ìŠ¤ ì •ë„ë©´ ë²„ì¶”ì–¼ ì”¬ì—ì„œ íƒ‘í‹°ì–´ ì¸ì •ì´ì§€."];
    const cafeMsgs = ["í•˜ë°ìŠ¤ ë©¤ë²„ë“¤ ì˜¤ëŠ˜ë„ ê³ ìƒ ë§ì•˜ì–´ìš”! í‘¹ ì‰¬ì–´ìš”~", "ì¼€ë¡œ 1ê¸° ì—¬ê¸° ì—¬ê¸° ëª¨ì—¬ë¼! ìš°ë¦¬ í•˜ë°ìŠ¤ ì§€ì¼œ!", "í‚¤ë§ˆë‹˜ ëª©ì†Œë¦¬ëŠ” ì œ ì§€ì¹œ ì¼ìƒì˜ ìœ ì¼í•œ ë¹„íƒ€ë¯¼ì´ì—ìš”.", "ì˜¤ëŠ˜ ëµê·¤ë‹˜ ë•ë¶„ì— ë°°ê¼½ ë¹ ì§€ê²Œ ì›ƒì—ˆë„¤ìš”. í•­ìƒ ê³ ë§ˆì›Œìš”!", "ìš°ë¦¬ ì±ˆë‚˜ë‹˜ ë¯¸ëª¨ê°€ ë§¤ì¼ ê²½ì‹ ë˜ëŠ”ë°... ì œ ì‹¬ì¥ ì±…ì„ì§€ì„¸ìš”!", "ì—°ì´ˆë¡ë‹˜ì˜ ë”°ëœ»í•œ ìœ„ë¡œ ë°©ì†¡ ë•ë¶„ì— ì˜¤ëŠ˜ íë§í•˜ê³  ê°‘ë‹ˆë‹¤.", "ì†œì£¼ë¨¹ë‹˜ ë§¤ë ¥ì— í•œ ë²ˆ ë¹ ì§€ë©´ ì¶œêµ¬ê°€ ì—†ë‹¤ëŠ” ê²Œ í•™ê³„ì˜ ì •ì„¤!", "í•˜ë°ìŠ¤ ê³µì‹ êµ¿ì¦ˆ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”. í†µì¥ì€ ì¤€ë¹„ëìŠµë‹ˆë‹¤!", "ì˜¤ëŠ˜ ë¬´ëŒ€ ë³´ëŠ”ë° ëˆˆë¬¼ ë‚  ë»”í–ˆì–´ìš”. ìš°ë¦¬ ì• ë“¤ ë‹¤ ì»¸ë„¤...", "í•­ìƒ ë…¸ë ¥í•˜ëŠ” ëª¨ìŠµì´ ë„ˆë¬´ ì˜ˆìœ í•˜ë°ìŠ¤, ì˜¤ë˜ì˜¤ë˜ ê°€ì!", "íŒ¬ì•„íŠ¸ ê·¸ë ¤ë´¤ëŠ”ë° ì˜ˆì˜ê²Œ ë´ì£¼ì‹œë©´ ì¢‹ê² ì–´ìš”~", "ìš°ë¦¬ í•˜ë°ìŠ¤ ìŠˆìŠ¤ê¸¸ë§Œ ê±·ì! ì–¸ì œë‚˜ ì‘ì›í• ê²Œ.", "ë©¤ë²„ë“¤ ê±´ê°•ì´ ìµœìš°ì„ ì¸ ê±° ì•Œì£ ? ì•„í”„ì§€ ë§ˆìš” ã… ã… ", "ì˜¤ëŠ˜ ë°©ì†¡ë„ ë ˆì „ë“œ! í•˜ë°ìŠ¤ ë•ë¶„ì— ë‚´ì¼ ì¶œê·¼ë„ ë²„íŒë‹ˆë‹¤.", "ì„¸ìƒì—ì„œ ì œì¼ ë¹›ë‚˜ëŠ” 5ëª…ì˜ ë³„, í•˜ë°ìŠ¤ ì‚¬ë‘í•´!", "ì±ˆë‚˜ë‹˜ ëŒ„ìŠ¤ ë¸Œë ˆì´í¬ ë¶€ë¶„ ë¬´í•œ ë°˜ë³µ ì¤‘ì…ë‹ˆë‹¤. ë„ˆë¬´ ë©‹ì ¸ìš”!", "ë…¸ë˜ë©´ ë…¸ë˜, ì¶¤ì´ë©´ ì¶¤, ëª»í•˜ëŠ” ê²Œ ì—†ëŠ” í•˜ë°ìŠ¤ ìµœê³ !", "í•˜ë°ìŠ¤ ë§Œë‚˜ê³  ì œ ì‚¶ì´ í–‰ë³µí•´ì¡Œì–´ìš”. ê³ ë§ˆì›Œìš” ë©¤ë²„ë“¤!", "ì˜¤ëŠ˜ ë°¤ì€ í•˜ë°ìŠ¤ ë…¸ë˜ ë“¤ìœ¼ë©´ì„œ ì¢‹ì€ ê¿ˆ ê¿€ê²Œìš”~"];
    const yzMsgs = ["ì™€ ë…¸ë˜ í€„ë¦¬í‹° ë¯¸ì³¤ë„¤", "ë²„ì¶”ì–¼ íŒ ì»¤ì§€ê¸´ í–ˆë‹¤", "ì´ë²ˆ ì•¨ë²” ëŒ€ë°• ì¡°ì§ ë³´ì´ëŠ”ë°?", "ì†”ì§íˆ ì–˜ë„¤ê°€ ê¸°ìˆ ë ¥ì€ ì›íƒ‘ì¸ ë“¯", "ë¼ì´ë¸Œ ì•ˆì •ì ì¸ ê±° ë³´ì†Œ", "ë¹„ì£¼ì–¼ ë©¤ë²„ ëª¨ë¸ë§ ê¹ì€ ì‚¬ëŒ ìƒ ì¤˜ë¼", "ì˜¤ëŠ˜ ë°©ì†¡ ë ˆì „ë“œ ì°ì—ˆë„¤ ã…‹ã…‹", "í•˜ë°ìŠ¤ ë¶ì€ ì˜¨ë‹¤...", "êµ¬ë… ëˆŒë €ìŒ ê¸°ëŒ€í•´ë´„", "ì´ ì •ë„ë©´ ëŒ€ê¸°ì—… ì•„ë‹˜?"];
    const newsHeadlines = ["ë²„ì¶”ì–¼ ì‹œì¥ ê¸‰ì„±ì¥", "ëŒ€ê¸°ì—…, ë²„ì¶”ì–¼ ì§„ì¶œ", "MZì„¸ëŒ€ ì¥ë˜í¬ë§ 1ìœ„ í¬ë¦¬ì—ì´í„°", "ìŒë°©ì— ë²„ì¶”ì–¼ ë“±ì¥", "8K ëª¨ì…˜ìº¡ì³ ì‹œëŒ€", "ìœ ëª… ì‘ê³¡ê°€ ë²„ì¶”ì–¼ í˜‘ì—… í¬ë§", "K-POP ë‹¤ìŒì€ V-POP?", "ë²„ì¶”ì–¼ êµ¿ì¦ˆ í’ˆê·€", "ì •ë¶€ í¬ë¦¬ì—ì´í„° ì§€ì›", "ë©”íƒ€ë²„ìŠ¤ ì½˜ì„œíŠ¸ ì¸ê¸°"];
    const musicReactions = ["ì´ë²ˆ ë…¸ë˜ í¸ì˜ì ì—ì„œ ê³„ì† ë‚˜ì˜´ ã…‹ã…‹", "TV ê´‘ê³  ë³´ëŠ”ë° í•˜ë°ìŠ¤ ë…¸ë˜ ë‚˜ì™€ì„œ ê¹œë†€", "í›„ë ´êµ¬ ì§„ì§œ ì¤‘ë…ì„± ë¯¸ì³¤ë‹¤", "ê¸¸ê±°ë¦¬ ì§€ë‚˜ê°€ëŠ”ë° ì´ ë…¸ë˜ ë“¤ë¦¼", "ìˆ˜ëŠ¥ ê¸ˆì§€ê³¡ í™•ì •"];
    const upgradeConfig = { 0: { chance: 0.8, costMult: 0.3 }, 1: { chance: 0.5, costMult: 0.6 }, 2: { chance: 0.3, costMult: 1.0 } };
    const tierOrder = ["UNRANKED", "ë£¨í‚¤", "ë¼ì´ì§•ìŠ¤íƒ€", "êµ­ë‚´ì—ì„œ ì•Œë ¤ì§", "ì•„ì‹œì•„ì—ì„œ ì•Œë ¤ì§", "ë¶ë¯¸ì—ì„œ ì•Œë ¤ì§", "ì „ì„¸ê³„ì—ì„œ ì•Œë ¤ì§"];

    function saveGame() { localStorage.setItem('hades_save_v24', JSON.stringify(gameState)); alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); }
    function loadGame() { 
        const saved = localStorage.getItem('hades_save_v24'); 
        if (!saved) return alert("ë°ì´í„° ì—†ìŒ"); 
        const loaded = JSON.parse(saved);
        loaded.members.forEach((m, i) => { 
            if(!m.trait) m.trait = traitsList[Math.floor(Math.random() * traitsList.length)];
            if(!m.position) m.position = 'none';
        });
        if(!loaded.reputation) loaded.reputation = 100;
        if(!loaded.studioLevel) loaded.studioLevel = 0;
        if(!loaded.staff) loaded.staff = { manager: false, marketer: false, trainer: false };
        gameState = loaded; gameState.startDate = new Date(gameState.startDate); 
        updateDisplay(); alert("ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ"); 
    }

    // === ë©”ì¸ ê¸°ëŠ¥ ===
    window.addEventListener('keydown', e => { 
        if (e.code === 'Space') {
            const modal = document.getElementById('eventModal');
            if (modal.style.display === 'block') {
                if(document.getElementById('game-screen').style.display !== 'block') {
                    const btn = modal.querySelector('.primary-btn, .choice-btn');
                    if(btn) btn.click();
                }
            } else { if(document.getElementById('start-page').style.display === 'none') nextDay(); }
        }
    });

    function updateFandom(val) {
        let finalVal = val;
        if (gameState.studioLevel >= 2) finalVal = Math.floor(finalVal * 1.1);
        gameState.members.forEach(m => { if(m.trait.effect === 'fan_up') finalVal = Math.floor(finalVal * 1.05); });
        gameState.fandom = Math.max(0, gameState.fandom + finalVal);
        gameState.youtube += Math.floor(finalVal * 0.7);
        gameState.sns += Math.floor(finalVal * 1.2);
    }

    function updateReputation(val) {
        gameState.reputation = Math.max(0, Math.min(100, gameState.reputation + val));
        document.getElementById('p-rep').innerText = gameState.reputation;
        if(gameState.reputation <= 0) {
            alert("ğŸ“‰ í‰íŒì´ ë°”ë‹¥ì„ ì³¤ìŠµë‹ˆë‹¤.\nëŒ€ì¤‘ê³¼ íŒ¬ë“¤ì´ ë“±ì„ ëŒë ¤ ë” ì´ìƒ í™œë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nGAME OVER");
            location.reload();
        }
    }

    function getEquipVal(item) {
        let bonus = 0;
        if (item.level === 1) bonus = 1; else if (item.level === 2) bonus = 3; else if (item.level >= 3) bonus = 5;
        return item.val + bonus;
    }

    function calculateTierScore() {
        const salesScore = Math.floor(gameState.accumulatedSales / 10000);
        return gameState.fandom + Math.floor(gameState.youtube * 0.5) + Math.floor(gameState.sns * 0.2) + salesScore;
    }

    function getTierInfo(score) {
        if (score >= 15000000) return { name: "ì „ì„¸ê³„ì—ì„œ ì•Œë ¤ì§", class: "tier-world" };
        if (score >= 6000000) return { name: "ë¶ë¯¸ì—ì„œ ì•Œë ¤ì§", class: "tier-na" };
        if (score >= 2000000) return { name: "ì•„ì‹œì•„ì—ì„œ ì•Œë ¤ì§", class: "tier-asia" };
        if (score >= 600000) return { name: "êµ­ë‚´ì—ì„œ ì•Œë ¤ì§", class: "tier-domestic" };
        if (score >= 200000) return { name: "ë¼ì´ì§•ìŠ¤íƒ€", class: "tier-rising" };
        return { name: "ë£¨í‚¤", class: "tier-rookie" };
    }

    function updateDisplay() {
        document.getElementById('current-day').innerText = gameState.day;
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        document.getElementById('current-date').innerText = d.toISOString().split('T')[0];
        
        document.getElementById('p-finance').innerText = gameState.finance.toLocaleString() + 'ì›';
        document.getElementById('p-fandom').innerText = gameState.fandom.toLocaleString() + 'ëª…';
        document.getElementById('p-youtube').innerText = gameState.youtube.toLocaleString() + 'ëª…';
        document.getElementById('p-sales').innerText = gameState.accumulatedSales.toLocaleString() + 'ì›';
        document.getElementById('p-rep').innerText = gameState.reputation;
        document.getElementById('p-office').innerText = studioTiers[gameState.studioLevel].name;
        
        const score = calculateTierScore();
        const tierInfo = getTierInfo(score);
        const tierEl = document.getElementById('p-tier');
        tierEl.innerText = tierInfo.name;
        tierEl.className = ""; 
        if(score >= 15000000) tierEl.style.color = '#e64980'; else tierEl.style.color = '#7950f2';

        if (d >= new Date('2025-12-26')) document.getElementById('chart-section').style.display = 'block';
        else document.getElementById('chart-section').style.display = 'none';

        const reactionHtml = gameState.community.slice(-10).reverse().map(c => 
            `<div class="ticker-item"><span class="ticker-site ${c.site==='ì†ë³´'?'site-news':(c.site==='ìŒì›ë°˜ì‘'?'site-music':(c.site==='SNS'?'site-sns':(c.site==='ì—ë±€'?'site-ebem':(c.site==='ë„ˆíŠœë¸Œ'?'site-yt':(c.site==='YZ'?'site-yz':'site-cafe')))))}">${c.site}</span> ${c.content.replace(/<[^>]*>?/gm, '')}</div>`
        ).join('');
        document.getElementById('reaction-ticker').innerHTML = reactionHtml || '<div class="ticker-item">ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</div>';

        document.getElementById('member-grid-container').innerHTML = gameState.members.map((m, idx) => {
            const bonuses = { vocal:0, dance:0, visual:0, variety:0, charm:0 };
            m.equipment.forEach(eq => { if(bonuses[eq.stat] !== undefined) bonuses[eq.stat] += getEquipVal(eq); });
            let mentalIcon = m.mental >= 80 ? "ğŸ’" : (m.mental <= 30 ? "â˜ï¸" : "ğŸ™‚");
            
            return `
            <div class="member-card" style="${m.fatigue >= 100 ? 'border-color:var(--danger); background:#fff5f5;' : ''}">
                <button class="equip-btn" onclick="openEquipModal(${idx})">ğŸ’ ì¥ë¹„</button>
                <div class="profile-container">
                    <img src="${m.image}" class="profile-img">
                    <div class="profile-info">
                        <div style="font-size:16px; font-weight:bold;">${m.name} <span style="font-size:12px;">${mentalIcon}</span></div>
                        <div style="font-size:11px; color:#999;">
                            <span class="trait-badge ${m.trait.type === 'good' ? 'trait-good' : 'trait-bad'}">${m.trait.name}</span>
                        </div>
                    </div>
                    <select class="position-select" onchange="assignPosition(${idx}, this.value)">
                        <option value="none" ${m.position==='none'?'selected':''}>-</option>
                        <option value="leader" ${m.position==='leader'?'selected':''}>ë¦¬ë”</option>
                        <option value="center" ${m.position==='center'?'selected':''}>ì„¼í„°</option>
                        <option value="main_vocal" ${m.position==='main_vocal'?'selected':''}>ë©”ë³´</option>
                    </select>
                </div>
                ${renderStat('ë³´ì»¬', m.vocal, bonuses.vocal, 'var(--vocal)')}
                ${renderStat('ëŒ„ìŠ¤', m.dance, bonuses.dance, 'var(--dance)')}
                ${renderStat('ë¹„ì£¼ì–¼', m.visual, bonuses.visual, 'var(--visual)')}
                ${renderStat('ì˜ˆëŠ¥', m.variety, bonuses.variety, 'var(--variety)')}
                ${renderStat('ë§¤ë ¥', m.charm, bonuses.charm, 'var(--charm)')}
                <div class="equipped-items">${m.equipment.length > 0 ? m.equipment.map(e => `[${e.level>0?`+${e.level} `:''}${e.name}]`).join(' ') : 'ì¥ë¹„ ì—†ìŒ'}</div>
                <div style="font-size:11px; text-align:right; color:${m.fatigue >= 100 ? 'var(--danger)' : '#888'}; font-weight:bold; margin-top:5px;">í”¼ë¡œë„: ${m.fatigue}%</div>
            </div>`;
        }).join('');
        
        renderHomeCharts(gameState.currentChartPlatform, gameState.currentChartPeriod);
    }

    function renderStat(l, base, bonus, c) { 
        const total = base + bonus;
        return `<div class="stat-row">
            <div class="stat-label">${l}</div>
            <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${Math.min(100, (total/50)*100)}%; background:${total>=50?'#333':c}"></div></div>
            <div style="font-size:10px;">${base}${bonus > 0 ? `<span class="bonus-stat">(+${bonus})</span>` : ''}</div>
        </div>`; 
    }

    function assignPosition(idx, pos) {
        if(pos !== 'none') {
            gameState.members.forEach((m, i) => { if(i !== idx && m.position === pos) m.position = 'none'; });
        }
        gameState.members[idx].position = pos;
        updateDisplay();
    }

    function renderContents() {
        const specialList = document.getElementById('special-content-list');
        const isSettled = gameState.flags.albumPaid;
        
        let albumStatus = isSettled ? `<button class="content-btn btn-cooldown" disabled>âœ… í†µí•© ì •ì‚° ì™„ë£Œ</button>` : `<button class="content-btn btn-cooldown" disabled>ğŸ”’ 12ì›” 25ì¼ í†µí•© ì •ì‚° (1.6ì–µ í•„ìš”)</button>`;
        let concertStatus = isSettled ? (gameState.flags.concertDone ? `<button class="content-btn btn-cooldown" disabled>ğŸ ê°œìµœ ì™„ë£Œ</button>` : `<button class="content-btn btn-cooldown" disabled>âœ… ì˜ˆë§¤ ì™„ë£Œ (1ì›” 19ì¼ ê°œìµœ)</button>`) : `<button class="content-btn btn-cooldown" disabled>ğŸ”’ ì •ì‚° ì‹œ ìë™ ê¸°íš</button>`;

        specialList.innerHTML = `
            <div class="content-card" style="border-color:#ff4d94; background:#fff0f6;">
                <div class="content-header"><strong>ğŸ’¿ ì •ê·œ í”„ë¡œì íŠ¸ (MEGA PIECE & 2nd Earth)</strong><span class="content-badge badge-special">í•„ìˆ˜</span></div>
                <div class="content-info"><div>ğŸ’° 60,000,000ì›</div><div>ë°œë§¤ì¼: 12/26 & 01/09</div></div>
                ${albumStatus}
            </div>
            <div class="content-card" style="border-color:#ae3ec9; background:#f3f0ff;">
                <div class="content-header"><strong>ğŸ¤ ì˜¨ë¼ì¸ ì½˜ì„œíŠ¸ [B905]</strong><span class="content-badge badge-special">í•„ìˆ˜</span></div>
                <div class="content-info"><div>ğŸ’° 100,000,000ì›</div><div>ê°œìµœì¼: 26ë…„ 01ì›” 19ì¼</div></div>
                ${concertStatus}
            </div>
        `;

        const container = document.getElementById('content-list');
        container.innerHTML = Object.values(contentTypes).map(c => {
            const lastDay = gameState.lastContents[c.id];
            const remain = c.cooldown - (gameState.day - lastDay);
            const isAvailable = remain <= 0;
            let btnHtml = '';
            if (gameState.finance < c.cost) btnHtml = `<button class="content-btn btn-cooldown" disabled>ìê¸ˆ ë¶€ì¡±</button>`;
            else if (isAvailable) btnHtml = `<button class="content-btn btn-available" onclick="executeContent('${c.id}')">ì œì‘í•˜ê¸° (-${(c.cost/10000).toLocaleString()}ë§Œ)</button>`;
            else btnHtml = `<button class="content-btn btn-cooldown" disabled>ì¤€ë¹„ ì¤‘ (D-${remain})</button>`;
            return `<div class="content-card"><div class="content-header"><strong>${c.name}</strong><span class="content-badge ${c.badge}">${c.type}</span></div><div class="content-info"><div class="content-stat">ğŸ’° ${(c.cost/10000).toLocaleString()}ë§Œì›</div></div>${btnHtml}</div>`;
        }).join('');
    }

    function renderStudio() {
        // ìŠ¤íŠœë””ì˜¤
        const nextStudio = studioTiers[gameState.studioLevel + 1];
        let studioHtml = `<div class="content-card"><div class="content-header"><strong>ğŸ¥ ìŠ¤íŠœë””ì˜¤ í™•ì¥</strong><span class="content-badge badge-special">lv.${gameState.studioLevel}</span></div>`;
        if (nextStudio) {
            studioHtml += `<div class="content-info"><div>ğŸ’° ${nextStudio.cost.toLocaleString()}ì›</div><div>ë‹¤ìŒ ë‹¨ê³„: ${nextStudio.name} (${nextStudio.effect})</div></div>`;
            if (gameState.finance >= nextStudio.cost) studioHtml += `<button class="content-btn btn-available" onclick="upgradeStudio()">í™•ì¥í•˜ê¸°</button>`;
            else studioHtml += `<button class="content-btn btn-cooldown" disabled>ìê¸ˆ ë¶€ì¡±</button>`;
        } else {
            studioHtml += `<div class="content-info"><div>ìµœê³  ë ˆë²¨ ë„ë‹¬</div></div><button class="content-btn btn-cooldown" disabled>MAX LEVEL</button>`;
        }
        studioHtml += `</div>`;

        // ì§ì›
        let staffHtml = staffTypes.map(s => {
            const isHired = gameState.staff[s.id];
            return `<div class="content-card"><div class="content-header"><strong>ğŸ‘” ${s.name}</strong><span class="content-badge ${isHired?'badge-short':'badge-item'}">${isHired?'ê³ ìš©ì¤‘':'ë¯¸ê³ ìš©'}</span></div>
            <div class="content-info"><div>ì›”ê¸‰: ${s.salary.toLocaleString()}ì›</div><div>${s.desc}</div></div>
            ${isHired ? `<button class="content-btn btn-cooldown" disabled>ê³ ìš© ì¤‘</button>` : 
            (gameState.finance >= s.salary ? `<button class="content-btn btn-available" onclick="hireStaff('${s.id}')">ê³ ìš©í•˜ê¸°</button>` : `<button class="content-btn btn-cooldown" disabled>ìê¸ˆ ë¶€ì¡±</button>`)}
            </div>`;
        }).join('');

        document.getElementById('office-list').innerHTML = studioHtml + staffHtml;
    }

    function upgradeStudio() {
        const next = studioTiers[gameState.studioLevel + 1];
        gameState.finance -= next.cost;
        gameState.studioLevel++;
        alert(`ğŸ‰ ìŠ¤íŠœë””ì˜¤ë¥¼ [${next.name}]ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí–ˆìŠµë‹ˆë‹¤!\níš¨ê³¼: ${next.effect}`);
        updateDisplay(); renderStudio();
    }

    function hireStaff(id) {
        const staff = staffTypes.find(s => s.id === id);
        gameState.finance -= staff.salary; 
        gameState.staff[id] = true;
        alert(`${staff.name}ì„(ë¥¼) ê³ ìš©í–ˆìŠµë‹ˆë‹¤.\në§¤ë‹¬ ì›”ê¸‰ì´ ìë™ìœ¼ë¡œ ì§€ì¶œë©ë‹ˆë‹¤.`);
        updateDisplay(); renderStudio();
    }

    // === ì•¨ë²” ì œì‘ (ì „ëµ) ===
    let albumSettings = { music: 25, mv: 25, viral: 25, outfit: 25 };

    function executeContent(typeId) {
        if(typeId === 'long') {
            openAlbumMaker();
            return;
        }
        const content = contentTypes[typeId];
        gameState.finance -= content.cost;
        gameState.lastContents[typeId] = gameState.day;
        
        let resultTitle = "", resultText = "";
        let fatigueCost = typeId==='short'?10:25;
        if(gameState.members.some(m => m.position === 'leader')) fatigueCost -= 5;

        gameState.members.forEach(m => m.fatigue = Math.min(100, m.fatigue + fatigueCost));
        
        const roll = Math.floor(Math.random() * 100) + 1;
        let revenue = Math.floor(content.cost * 0.8);
        if (roll <= content.risk) {
            const loss = Math.floor(content.rewardMin * 0.3); updateFandom(-loss); updateReputation(-5);
            revenue = Math.floor(content.cost * 0.2); 
            resultTitle = "ğŸ˜± í­ë§..."; resultText = `ë°˜ì‘ì´ ì‹¸ëŠ˜í•©ë‹ˆë‹¤. (íŒ¬ë¤ -${loss}, í‰íŒ -5)`;
        } else if (roll > 90) { 
            const bonus = Math.floor(content.rewardMax * 1.5); 
            updateFandom(bonus); updateReputation(3);
            revenue = Math.floor(content.cost * 1.5);
            resultTitle = "ğŸ”¥ ëŒ€ë°•!"; resultText = `íŠ¸ë Œë“œ ì¥ì•…! (íŒ¬ë¤ +${bonus.toLocaleString()}, í‰íŒ +3)`;
        } else {
            const gain = Math.floor((content.rewardMax + content.rewardMin)/2); 
            updateFandom(gain);
            resultTitle = "âœ… ì™„ë£Œ"; resultText = `ë¬´ë‚œí•œ ë°˜ì‘ì…ë‹ˆë‹¤. (íŒ¬ë¤ +${gain.toLocaleString()})`;
        }
        gameState.finance += revenue; if(revenue > 0) gameState.accumulatedSales += revenue;
        
        document.getElementById('modal-title').innerText = resultTitle; document.getElementById('modal-body').innerHTML = resultText;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">í™•ì¸</button>`;
        document.getElementById('eventModal').style.display = 'block'; updateDisplay(); renderContents();
    }

    function openAlbumMaker() {
        document.getElementById('modal-title').innerText = "ğŸ’¿ ì•¨ë²” í”„ë¡œë“€ì‹±";
        document.getElementById('modal-body').innerHTML = ""; 
        document.getElementById('album-maker').style.display = 'block';
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="confirmAlbum()">ì œì‘ ì‹œì‘ (-5,000ë§Œì›)</button><button class="choice-btn" onclick="closeModal()">ì·¨ì†Œ</button>`;
        document.getElementById('eventModal').style.display = 'block';
        albumSettings = { music: 25, mv: 25, viral: 25, outfit: 25 };
        updateSliders('init');
    }

    function updateSliders(changed) {
        if(changed !== 'init') {
            let total = parseInt(document.getElementById('sl-music').value) + parseInt(document.getElementById('sl-mv').value) + parseInt(document.getElementById('sl-viral').value) + parseInt(document.getElementById('sl-outfit').value);
            let diff = 100 - total;
            document.getElementById('remain-pct').innerText = diff;
            document.getElementById('remain-pct').style.color = diff === 0 ? 'green' : 'red';
            
            albumSettings.music = parseInt(document.getElementById('sl-music').value);
            albumSettings.mv = parseInt(document.getElementById('sl-mv').value);
            albumSettings.viral = parseInt(document.getElementById('sl-viral').value);
            albumSettings.outfit = parseInt(document.getElementById('sl-outfit').value);
        }
        
        document.getElementById('val-music').innerText = document.getElementById('sl-music').value + "%";
        document.getElementById('val-mv').innerText = document.getElementById('sl-mv').value + "%";
        document.getElementById('val-viral').innerText = document.getElementById('sl-viral').value + "%";
        document.getElementById('val-outfit').innerText = document.getElementById('sl-outfit').value + "%";
    }

    function confirmAlbum() {
        let total = albumSettings.music + albumSettings.mv + albumSettings.viral + albumSettings.outfit;
        if(total !== 100) { alert("ë¹„ì¤‘ì˜ í•©ì´ 100%ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤."); return; }
        if(gameState.finance < 50000000) { alert("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }

        gameState.finance -= 50000000;
        gameState.lastContents['long'] = gameState.day;
        closeModal();

        const title = getRandomSong();
        const quality = Math.floor(Math.random() * 5000) + (albumSettings.music * 100);
        const createScoreObj = (base) => ({ daily: base, monthly: base*10, yearly: base*10 });
        let startScore = 3000 + (albumSettings.viral * 100); 

        gameState.activeCharts.push({ 
            name: title, weekCount: 0, releaseDate: new Date(),
            scores: { subak: createScoreObj(startScore), musicside: createScoreObj(startScore), tube: createScoreObj(startScore) },
            prevRanks: { subak: 0, musicside: 0, tube: 0 },
            quality: quality 
        });

        setTimeout(() => {
            alert(`ğŸ’¿ ì •ê·œ ì•¨ë²” <${title}> ë°œë§¤ ì™„ë£Œ!\n[ì „ëµ ê²°ê³¼]\nğŸµ ìŒì•…ì„±: ${albumSettings.music > 30 ? 'í˜¸í‰' : 'í‰ë²”'}\nğŸ“½ï¸ ì˜ìƒë¯¸: ${albumSettings.mv > 30 ? 'í™”ì œë¨' : 'ë¬´ë‚œ'}\n\nì°¨íŠ¸ì— ì§„ì…í•©ë‹ˆë‹¤.`);
            updateDisplay(); renderContents();
        }, 500);
    }

    // === ë¯¸ë‹ˆê²Œì„ (ì•…í”Œ í‡´ì¹˜) ===
    let gameTimer = null;
    let spawnTimer = null;
    let gameScore = 0;

    function startMiniGame() {
        document.getElementById('modal-title').innerText = "ğŸ“¡ ê¸´ê¸‰ ë¼ì´ë¸Œ ë°©ì†¡!";
        document.getElementById('modal-body').innerText = "";
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('modal-choices').style.display = 'none';
        document.getElementById('chat-layer').innerHTML = '';
        gameScore = 0;
        document.getElementById('game-score').innerText = "SCORE: 0";
        document.getElementById('eventModal').style.display = 'block';

        let timeLeft = 10;
        const badWords = ["ë…¸ë˜ ê°œëª»í•˜ë„¤", "ì€í‡´í•´ë¼", "ë§ê²œì´ë„¤", "ì´ê²Œ ì•„ì´ëŒ?", "ëˆ ì•„ê¹ë‹¤", "ëª¨ë¸ë§ ã…‰ã…‰"];
        const goodWords = ["ì‚¬ë‘í•´", "ì‘ì›í•´", "ë…¸ë˜ ì¢‹ë‹¤", "ê·€ì—¬ì›Œ", "í™”ì´íŒ…", "í‰ìƒ í•¨ê»˜í•´"];

        spawnTimer = setInterval(() => {
            const isBad = Math.random() < 0.4;
            const text = isBad ? badWords[Math.floor(Math.random()*badWords.length)] : goodWords[Math.floor(Math.random()*goodWords.length)];
            spawnChat(text, isBad);
        }, 400);

        gameTimer = setTimeout(() => { endMiniGame(); }, 10000); 
    }

    function spawnChat(text, isBad) {
        const el = document.createElement('div');
        el.className = `chat-msg ${isBad ? 'chat-bad' : 'chat-good'}`;
        el.innerText = text;
        el.style.left = Math.random() * 80 + "%";
        el.style.bottom = "-30px";
        
        if(isBad) {
            el.onclick = function() {
                gameScore += 10;
                document.getElementById('game-score').innerText = "SCORE: " + gameScore;
                el.remove();
            };
        }
        document.getElementById('chat-layer').appendChild(el);
        setTimeout(() => { if(el.parentNode) el.remove(); }, 3000);
    }

    function endMiniGame() {
        clearInterval(spawnTimer);
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('modal-choices').style.display = 'block';
        
        let reward = gameScore * 100; 
        let repChange = gameScore >= 50 ? 2 : (gameScore < 20 ? -2 : 0);
        
        updateFandom(reward);
        updateReputation(repChange);

        document.getElementById('modal-title').innerText = "ë°©ì†¡ ì¢…ë£Œ";
        document.getElementById('modal-body').innerText = `ì•…í”Œ í‡´ì¹˜ ì ìˆ˜: ${gameScore}ì \níŒ¬ë¤ ì¦ê°€: +${reward}ëª…\ní‰íŒ ë³€í™”: ${repChange>0?'+':''}${repChange}`;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">í™•ì¸</button>`;
    }

    function renderEventPopup(ev, isSpecial) {
        currentEvent = ev;
        document.getElementById('modal-title').innerText = ev.title; document.getElementById('modal-body').innerText = ev.desc;
        let choicesHtml = ev.choices.map((c, idx) => `<button class="${isSpecial && idx===0?'primary-btn':'choice-btn'}" onclick="handleChoice(${idx})" style="margin-bottom:5px;">${c.text}</button>`).join('');
        document.getElementById('modal-choices').innerHTML = choicesHtml; document.getElementById('eventModal').style.display = 'block';
    }

    let currentEvent;
    window.handleChoice = function(idx) { if(currentEvent && currentEvent.choices[idx]) { currentEvent.choices[idx].effect(); } closeModal(); };

    function showTrainingReport(logs) {
        document.getElementById('modal-title').innerText = "ğŸ—“ï¸ ì£¼ê°„ ê²°ì‚°";
        let listHtml = logs.length > 0 ? Object.entries(logs.reduce((acc, l) => { if (!acc[l.name]) acc[l.name] = []; acc[l.name].push(`${{vocal:'ë³´ì»¬',dance:'ëŒ„ìŠ¤',visual:'ë¹„ì£¼ì–¼',variety:'ì˜ˆëŠ¥',charm:'ë§¤ë ¥'}[l.stat]}â†‘`); return acc; }, {})).map(([n, s]) => `<div><b>${n}</b>: ${s.join(', ')}</div>`).join('') : "ë³€í™” ì—†ìŒ";
        document.getElementById('modal-body').innerHTML = `<div style="text-align:left; background:#f8f9fa; padding:15px; border-radius:10px;">${listHtml}</div>`;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">í™•ì¸ (Space)</button>`;
        document.getElementById('eventModal').style.display = 'block';
    }

    function closeModal() { document.getElementById('eventModal').style.display = 'none'; document.getElementById('album-maker').style.display = 'none'; setTimeout(processNextPopup, 150); }
    
    // === í˜ì´ì§€ ë° ê¸°íƒ€ ê¸°ëŠ¥ ===
    function openPage(pId, btn) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(pId).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active');
        if(pId === 'manual') document.getElementById('sel-member').innerHTML = gameState.members.map((m,i)=>`<option value="${i}">${m.name} (í”¼ë¡œ:${m.fatigue}%)</option>`).join('');
        if(pId === 'contents') renderContents();
        if(pId === 'store') { renderShop(); renderStudio(); }
    }
    
    function checkDateEvents(d) {
        const dateStr = d.toISOString().split('T')[0];
        if (dateStr === '2025-12-25') {
            gameState.popupQueue.unshift({ 
                type: 'settlement',
                event: {
                    id: 'settle_1225', title: 'ğŸ’¸ ìš´ëª…ì˜ í†µí•© ì •ì‚°ì¼', desc: 'MEGA PIECE, ë‘ ë²ˆì§¸ ì§€êµ¬, ê·¸ë¦¬ê³  ì˜¨ë¼ì¸ ì½˜ì„œíŠ¸ [B905] ëŒ€ê´€ë£Œ ì •ì‚°ì¼ì…ë‹ˆë‹¤.\n\ní•„ìš” ê¸ˆì•¡: 160,000,000ì›',
                    choices: [ { text: "í†µí•© ì •ì‚°í•˜ê¸° (1.6ì–µì› ì§€ë¶ˆ)", effect: () => payTotalCost() }, { text: "ëˆì´ ë¶€ì¡±í•˜ë‹¤... (íŒŒì‚°)", effect: () => { alert("ìê¸ˆ ë¶€ì¡±ìœ¼ë¡œ ë¶€ë„ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."); location.reload(); } } ]
                }
            });
        }
        if (dateStr === '2025-12-26' && gameState.flags.albumPaid) { launchSong("MEGA PIECE HARMONY"); }
        if (dateStr === '2026-01-09' && gameState.flags.albumPaid) { launchSong("ë‘ ë²ˆì§¸ ì§€êµ¬"); }
        if (dateStr === '2026-01-19') { if (gameState.flags.concertBought) { runConcert(); } }
    }
    
    function payTotalCost() {
        if (gameState.finance < 160000000) { alert("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤... íŒŒì‚°í–ˆìŠµë‹ˆë‹¤."); location.reload(); } else {
            gameState.finance -= 160000000; gameState.flags.albumPaid = true; gameState.flags.concertBought = true; 
            alert("í†µí•© ì •ì‚° ì™„ë£Œ!"); updateDisplay(); renderContents();
        }
    }

    function launchSong(title) {
        const createScoreObj = (base) => ({ daily: base, monthly: base*10, yearly: base*10 });
        const startScore = 5000;
        gameState.activeCharts.push({ 
            name: title, weekCount: 0, releaseDate: new Date(),
            scores: { subak: createScoreObj(startScore), musicside: createScoreObj(startScore), tube: createScoreObj(startScore) },
            prevRanks: { subak: 0, musicside: 0, tube: 0 }
        });
        gameState.popupQueue.push({ type: 'release', event: { id: 'rel_'+title, title: `ğŸ’¿ [ë°œë§¤] ${title}`, desc: `ë””ì§€í„¸ ì‹±ê¸€ <${title}>ê°€ ë°œë§¤ë˜ì—ˆìŠµë‹ˆë‹¤!`, choices: [{ text: "í™•ì¸", effect: () => updateDisplay() }] } });
    }

    function runConcert() {
        gameState.flags.concertDone = true;
        const viewers = Math.floor(Math.random() * 20000) + 40000; 
        const revenue = viewers * 33000;
        const fanInc = Math.floor(viewers * 0.3);
        gameState.finance += revenue; gameState.accumulatedSales += revenue; updateFandom(fanInc);
        gameState.popupQueue.push({ type: 'concert', event: { id: 'con_b905', title: 'ğŸ¤ ì½˜ì„œíŠ¸ ì¢…ë£Œ', desc: `ì ‘ì† ì‹œì²­ì: ${viewers.toLocaleString()}ëª…\nìˆ˜ìµ: ${revenue.toLocaleString()}ì›`, choices: [{ text: "íšŒì‹ (100ë§Œì›)", effect: () => { gameState.finance-=1000000; gameState.members.forEach(m=>m.mental=Math.min(100, m.mental+10)); } }] } });
        updateDisplay(); renderContents();
    }

    function processCharts() {
        let totalStat = 0; gameState.members.forEach(m => totalStat += (m.vocal+m.dance+m.visual+m.variety+m.charm));
        const teamScore = totalStat / 5;
        gameState.rivalCharts.forEach(rc => { ['subak', 'musicside', 'tube'].forEach(plat => { rc.scores[plat].daily += (Math.floor(Math.random()*1000)-400); rc.scores[plat].monthly+=rc.scores[plat].daily; rc.scores[plat].yearly+=rc.scores[plat].daily; })});
        gameState.activeCharts.forEach(ac => {
            if (ac.weekCount >= 6) return;
            const power = Math.floor(teamScore * 2);
            ac.scores.subak.daily += power + Math.floor(Math.random() * 600) - 200;
            ac.scores.musicside.daily += power + Math.floor(gameState.fandom/5000) + Math.floor(Math.random()*800)-400;
            ac.scores.tube.daily += power + Math.floor(Math.random()*1000)-500;
            ['subak', 'musicside', 'tube'].forEach(p => { ac.scores[p].monthly+=ac.scores[p].daily; ac.scores[p].yearly+=ac.scores[p].daily; });
        });
        updateChartRanks();
        gameState.activeCharts.forEach(ac => {
            if(ac.ref && ac.ref.rank <= 100) {
                const dailyRevenue = (101 - ac.ref.rank) * 10000;
                gameState.finance += dailyRevenue; gameState.accumulatedSales += dailyRevenue;
            }
        });
        if (gameState.day % 7 === 0) {
            gameState.activeCharts.forEach(song => {
                song.weekCount++;
                if (song.weekCount <= 5) gameState.popupQueue.push({ type: 'chart_week', event: { title: `ğŸ“Š ì£¼ê°„ ì°¨íŠ¸ (${song.weekCount}ì£¼ì°¨)`, desc: `<${song.name}>\nìˆ˜ë°•: ${song.prevRanks.subak}ìœ„`, choices: [{ text: "í™•ì¸", effect: () => {} }] } });
            });
        }
    }

    function updateChartRanks() {
        const allSongs = [];
        gameState.rivalCharts.forEach(rc => allSongs.push({ artist: rc.artist, title: rc.title, scores: rc.scores, isPlayer: false, ref: rc }));
        gameState.activeCharts.forEach(ac => { if(ac.weekCount < 6) allSongs.push({ artist: "HADES", title: ac.name, scores: ac.scores, isPlayer: true, ref: ac }); });
        ['subak', 'musicside', 'tube'].forEach(plat => {
            allSongs.sort((a, b) => b.scores[plat].daily - a.scores[plat].daily);
            allSongs.forEach((song, idx) => {
                if(!song.ref.prevRanks) song.ref.prevRanks = {};
                song.ref.prevRanks[plat] = idx + 1;
                if(song.isPlayer && plat === 'subak') song.ref.rank = idx + 1;
            });
        });
    }

    function checkBirthday() {
        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        let todayStr = `${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        gameState.members.forEach(m => { if(m.birth === todayStr) gameState.popupQueue.push({type: 'birthday', event: { id:'bday_'+m.name, title: `ğŸ‚ ${m.name} ìƒì¼`, desc: `ì˜¤ëŠ˜ì€ ${m.name}ì˜ ìƒì¼ì…ë‹ˆë‹¤!`, choices: [{ text: "íŒŒí‹° (íŒ¬ë¤+10000)", effect: () => updateFandom(10000) }] }}); });
    }

    function checkBusinessProposal() {
        if (gameState.day > 30 && gameState.day % 60 === 15) { 
            const types = ["êµ¿ì¦ˆ íŒì—…ìŠ¤í† ì–´", "íŒ¬ë¯¸íŒ…", "ì½œë¼ë³´ ì¹´í˜"];
            const type = types[Math.floor(Math.random() * types.length)];
            const profit = Math.floor(Math.random() * 20000001) + 30000000; 
            gameState.popupQueue.push({ type: 'business', event: { title: `ğŸ’¼ [ì œì•ˆ] ${type}`, desc: `${type} ì œì•ˆ.\nì„±ê³µ ì‹œ ìˆ˜ìµ, ì‹¤íŒ¨ ì‹œ ì†í•´.`, choices: [ { text: "ìˆ˜ë½", effect: () => executeBusiness(profit, type) }, { text: "ê±°ì ˆ", effect: () => {} } ] } });
        }
    }

    function executeBusiness(amount, type) {
        if (Math.random() < 0.7) { gameState.finance += amount; updateReputation(5); alert(`ğŸ‰ ì„±ê³µ! ${amount.toLocaleString()}ì› ìˆ˜ìµ.`); } 
        else { gameState.finance -= amount; updateReputation(-5); alert(`ğŸ˜­ ì‹¤íŒ¨... ${amount.toLocaleString()}ì› ì†í•´.`); }
        updateDisplay();
    }

    function checkTierUp() {
        const score = calculateTierScore();
        const newTierInfo = getTierInfo(score);
        if (tierOrder.indexOf(newTierInfo.name) > tierOrder.indexOf(gameState.currentTier)) {
            gameState.popupQueue.push({ type: 'tier_up', event: { title: "ğŸ‰ ë“±ê¸‰ ìƒìŠ¹!", customHtml: `<div class="${newTierInfo.class} tier-badge">${newTierInfo.name}</div>` } });
        }
        gameState.currentTier = newTierInfo.name;
    }

    function checkSeasonReport() {
        if (gameState.day % 180 === 0) {
            const score = calculateTierScore(); const info = getTierInfo(score);
            gameState.popupQueue.push({ type: 'season', event: { title: `ğŸ† ì‹œì¦Œ ê²°ì‚°`, customHtml: `<div class="${info.class} tier-badge">${info.name}</div><br>ì¢…í•©ì ìˆ˜: ${score.toLocaleString()}` } });
        }
    }

    function renderShop() {
        const moneyDisplay = `<div style="padding:10px; background:#e9ecef; border-radius:8px; margin-bottom:15px; font-weight:bold; text-align:center;">ìê¸ˆ: <span style="color:var(--money)">${gameState.finance.toLocaleString()}ì›</span></div>`;
        document.getElementById('shop-list').innerHTML = moneyDisplay + shopItems.map(item => `
            <div class="content-card"><div class="content-header"><strong>${item.name}</strong><span class="content-badge badge-item">${item.stat.toUpperCase()} +${item.val}</span></div>
            <div class="content-info"><div>ğŸ’° ${item.price.toLocaleString()}ì›</div><div>${item.desc}</div></div>
            <button class="content-btn ${gameState.finance >= item.price ? 'btn-available' : 'btn-cooldown'}" ${gameState.finance < item.price ? 'disabled' : ''} onclick="buyItem('${item.id}')">êµ¬ë§¤í•˜ê¸°</button>
            </div>`).join('');
    }

    function buyItem(id) {
        const item = shopItems.find(i => i.id === id);
        if(gameState.finance >= item.price) {
            gameState.finance -= item.price; gameState.inventory.push({ ...item, level: 0 });
            alert(`êµ¬ë§¤ ì™„ë£Œ!`); updateDisplay(); renderShop();
        }
    }

    function openEquipModal(memberIdx) {
        const m = gameState.members[memberIdx];
        document.getElementById('modal-title').innerText = `${m.name} ì¥ë¹„`;
        let equipHtml = m.equipment.length === 0 ? `<div style="color:#999; margin-bottom:10px;">ì°©ìš© ì¥ë¹„ ì—†ìŒ</div>` : m.equipment.map((eq, i) => `<div class="choice-btn"><span>${eq.name} (+${getEquipVal(eq)})</span><button class="upgrade-btn" style="background:#fa5252;" onclick="unequipItem(${memberIdx}, ${i})">í•´ì œ</button></div>`).join('');
        let invHtml = gameState.inventory.length === 0 ? `<div style="color:#999;">ì°½ê³  ë¹„ì—ˆìŒ</div>` : gameState.inventory.map((item, i) => `<button class="choice-btn" onclick="equipItem(${memberIdx}, ${i})"><span>${item.name}</span><span>ì¥ì°©</span></button>`).join('');
        document.getElementById('modal-body').innerHTML = `<div style="text-align:left;"><h4>ì°©ìš© ì¤‘</h4>${equipHtml}<h4>ì°½ê³ </h4>${invHtml}</div>`;
        document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">ë‹«ê¸°</button>`;
        document.getElementById('eventModal').style.display = 'block';
    }

    function equipItem(mIdx, iIdx) { const item = gameState.inventory[iIdx]; if(gameState.members[mIdx].equipment.some(e=>e.id===item.id)) return alert("ì¤‘ë³µ ì¥ì°© ë¶ˆê°€"); gameState.inventory.splice(iIdx,1); gameState.members[mIdx].equipment.push(item); openEquipModal(mIdx); updateDisplay(); }
    function unequipItem(mIdx, eIdx) { gameState.inventory.push(gameState.members[mIdx].equipment.splice(eIdx,1)[0]); openEquipModal(mIdx); updateDisplay(); }
    
    function manualTrainAction() { const idx = document.getElementById('sel-member').value; gameState.members[idx].manualAct = document.getElementById('sel-stat').value; alert("ì§€ì‹œ ì™„ë£Œ"); }
    function switchChartPlatform(p) { gameState.currentChartPlatform = p; updateDisplay(); }
    function switchChartPeriod(p) { gameState.currentChartPeriod = p; updateDisplay(); }
    function renderHomeCharts(platform, period) {
        const container = document.getElementById('chart-list-container');
        const allSongs = [];
        gameState.rivalCharts.forEach(s => allSongs.push({...s, isPlayer: false}));
        gameState.activeCharts.forEach(s => { if(s.weekCount < 6) allSongs.push({artist: "HADES", title: s.name, scores: s.scores, prevRanks: s.prevRanks, isPlayer: true}); });
        allSongs.sort((a, b) => b.scores[platform][period] - a.scores[platform][period]);
        container.innerHTML = allSongs.slice(0, 10).map((song, idx) => `<div class="chart-row ${song.isPlayer ? 'my-song' : ''}"><div class="rank">${idx+1}</div><div class="song-info"><span class="song-title">${song.title}</span><span class="artist-name">${song.artist}</span></div><div class="chart-score">${Math.floor(song.scores[platform][period]).toLocaleString()}</div></div>`).join('');
    }

    // === Next Day (Core) ===
    function nextDay() {
        if (document.getElementById('eventModal').style.display === 'block') return;
        if (gameState.finance < -50000000 || gameState.reputation <= 0) { alert("GAME OVER"); location.reload(); return; }

        // ë¯¸ë‹ˆê²Œì„ íŠ¸ë¦¬ê±° (íŒì—… í ì‚¬ìš©)
        if (Math.random() < 0.05) {
            gameState.popupQueue.unshift({ type: 'minigame', event: { title: "", desc: "", choices: [] } });
        }

        // ì§ì› ì›”ê¸‰
        let salaryTotal = 0;
        if(gameState.staff.manager) salaryTotal += 3000000;
        if(gameState.staff.marketer) salaryTotal += 4000000;
        if(gameState.staff.trainer) salaryTotal += 3500000;
        if(gameState.day % 30 === 0 && salaryTotal > 0) {
            gameState.finance -= salaryTotal;
            gameState.popupQueue.push({ type: 'salary', event: { title: 'ğŸ’¸ ì›”ê¸‰ë‚ ', desc: `ì§ì› ì›”ê¸‰ìœ¼ë¡œ ${salaryTotal.toLocaleString()}ì›ì´ ì§€ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.`, choices: [{ text: "í™•ì¸", effect: ()=>{} }] } });
        }

        let totalProfit = Math.floor(Math.random() * 800001) + 400000;
        if(gameState.studioLevel >= 3) totalProfit += 500000; // ìŠ¤íŠœë””ì˜¤ ë³´ë„ˆìŠ¤

        const actionsPool = ['vocal', 'dance', 'visual', 'variety', 'charm', 'rest'];
        if (gameState.day % 3 === 0) {
            const sites = ['ì—ë±€', 'íŒ¬ì¹´í˜', 'ë„ˆíŠœë¸Œ', 'SNS', 'YZ'];
            const randomSite = sites[Math.floor(Math.random() * sites.length)];
            const randomMsg = [ebemMsgs, cafeMsgs, ebemMsgs, ebemMsgs, yzMsgs][sites.indexOf(randomSite)];
            gameState.community.push({site: randomSite, content: randomMsg[Math.floor(Math.random() * randomMsg.length)]});
        }

        gameState.members.forEach(m => {
            let action = m.manualAct || actionsPool[Math.floor(Math.random() * actionsPool.length)];
            let mentalFactor = 1.2 - ((m.mental / 100) * 0.4); 
            
            if(m.trait.effect === 'rest_down') mentalFactor += 0.2;
            if(m.trait.effect === 'grow_up' && action !== 'rest') mentalFactor -= 0.1; 
            
            if(gameState.staff.manager) m.fatigue = Math.max(0, m.fatigue - 5);
            let growBonus = gameState.staff.trainer ? 2 : 1;
            if(m.trait.effect === 'grow_up') growBonus += 1;
            if(gameState.studioLevel >= 3) growBonus += 1;

            if (action === 'rest') {
                let recov = 40;
                if (m.trait.effect === 'lazy') recov = 25; 
                if (gameState.studioLevel >= 1) recov += 5; 
                m.fatigue = Math.max(0, m.fatigue - recov);
            } else if (m.fatigue < 100) {
                let prev = m[action];
                if (m[action] < 60 && Math.random() < 0.4) { 
                    m[action] += growBonus; 
                    gameState.weeklyStats.push({name: m.name, stat: action, from: prev, to: m[action]}); 
                    m.fatigue = Math.min(100, m.fatigue + (20 * mentalFactor)); 
                } else m.fatigue = Math.min(100, m.fatigue + (15 * mentalFactor));
            }
            m.manualAct = null; m.fatigue = Math.floor(m.fatigue); 
        });

        if (Math.random() < 0.05) gameState.community.push({site:'ì†ë³´', content: `<b>[NEWS] ${newsHeadlines[Math.floor(Math.random()*newsHeadlines.length)]}</b>`});
        if (gameState.community.length > 50) gameState.community.shift();

        let d = new Date(gameState.startDate); d.setDate(d.getDate() + (gameState.day - 1));
        
        checkDateEvents(d); processCharts(); checkBirthday(); checkBusinessProposal(); checkTierUp(); checkSeasonReport(); 

        if(gameState.day % 7 === 0) { gameState.popupQueue.push({type: 'training_report', data: [...gameState.weeklyStats]}); gameState.weeklyStats = []; }
        
        gameState.finance += totalProfit; gameState.accumulatedSales += totalProfit; 
        gameState.finance -= 500000; updateFandom(Math.floor(totalProfit / 10000));
        
        document.getElementById('profit-report').style.display = 'block';
        document.getElementById('profit-content').innerHTML = `ìˆ˜ìµ: <span class="money-text">${totalProfit.toLocaleString()}ì›</span>`;
        
        gameState.day++; updateDisplay(); processNextPopup();
    }

    function processNextPopup() {
        if (document.getElementById('eventModal').style.display === 'block' || gameState.popupQueue.length === 0) return;
        const item = gameState.popupQueue.shift();
        
        if (item.type === 'minigame') {
            startChatGame();
        } else if(item.type === 'season' || item.type === 'tier_up' || item.type === 'salary') {
            document.getElementById('modal-title').innerText = item.event.title;
            document.getElementById('modal-body').innerHTML = item.event.customHtml || item.event.desc;
            document.getElementById('modal-choices').innerHTML = `<button class="primary-btn" onclick="closeModal()">í™•ì¸</button>`;
            document.getElementById('eventModal').style.display = 'block';
        } else if(item.type === 'training_report') {
            showTrainingReport(item.data);
        } else {
            renderEventPopup(item.event, item.type === 'birthday');
        }
    }
</script>
</body>
</html>
